/*!
 * w-pubsub-client v1.0.8
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("mqtt")):"function"==typeof define&&define.amd?define(["mqtt"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-pubsub-client"]=e(t.mqtt)}(this,(function(t){"use strict";var e=Array.isArray,n="object"==typeof global&&global&&global.Object===Object&&global,r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")(),i=o.Symbol,c=Object.prototype,u=c.hasOwnProperty,a=c.toString,s=i?i.toStringTag:void 0;var l=Object.prototype.toString;var f=i?i.toStringTag:void 0;function p(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":f&&f in Object(t)?function(t){var e=u.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[s]=n:delete t[s]),o}(t):function(t){return l.call(t)}(t)}function h(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==p(t)}var v=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,y=/^\w*$/;function _(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var d,b=o["__core-js_shared__"],g=(d=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+d:"";var m=Function.prototype.toString;var j=/^\[object .+?Constructor\]$/,w=Function.prototype,O=Object.prototype,x=w.toString,S=O.hasOwnProperty,P=RegExp("^"+x.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function $(t){if(!_(t)||(e=t,g&&g in e))return!1;var e,n=function(t){if(!_(t))return!1;var e=p(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}(t)?P:j;return n.test(function(t){if(null!=t){try{return m.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function N(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return $(n)?n:void 0}var z=N(Object,"create");var A=Object.prototype.hasOwnProperty;var C=Object.prototype.hasOwnProperty;function F(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function I(t,e){for(var n,r,o=t.length;o--;)if((n=t[o][0])===(r=e)||n!=n&&r!=r)return o;return-1}F.prototype.clear=function(){this.__data__=z?z(null):{},this.size=0},F.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},F.prototype.get=function(t){var e=this.__data__;if(z){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return A.call(e,t)?e[t]:void 0},F.prototype.has=function(t){var e=this.__data__;return z?void 0!==e[t]:C.call(e,t)},F.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=z&&void 0===e?"__lodash_hash_undefined__":e,this};var T=Array.prototype.splice;function k(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}k.prototype.clear=function(){this.__data__=[],this.size=0},k.prototype.delete=function(t){var e=this.__data__,n=I(e,t);return!(n<0)&&(n==e.length-1?e.pop():T.call(e,n,1),--this.size,!0)},k.prototype.get=function(t){var e=this.__data__,n=I(e,t);return n<0?void 0:e[n][1]},k.prototype.has=function(t){return I(this.__data__,t)>-1},k.prototype.set=function(t,e){var n=this.__data__,r=I(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var q=N(o,"Map");function E(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function L(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}L.prototype.clear=function(){this.size=0,this.__data__={hash:new F,map:new(q||k),string:new F}},L.prototype.delete=function(t){var e=E(this,t).delete(t);return this.size-=e?1:0,e},L.prototype.get=function(t){return E(this,t).get(t)},L.prototype.has=function(t){return E(this,t).has(t)},L.prototype.set=function(t,e){var n=E(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function M(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var c=t.apply(this,r);return n.cache=i.set(o,c)||i,c};return n.cache=new(M.Cache||L),n}M.Cache=L;var R,J,G,U=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,B=/\\(\\)?/g,D=(R=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(U,(function(t,n,r,o){e.push(r?o.replace(B,"$1"):n||t)})),e},J=M(R,(function(t){return 500===G.size&&G.clear(),t})),G=J.cache,J),H=D;var K=i?i.prototype:void 0,Q=K?K.toString:void 0;function V(t){if("string"==typeof t)return t;if(e(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}(t,V)+"";if(h(t))return Q?Q.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}function W(t){return null==t?"":V(t)}function X(t,n){return e(t)?t:function(t,n){if(e(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!h(t))||y.test(t)||!v.test(t)||null!=n&&t in Object(n)}(t,n)?[t]:H(W(t))}function Y(t){if("string"==typeof t||h(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Z(t,e,n){var r=null==t?void 0:function(t,e){for(var n=0,r=(e=X(e,t)).length;null!=t&&n<r;)t=t[Y(e[n++])];return n&&n==r?t:void 0}(t,e);return void 0===r?n:r}function tt(t){return!(!function(t){return"[object String]"===Object.prototype.toString.call(t)}(t)||""===t)}var et=/\s/;var nt=/^\s+/;function rt(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&et.test(t.charAt(e)););return e}(t)+1).replace(nt,""):t}var ot=/^[-+]0x[0-9a-f]+$/i,it=/^0b[01]+$/i,ct=/^0o[0-7]+$/i,ut=parseInt;function at(t){if("number"==typeof t)return t;if(h(t))return NaN;if(_(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=_(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=rt(t);var n=it.test(t);return n||ct.test(t)?ut(t.slice(2),n?2:8):ot.test(t)?NaN:+t}var st=1/0;function lt(t){return t?(t=at(t))===st||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ft(t){var e=lt(t),n=e%1;return e==e?n?e-n:e:0}function pt(t){let e=!1;if(tt(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(function(t){return t!=t}(t))return!1;e=!0}return e}function ht(t){if(!pt(t))return 0;return lt(t)}function vt(t){return!!pt(t)&&(t=ht(t),"number"==typeof(e=t)&&e==ft(e));var e}var yt=o.isFinite,_t=Math.min;var dt=function(t){var e=Math[t];return function(t,n){if(t=at(t),(n=null==n?0:_t(ft(n),292))&&yt(t)){var r=(W(t)+"e").split("e");return+((r=(W(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),bt=dt;function gt(t){if(!pt(t))return 0;t=ht(t);let e=bt(t);return"0"===String(e)?0:e}function mt(t){if(!vt(t))return!1;return gt(t)>0}function jt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wt={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,c){if("function"!=typeof r)throw new TypeError("The listener must be a function");var u=new o(r,i||t,c),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],u]:t._events[a].push(u):(t._events[a]=u,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},u.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},u.prototype.emit=function(t,e,r,o,i,c){var u=n?n+t:t;if(!this._events[u])return!1;var a,s,l=this._events[u],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,o),!0;case 5:return l.fn.call(l.context,e,r,o,i),!0;case 6:return l.fn.call(l.context,e,r,o,i,c),!0}for(s=1,a=new Array(f-1);s<f;s++)a[s-1]=arguments[s];l.fn.apply(l.context,a)}else{var p,h=l.length;for(s=0;s<h;s++)switch(l[s].once&&this.removeListener(t,l[s].fn,void 0,!0),f){case 1:l[s].fn.call(l[s].context);break;case 2:l[s].fn.call(l[s].context,e);break;case 3:l[s].fn.call(l[s].context,e,r);break;case 4:l[s].fn.call(l[s].context,e,r,o);break;default:if(!a)for(p=1,a=new Array(f-1);p<f;p++)a[p-1]=arguments[p];l[s].fn.apply(l[s].context,a)}}return!0},u.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},u.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},u.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var u=this._events[i];if(u.fn)u.fn!==e||o&&!u.once||r&&u.context!==r||c(this,i);else{for(var a=0,s=[],l=u.length;a<l;a++)(u[a].fn!==e||o&&!u[a].once||r&&u[a].context!==r)&&s.push(u[a]);s.length?this._events[i]=1===s.length?s[0]:s:c(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&c(this,e)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u}(wt);var Ot=jt(wt.exports);let xt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),St=xt.length;function Pt(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}async function $t(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=Pt();if(!function(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}(t))return r.reject("waitfunction需輸入函數f"),r;let o=async()=>{let e=t();return function(t){let e,n=Object.prototype.toString.call(t);if(e="[object Promise]"===n,e)return!0;if("[object Function]"!==n)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}(e)&&(e=await e),e};if(n=await o(),!0===n)return r.resolve(),r;let i=Z(e,"attemptNum",null);mt(i)||(i=200);let c=Z(e,"timeInterval",null);mt(c)||(c=1e3);let u=0,a=setInterval((async()=>{u+=1,n=await o(),!0===n&&(clearInterval(a),r.resolve()),u>i&&(clearInterval(a),r.reject(`exceeded attemptNum[${i}]`))}),c);return r}return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="__msg__",r=Z(e,"url");tt(r)||(r="mqtt://localhost");let o=Z(e,"port");mt(o)||(o=8080),o=gt(o);let i=Z(e,"token");tt(i)||(i="");let c=Z(e,"clientId");tt(c)||(c=`cl-${function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=mt(t)?gt(t):32;for(let n=0;n<t;n++)e[n]=xt[0|Math.random()*St];return e.join("")}()}`);let u=Z(e,"timeReconnect");mt(u)||(u=2e3),u=gt(u);let a=`${r}:${o}`,s=t.connect(a,{clientId:c,username:i,password:"",clean:!1,reconnectPeriod:u}),l=new Ot,f=!1;return s.on("connect",(()=>{f=!0,l.emit("connect")})),s.on("reconnect",(()=>{l.emit("reconnect")})),s.on("message",((t,e)=>{let r="";try{r=Z(function(t){if(!tt(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(e.toString()),n,"")}catch(t){console.log(t)}l.emit("message",{topic:t,message:r})})),s.on("error",(t=>{l.emit("error",t)})),s.on("offline",(()=>{f=!1,l.emit("offline")})),s.on("close",(()=>{f=!1,l.emit("close")})),s.on("end",(()=>{f=!1,l.emit("end")})),l.subscribe=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Pt();return await $t((()=>f)),s.subscribe(t,{qos:e},((t,e)=>{t?n.reject(t):n.resolve(e)})),n},l.unsubscribe=async t=>{let e=Pt();return await $t((()=>f)),s.unsubscribe(t,(t=>{t?e.reject(t):e.resolve()})),e},l.publish=async function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;await $t((()=>f));let o=JSON.stringify({[n]:e}),i=Pt();return s.publish(t,o,{qos:r},(t=>{t?i.reject(t):i.resolve("done")})),i},l.clear=()=>new Promise(((t,e)=>{s.end(!1,{},(n=>{if(n)return e(n);t()}))})),l}}));
//# sourceMappingURL=w-pubsub-client.umd.js.map
