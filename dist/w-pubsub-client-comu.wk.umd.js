(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('worker_threads')) :
	typeof define === 'function' && define.amd ? define(['worker_threads'], factory) :
	(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.WPubsubClientComu = factory(global.worker_threads));
})(this, (function (require$$0) { 'use strict';

	var commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};

	function getDefaultExportFromCjs (x) {
		return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
	}

	var tempSYnLQ9wgtSStDkDC6vZ6yGbWl9poHhbFNw = {exports: {}};

	(function (module, exports) {
	  (function (global, factory) {
	    module.exports = factory(require$$0) ;
	  })(commonjsGlobal, function (worker_threads) {

	    function getDefaultExportFromCjs(x) {
	      return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
	    }
	    var eventemitter3 = {
	      exports: {}
	    };
	    (function (module) {
	      var has = Object.prototype.hasOwnProperty,
	        prefix = '~';

	      /**
	       * Constructor to create a storage for our `EE` objects.
	       * An `Events` instance is a plain object whose properties are event names.
	       *
	       * @constructor
	       * @private
	       */
	      function Events() {}

	      //
	      // We try to not inherit from `Object.prototype`. In some engines creating an
	      // instance in this way is faster than calling `Object.create(null)` directly.
	      // If `Object.create(null)` is not supported we prefix the event names with a
	      // character to make sure that the built-in object properties are not
	      // overridden or used as an attack vector.
	      //
	      if (Object.create) {
	        Events.prototype = Object.create(null);

	        //
	        // This hack is needed because the `__proto__` property is still inherited in
	        // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.
	        //
	        if (!new Events().__proto__) prefix = false;
	      }

	      /**
	       * Representation of a single event listener.
	       *
	       * @param {Function} fn The listener function.
	       * @param {*} context The context to invoke the listener with.
	       * @param {Boolean} [once=false] Specify if the listener is a one-time listener.
	       * @constructor
	       * @private
	       */
	      function EE(fn, context, once) {
	        this.fn = fn;
	        this.context = context;
	        this.once = once || false;
	      }

	      /**
	       * Add a listener for a given event.
	       *
	       * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
	       * @param {(String|Symbol)} event The event name.
	       * @param {Function} fn The listener function.
	       * @param {*} context The context to invoke the listener with.
	       * @param {Boolean} once Specify if the listener is a one-time listener.
	       * @returns {EventEmitter}
	       * @private
	       */
	      function addListener(emitter, event, fn, context, once) {
	        if (typeof fn !== 'function') {
	          throw new TypeError('The listener must be a function');
	        }
	        var listener = new EE(fn, context || emitter, once),
	          evt = prefix ? prefix + event : event;
	        if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);else emitter._events[evt] = [emitter._events[evt], listener];
	        return emitter;
	      }

	      /**
	       * Clear event by name.
	       *
	       * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.
	       * @param {(String|Symbol)} evt The Event name.
	       * @private
	       */
	      function clearEvent(emitter, evt) {
	        if (--emitter._eventsCount === 0) emitter._events = new Events();else delete emitter._events[evt];
	      }

	      /**
	       * Minimal `EventEmitter` interface that is molded against the Node.js
	       * `EventEmitter` interface.
	       *
	       * @constructor
	       * @public
	       */
	      function EventEmitter() {
	        this._events = new Events();
	        this._eventsCount = 0;
	      }

	      /**
	       * Return an array listing the events for which the emitter has registered
	       * listeners.
	       *
	       * @returns {Array}
	       * @public
	       */
	      EventEmitter.prototype.eventNames = function eventNames() {
	        var names = [],
	          events,
	          name;
	        if (this._eventsCount === 0) return names;
	        for (name in events = this._events) {
	          if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);
	        }
	        if (Object.getOwnPropertySymbols) {
	          return names.concat(Object.getOwnPropertySymbols(events));
	        }
	        return names;
	      };

	      /**
	       * Return the listeners registered for a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @returns {Array} The registered listeners.
	       * @public
	       */
	      EventEmitter.prototype.listeners = function listeners(event) {
	        var evt = prefix ? prefix + event : event,
	          handlers = this._events[evt];
	        if (!handlers) return [];
	        if (handlers.fn) return [handlers.fn];
	        for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {
	          ee[i] = handlers[i].fn;
	        }
	        return ee;
	      };

	      /**
	       * Return the number of listeners listening to a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @returns {Number} The number of listeners.
	       * @public
	       */
	      EventEmitter.prototype.listenerCount = function listenerCount(event) {
	        var evt = prefix ? prefix + event : event,
	          listeners = this._events[evt];
	        if (!listeners) return 0;
	        if (listeners.fn) return 1;
	        return listeners.length;
	      };

	      /**
	       * Calls each of the listeners registered for a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @returns {Boolean} `true` if the event had listeners, else `false`.
	       * @public
	       */
	      EventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {
	        var evt = prefix ? prefix + event : event;
	        if (!this._events[evt]) return false;
	        var listeners = this._events[evt],
	          len = arguments.length,
	          args,
	          i;
	        if (listeners.fn) {
	          if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);
	          switch (len) {
	            case 1:
	              return listeners.fn.call(listeners.context), true;
	            case 2:
	              return listeners.fn.call(listeners.context, a1), true;
	            case 3:
	              return listeners.fn.call(listeners.context, a1, a2), true;
	            case 4:
	              return listeners.fn.call(listeners.context, a1, a2, a3), true;
	            case 5:
	              return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;
	            case 6:
	              return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;
	          }
	          for (i = 1, args = new Array(len - 1); i < len; i++) {
	            args[i - 1] = arguments[i];
	          }
	          listeners.fn.apply(listeners.context, args);
	        } else {
	          var length = listeners.length,
	            j;
	          for (i = 0; i < length; i++) {
	            if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);
	            switch (len) {
	              case 1:
	                listeners[i].fn.call(listeners[i].context);
	                break;
	              case 2:
	                listeners[i].fn.call(listeners[i].context, a1);
	                break;
	              case 3:
	                listeners[i].fn.call(listeners[i].context, a1, a2);
	                break;
	              case 4:
	                listeners[i].fn.call(listeners[i].context, a1, a2, a3);
	                break;
	              default:
	                if (!args) for (j = 1, args = new Array(len - 1); j < len; j++) {
	                  args[j - 1] = arguments[j];
	                }
	                listeners[i].fn.apply(listeners[i].context, args);
	            }
	          }
	        }
	        return true;
	      };

	      /**
	       * Add a listener for a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @param {Function} fn The listener function.
	       * @param {*} [context=this] The context to invoke the listener with.
	       * @returns {EventEmitter} `this`.
	       * @public
	       */
	      EventEmitter.prototype.on = function on(event, fn, context) {
	        return addListener(this, event, fn, context, false);
	      };

	      /**
	       * Add a one-time listener for a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @param {Function} fn The listener function.
	       * @param {*} [context=this] The context to invoke the listener with.
	       * @returns {EventEmitter} `this`.
	       * @public
	       */
	      EventEmitter.prototype.once = function once(event, fn, context) {
	        return addListener(this, event, fn, context, true);
	      };

	      /**
	       * Remove the listeners of a given event.
	       *
	       * @param {(String|Symbol)} event The event name.
	       * @param {Function} fn Only remove the listeners that match this function.
	       * @param {*} context Only remove the listeners that have this context.
	       * @param {Boolean} once Only remove one-time listeners.
	       * @returns {EventEmitter} `this`.
	       * @public
	       */
	      EventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {
	        var evt = prefix ? prefix + event : event;
	        if (!this._events[evt]) return this;
	        if (!fn) {
	          clearEvent(this, evt);
	          return this;
	        }
	        var listeners = this._events[evt];
	        if (listeners.fn) {
	          if (listeners.fn === fn && (!once || listeners.once) && (!context || listeners.context === context)) {
	            clearEvent(this, evt);
	          }
	        } else {
	          for (var i = 0, events = [], length = listeners.length; i < length; i++) {
	            if (listeners[i].fn !== fn || once && !listeners[i].once || context && listeners[i].context !== context) {
	              events.push(listeners[i]);
	            }
	          }

	          //
	          // Reset the array, or remove it completely if we have no more listeners.
	          //
	          if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;else clearEvent(this, evt);
	        }
	        return this;
	      };

	      /**
	       * Remove all listeners, or those of the specified event.
	       *
	       * @param {(String|Symbol)} [event] The event name.
	       * @returns {EventEmitter} `this`.
	       * @public
	       */
	      EventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {
	        var evt;
	        if (event) {
	          evt = prefix ? prefix + event : event;
	          if (this._events[evt]) clearEvent(this, evt);
	        } else {
	          this._events = new Events();
	          this._eventsCount = 0;
	        }
	        return this;
	      };

	      //
	      // Alias methods names because people roll like that.
	      //
	      EventEmitter.prototype.off = EventEmitter.prototype.removeListener;
	      EventEmitter.prototype.addListener = EventEmitter.prototype.on;

	      //
	      // Expose the prefix.
	      //
	      EventEmitter.prefixed = prefix;

	      //
	      // Allow `EventEmitter` to be imported as module namespace.
	      //
	      EventEmitter.EventEmitter = EventEmitter;

	      //
	      // Expose the module.
	      //
	      {
	        module.exports = EventEmitter;
	      }
	    })(eventemitter3);
	    var eventemitter3Exports = eventemitter3.exports;
	    var EventEmitter = /*@__PURE__*/getDefaultExportFromCjs(eventemitter3Exports);
	    function isWindow() {
	      return typeof window !== 'undefined' && typeof window.document !== 'undefined';
	    }

	    //ww
	    let ww;
	    function protectShell() {
	      //cEnv
	      let cEnv = isWindow() ? 'browser' : 'nodejs';

	      //check, 後續會有Nodejs或瀏覽器依賴的API例如window.atob或Buffer, 於import階段時就先行偵測跳出
	      if (cEnv !== 'nodejs') {
	        return null;
	      }
	      function evem() {
	        return new EventEmitter();
	      }
	      function genPm() {
	        let resolve;
	        let reject;
	        let p = new Promise(function () {
	          resolve = arguments[0];
	          reject = arguments[1];
	        });
	        p.resolve = resolve;
	        p.reject = reject;
	        return p;
	      }
	      function genID() {
	        let len = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;
	        let uuid = [];
	        let chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');
	        let radix = chars.length;
	        for (let i = 0; i < len; i++) uuid[i] = chars[0 | Math.random() * radix];
	        let r = uuid.join('');
	        return r;
	      }
	      function b642str(b64) {
	        //return b64
	        return Buffer.from(b64, 'base64').toString('utf8'); //Nodejs端使用Buffer解碼 
	      }

	      //codeShow

	      //codeB64, 此處需提供worker執行程式碼, 因有特殊符號轉譯困難, 故需先轉base64再使用
	      let codeB64 = `CgogICAgICAgIC8vaW1wb3J0IHsgcGFyZW50UG9ydCB9IGZyb20gJ3dvcmtlcl90aHJlYWRzJwogICAgICAgIGxldCB7IHBhcmVudFBvcnQgfSA9IHJlcXVpcmUoJ3dvcmtlcl90aHJlYWRzJykgLy/lm6BwYWNrYWdlLmpzb27kuI3ntaZ0eXBlPW1vZHVsZeaVheeEoeazleaUr+aPtGVzNiBpbXBvcnQsIOW+l+S9v+eUqHJlcXVpcmUKICAgICAgICAvL+iLpeimgeaWvG5vZGVqcyB3b3JrZXLlhafkvb/nlKjnhKHms5XovYnora/nmoTljp/nlJ/lpZfku7bkvovlpoJmcywg6YG/5YWN5L2/55So6aCC5bGkaW1wb3J05Yqg6LyJ5L2/55SoLCDlm6DnhKHms5XovYnora/mnIPnm7TmjqXkv53nlZkKICAgICAgICAvL+S4puWboGltcG9ydOS9jeaWvHdvcmtlcuWkluWxpOmZkOWumueCunJlcXVpcmXljYAocGFja2FnZS5qc29u5LiN57WmdHlwZT1tb2R1bGUpLCDmlYXlh7rnj77pjK/oqqTnhKHms5XovYnora8KICAgICAgICAKCid1c2Ugc3RyaWN0JzsKCnZhciBtcXR0ID0gcmVxdWlyZSgnbXF0dCcpOwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYW4gYEFycmF5YCBvYmplY3QuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDAuMS4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBhcnJheSwgZWxzZSBgZmFsc2VgLgogKiBAZXhhbXBsZQogKgogKiBfLmlzQXJyYXkoWzEsIDIsIDNdKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzQXJyYXkoZG9jdW1lbnQuYm9keS5jaGlsZHJlbik7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uaXNBcnJheSgnYWJjJyk7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uaXNBcnJheShfLm5vb3ApOwogKiAvLyA9PiBmYWxzZQogKi8KdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5Owp2YXIgaXNBcnJheSQxID0gaXNBcnJheTsKCi8qKiBEZXRlY3QgZnJlZSB2YXJpYWJsZSBgZ2xvYmFsYCBmcm9tIE5vZGUuanMuICovCnZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDsKdmFyIGZyZWVHbG9iYWwkMSA9IGZyZWVHbG9iYWw7CgovKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHNlbGZgLiAqLwp2YXIgZnJlZVNlbGYgPSB0eXBlb2Ygc2VsZiA9PSAnb2JqZWN0JyAmJiBzZWxmICYmIHNlbGYuT2JqZWN0ID09PSBPYmplY3QgJiYgc2VsZjsKCi8qKiBVc2VkIGFzIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0LiAqLwp2YXIgcm9vdCA9IGZyZWVHbG9iYWwkMSB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwp2YXIgcm9vdCQxID0gcm9vdDsKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgU3ltYm9sID0gcm9vdCQxLlN5bWJvbDsKdmFyIFN5bWJvbCQxID0gU3ltYm9sOwoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgb2JqZWN0UHJvdG8kOCA9IE9iamVjdC5wcm90b3R5cGU7CgovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KdmFyIGhhc093blByb3BlcnR5JDYgPSBvYmplY3RQcm90byQ4Lmhhc093blByb3BlcnR5OwoKLyoqCiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGUKICogW2B0b1N0cmluZ1RhZ2BdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5wcm90b3R5cGUudG9zdHJpbmcpCiAqIG9mIHZhbHVlcy4KICovCnZhciBuYXRpdmVPYmplY3RUb1N0cmluZyQxID0gb2JqZWN0UHJvdG8kOC50b1N0cmluZzsKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgc3ltVG9TdHJpbmdUYWckMSA9IFN5bWJvbCQxID8gU3ltYm9sJDEudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7CgovKioKICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlR2V0VGFnYCB3aGljaCBpZ25vcmVzIGBTeW1ib2wudG9TdHJpbmdUYWdgIHZhbHVlcy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHJhdyBgdG9TdHJpbmdUYWdgLgogKi8KZnVuY3Rpb24gZ2V0UmF3VGFnKHZhbHVlKSB7CiAgdmFyIGlzT3duID0gaGFzT3duUHJvcGVydHkkNi5jYWxsKHZhbHVlLCBzeW1Ub1N0cmluZ1RhZyQxKSwKICAgIHRhZyA9IHZhbHVlW3N5bVRvU3RyaW5nVGFnJDFdOwogIHRyeSB7CiAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZyQxXSA9IHVuZGVmaW5lZDsKICAgIHZhciB1bm1hc2tlZCA9IHRydWU7CiAgfSBjYXRjaCAoZSkge30KICB2YXIgcmVzdWx0ID0gbmF0aXZlT2JqZWN0VG9TdHJpbmckMS5jYWxsKHZhbHVlKTsKICBpZiAodW5tYXNrZWQpIHsKICAgIGlmIChpc093bikgewogICAgICB2YWx1ZVtzeW1Ub1N0cmluZ1RhZyQxXSA9IHRhZzsKICAgIH0gZWxzZSB7CiAgICAgIGRlbGV0ZSB2YWx1ZVtzeW1Ub1N0cmluZ1RhZyQxXTsKICAgIH0KICB9CiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgb2JqZWN0UHJvdG8kNyA9IE9iamVjdC5wcm90b3R5cGU7CgovKioKICogVXNlZCB0byByZXNvbHZlIHRoZQogKiBbYHRvU3RyaW5nVGFnYF0oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtb2JqZWN0LnByb3RvdHlwZS50b3N0cmluZykKICogb2YgdmFsdWVzLgogKi8KdmFyIG5hdGl2ZU9iamVjdFRvU3RyaW5nID0gb2JqZWN0UHJvdG8kNy50b1N0cmluZzsKCi8qKgogKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgc3RyaW5nIHVzaW5nIGBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nYC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29udmVydC4KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgY29udmVydGVkIHN0cmluZy4KICovCmZ1bmN0aW9uIG9iamVjdFRvU3RyaW5nKHZhbHVlKSB7CiAgcmV0dXJuIG5hdGl2ZU9iamVjdFRvU3RyaW5nLmNhbGwodmFsdWUpOwp9CgovKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovCnZhciBudWxsVGFnID0gJ1tvYmplY3QgTnVsbF0nLAogIHVuZGVmaW5lZFRhZyA9ICdbb2JqZWN0IFVuZGVmaW5lZF0nOwoKLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovCnZhciBzeW1Ub1N0cmluZ1RhZyA9IFN5bWJvbCQxID8gU3ltYm9sJDEudG9TdHJpbmdUYWcgOiB1bmRlZmluZWQ7CgovKioKICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYGdldFRhZ2Agd2l0aG91dCBmYWxsYmFja3MgZm9yIGJ1Z2d5IGVudmlyb25tZW50cy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGB0b1N0cmluZ1RhZ2AuCiAqLwpmdW5jdGlvbiBiYXNlR2V0VGFnKHZhbHVlKSB7CiAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkVGFnIDogbnVsbFRhZzsKICB9CiAgcmV0dXJuIHN5bVRvU3RyaW5nVGFnICYmIHN5bVRvU3RyaW5nVGFnIGluIE9iamVjdCh2YWx1ZSkgPyBnZXRSYXdUYWcodmFsdWUpIDogb2JqZWN0VG9TdHJpbmcodmFsdWUpOwp9CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgCiAqIGFuZCBoYXMgYSBgdHlwZW9mYCByZXN1bHQgb2YgIm9iamVjdCIuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDQuMC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBvYmplY3QtbGlrZSwgZWxzZSBgZmFsc2VgLgogKiBAZXhhbXBsZQogKgogKiBfLmlzT2JqZWN0TGlrZSh7fSk7CiAqIC8vID0+IHRydWUKICoKICogXy5pc09iamVjdExpa2UoWzEsIDIsIDNdKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzT2JqZWN0TGlrZShfLm5vb3ApOwogKiAvLyA9PiBmYWxzZQogKgogKiBfLmlzT2JqZWN0TGlrZShudWxsKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzT2JqZWN0TGlrZSh2YWx1ZSkgewogIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JzsKfQoKLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwp2YXIgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXSc7CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgY2xhc3NpZmllZCBhcyBhIGBTeW1ib2xgIHByaW1pdGl2ZSBvciBvYmplY3QuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDQuMC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHN5bWJvbCwgZWxzZSBgZmFsc2VgLgogKiBAZXhhbXBsZQogKgogKiBfLmlzU3ltYm9sKFN5bWJvbC5pdGVyYXRvcik7CiAqIC8vID0+IHRydWUKICoKICogXy5pc1N5bWJvbCgnYWJjJyk7CiAqIC8vID0+IGZhbHNlCiAqLwpmdW5jdGlvbiBpc1N5bWJvbCh2YWx1ZSkgewogIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHwgaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBiYXNlR2V0VGFnKHZhbHVlKSA9PSBzeW1ib2xUYWc7Cn0KCi8qKiBVc2VkIHRvIG1hdGNoIHByb3BlcnR5IG5hbWVzIHdpdGhpbiBwcm9wZXJ0eSBwYXRocy4gKi8KdmFyIHJlSXNEZWVwUHJvcCA9IC9cLnxcWyg/OlteW1xdXSp8KFsiJ10pKD86KD8hXDEpW15cXF18XFwuKSo/XDEpXF0vLAogIHJlSXNQbGFpblByb3AgPSAvXlx3KiQvOwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgcHJvcGVydHkgbmFtZSBhbmQgbm90IGEgcHJvcGVydHkgcGF0aC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEBwYXJhbSB7T2JqZWN0fSBbb2JqZWN0XSBUaGUgb2JqZWN0IHRvIHF1ZXJ5IGtleXMgb24uCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgcHJvcGVydHkgbmFtZSwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gaXNLZXkodmFsdWUsIG9iamVjdCkgewogIGlmIChpc0FycmF5JDEodmFsdWUpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwogIGlmICh0eXBlID09ICdudW1iZXInIHx8IHR5cGUgPT0gJ3N5bWJvbCcgfHwgdHlwZSA9PSAnYm9vbGVhbicgfHwgdmFsdWUgPT0gbnVsbCB8fCBpc1N5bWJvbCh2YWx1ZSkpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gcmVJc1BsYWluUHJvcC50ZXN0KHZhbHVlKSB8fCAhcmVJc0RlZXBQcm9wLnRlc3QodmFsdWUpIHx8IG9iamVjdCAhPSBudWxsICYmIHZhbHVlIGluIE9iamVjdChvYmplY3QpOwp9CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgdGhlCiAqIFtsYW5ndWFnZSB0eXBlXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1sYW5ndWFnZS10eXBlcykKICogb2YgYE9iamVjdGAuIChlLmcuIGFycmF5cywgZnVuY3Rpb25zLCBvYmplY3RzLCByZWdleGVzLCBgbmV3IE51bWJlcigwKWAsIGFuZCBgbmV3IFN0cmluZygnJylgKQogKgogKiBAc3RhdGljCiAqIEBtZW1iZXJPZiBfCiAqIEBzaW5jZSAwLjEuMAogKiBAY2F0ZWdvcnkgTGFuZwogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYW4gb2JqZWN0LCBlbHNlIGBmYWxzZWAuCiAqIEBleGFtcGxlCiAqCiAqIF8uaXNPYmplY3Qoe30pOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uaXNPYmplY3QoWzEsIDIsIDNdKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzT2JqZWN0KF8ubm9vcCk7CiAqIC8vID0+IHRydWUKICoKICogXy5pc09iamVjdChudWxsKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlKSB7CiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgKHR5cGUgPT0gJ29iamVjdCcgfHwgdHlwZSA9PSAnZnVuY3Rpb24nKTsKfQoKLyoqIGBPYmplY3QjdG9TdHJpbmdgIHJlc3VsdCByZWZlcmVuY2VzLiAqLwp2YXIgYXN5bmNUYWcgPSAnW29iamVjdCBBc3luY0Z1bmN0aW9uXScsCiAgZnVuY1RhZyQxID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICBnZW5UYWcgPSAnW29iamVjdCBHZW5lcmF0b3JGdW5jdGlvbl0nLAogIHByb3h5VGFnID0gJ1tvYmplY3QgUHJveHldJzsKCi8qKgogKiBDaGVja3MgaWYgYHZhbHVlYCBpcyBjbGFzc2lmaWVkIGFzIGEgYEZ1bmN0aW9uYCBvYmplY3QuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDAuMS4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIGZ1bmN0aW9uLCBlbHNlIGBmYWxzZWAuCiAqIEBleGFtcGxlCiAqCiAqIF8uaXNGdW5jdGlvbihfKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzRnVuY3Rpb24oL2FiYy8pOwogKiAvLyA9PiBmYWxzZQogKi8KZnVuY3Rpb24gaXNGdW5jdGlvbih2YWx1ZSkgewogIGlmICghaXNPYmplY3QodmFsdWUpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIC8vIFRoZSB1c2Ugb2YgYE9iamVjdCN0b1N0cmluZ2AgYXZvaWRzIGlzc3VlcyB3aXRoIHRoZSBgdHlwZW9mYCBvcGVyYXRvcgogIC8vIGluIFNhZmFyaSA5IHdoaWNoIHJldHVybnMgJ29iamVjdCcgZm9yIHR5cGVkIGFycmF5cyBhbmQgb3RoZXIgY29uc3RydWN0b3JzLgogIHZhciB0YWcgPSBiYXNlR2V0VGFnKHZhbHVlKTsKICByZXR1cm4gdGFnID09IGZ1bmNUYWckMSB8fCB0YWcgPT0gZ2VuVGFnIHx8IHRhZyA9PSBhc3luY1RhZyB8fCB0YWcgPT0gcHJveHlUYWc7Cn0KCi8qKiBVc2VkIHRvIGRldGVjdCBvdmVycmVhY2hpbmcgY29yZS1qcyBzaGltcy4gKi8KdmFyIGNvcmVKc0RhdGEgPSByb290JDFbJ19fY29yZS1qc19zaGFyZWRfXyddOwp2YXIgY29yZUpzRGF0YSQxID0gY29yZUpzRGF0YTsKCi8qKiBVc2VkIHRvIGRldGVjdCBtZXRob2RzIG1hc3F1ZXJhZGluZyBhcyBuYXRpdmUuICovCnZhciBtYXNrU3JjS2V5ID0gZnVuY3Rpb24gKCkgewogIHZhciB1aWQgPSAvW14uXSskLy5leGVjKGNvcmVKc0RhdGEkMSAmJiBjb3JlSnNEYXRhJDEua2V5cyAmJiBjb3JlSnNEYXRhJDEua2V5cy5JRV9QUk9UTyB8fCAnJyk7CiAgcmV0dXJuIHVpZCA/ICdTeW1ib2woc3JjKV8xLicgKyB1aWQgOiAnJzsKfSgpOwoKLyoqCiAqIENoZWNrcyBpZiBgZnVuY2AgaGFzIGl0cyBzb3VyY2UgbWFza2VkLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGBmdW5jYCBpcyBtYXNrZWQsIGVsc2UgYGZhbHNlYC4KICovCmZ1bmN0aW9uIGlzTWFza2VkKGZ1bmMpIHsKICByZXR1cm4gISFtYXNrU3JjS2V5ICYmIG1hc2tTcmNLZXkgaW4gZnVuYzsKfQoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgZnVuY1Byb3RvJDEgPSBGdW5jdGlvbi5wcm90b3R5cGU7CgovKiogVXNlZCB0byByZXNvbHZlIHRoZSBkZWNvbXBpbGVkIHNvdXJjZSBvZiBmdW5jdGlvbnMuICovCnZhciBmdW5jVG9TdHJpbmckMSA9IGZ1bmNQcm90byQxLnRvU3RyaW5nOwoKLyoqCiAqIENvbnZlcnRzIGBmdW5jYCB0byBpdHMgc291cmNlIGNvZGUuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGNvbnZlcnQuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHNvdXJjZSBjb2RlLgogKi8KZnVuY3Rpb24gdG9Tb3VyY2UoZnVuYykgewogIGlmIChmdW5jICE9IG51bGwpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBmdW5jVG9TdHJpbmckMS5jYWxsKGZ1bmMpOwogICAgfSBjYXRjaCAoZSkge30KICAgIHRyeSB7CiAgICAgIHJldHVybiBmdW5jICsgJyc7CiAgICB9IGNhdGNoIChlKSB7fQogIH0KICByZXR1cm4gJyc7Cn0KCi8qKgogKiBVc2VkIHRvIG1hdGNoIGBSZWdFeHBgCiAqIFtzeW50YXggY2hhcmFjdGVyc10oaHR0cDovL2VjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtcGF0dGVybnMpLgogKi8KdmFyIHJlUmVnRXhwQ2hhciA9IC9bXFxeJC4qKz8oKVtcXXt9fF0vZzsKCi8qKiBVc2VkIHRvIGRldGVjdCBob3N0IGNvbnN0cnVjdG9ycyAoU2FmYXJpKS4gKi8KdmFyIHJlSXNIb3N0Q3RvciA9IC9eXFtvYmplY3QgLis/Q29uc3RydWN0b3JcXSQvOwoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgZnVuY1Byb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlLAogIG9iamVjdFByb3RvJDYgPSBPYmplY3QucHJvdG90eXBlOwoKLyoqIFVzZWQgdG8gcmVzb2x2ZSB0aGUgZGVjb21waWxlZCBzb3VyY2Ugb2YgZnVuY3Rpb25zLiAqLwp2YXIgZnVuY1RvU3RyaW5nID0gZnVuY1Byb3RvLnRvU3RyaW5nOwoKLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovCnZhciBoYXNPd25Qcm9wZXJ0eSQ1ID0gb2JqZWN0UHJvdG8kNi5oYXNPd25Qcm9wZXJ0eTsKCi8qKiBVc2VkIHRvIGRldGVjdCBpZiBhIG1ldGhvZCBpcyBuYXRpdmUuICovCnZhciByZUlzTmF0aXZlID0gUmVnRXhwKCdeJyArIGZ1bmNUb1N0cmluZy5jYWxsKGhhc093blByb3BlcnR5JDUpLnJlcGxhY2UocmVSZWdFeHBDaGFyLCAnXFwkJicpLnJlcGxhY2UoL2hhc093blByb3BlcnR5fChmdW5jdGlvbikuKj8oPz1cXFwoKXwgZm9yIC4rPyg/PVxcXF0pL2csICckMS4qPycpICsgJyQnKTsKCi8qKgogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc05hdGl2ZWAgd2l0aG91dCBiYWQgc2hpbSBjaGVja3MuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIG5hdGl2ZSBmdW5jdGlvbiwKICogIGVsc2UgYGZhbHNlYC4KICovCmZ1bmN0aW9uIGJhc2VJc05hdGl2ZSh2YWx1ZSkgewogIGlmICghaXNPYmplY3QodmFsdWUpIHx8IGlzTWFza2VkKHZhbHVlKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICB2YXIgcGF0dGVybiA9IGlzRnVuY3Rpb24odmFsdWUpID8gcmVJc05hdGl2ZSA6IHJlSXNIb3N0Q3RvcjsKICByZXR1cm4gcGF0dGVybi50ZXN0KHRvU291cmNlKHZhbHVlKSk7Cn0KCi8qKgogKiBHZXRzIHRoZSB2YWx1ZSBhdCBga2V5YCBvZiBgb2JqZWN0YC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkuCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcHJvcGVydHkgdmFsdWUuCiAqLwpmdW5jdGlvbiBnZXRWYWx1ZShvYmplY3QsIGtleSkgewogIHJldHVybiBvYmplY3QgPT0gbnVsbCA/IHVuZGVmaW5lZCA6IG9iamVjdFtrZXldOwp9CgovKioKICogR2V0cyB0aGUgbmF0aXZlIGZ1bmN0aW9uIGF0IGBrZXlgIG9mIGBvYmplY3RgLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgbWV0aG9kIHRvIGdldC4KICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGZ1bmN0aW9uIGlmIGl0J3MgbmF0aXZlLCBlbHNlIGB1bmRlZmluZWRgLgogKi8KZnVuY3Rpb24gZ2V0TmF0aXZlKG9iamVjdCwga2V5KSB7CiAgdmFyIHZhbHVlID0gZ2V0VmFsdWUob2JqZWN0LCBrZXkpOwogIHJldHVybiBiYXNlSXNOYXRpdmUodmFsdWUpID8gdmFsdWUgOiB1bmRlZmluZWQ7Cn0KCi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHRoYXQgYXJlIHZlcmlmaWVkIHRvIGJlIG5hdGl2ZS4gKi8KdmFyIG5hdGl2ZUNyZWF0ZSA9IGdldE5hdGl2ZShPYmplY3QsICdjcmVhdGUnKTsKdmFyIG5hdGl2ZUNyZWF0ZSQxID0gbmF0aXZlQ3JlYXRlOwoKLyoqCiAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGhhc2guCiAqCiAqIEBwcml2YXRlCiAqIEBuYW1lIGNsZWFyCiAqIEBtZW1iZXJPZiBIYXNoCiAqLwpmdW5jdGlvbiBoYXNoQ2xlYXIoKSB7CiAgdGhpcy5fX2RhdGFfXyA9IG5hdGl2ZUNyZWF0ZSQxID8gbmF0aXZlQ3JlYXRlJDEobnVsbCkgOiB7fTsKICB0aGlzLnNpemUgPSAwOwp9CgovKioKICogUmVtb3ZlcyBga2V5YCBhbmQgaXRzIHZhbHVlIGZyb20gdGhlIGhhc2guCiAqCiAqIEBwcml2YXRlCiAqIEBuYW1lIGRlbGV0ZQogKiBAbWVtYmVyT2YgSGFzaAogKiBAcGFyYW0ge09iamVjdH0gaGFzaCBUaGUgaGFzaCB0byBtb2RpZnkuCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudHJ5IHdhcyByZW1vdmVkLCBlbHNlIGBmYWxzZWAuCiAqLwpmdW5jdGlvbiBoYXNoRGVsZXRlKGtleSkgewogIHZhciByZXN1bHQgPSB0aGlzLmhhcyhrZXkpICYmIGRlbGV0ZSB0aGlzLl9fZGF0YV9fW2tleV07CiAgdGhpcy5zaXplIC09IHJlc3VsdCA/IDEgOiAwOwogIHJldHVybiByZXN1bHQ7Cn0KCi8qKiBVc2VkIHRvIHN0YW5kLWluIGZvciBgdW5kZWZpbmVkYCBoYXNoIHZhbHVlcy4gKi8KdmFyIEhBU0hfVU5ERUZJTkVEJDEgPSAnX19sb2Rhc2hfaGFzaF91bmRlZmluZWRfXyc7CgovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCnZhciBvYmplY3RQcm90byQ1ID0gT2JqZWN0LnByb3RvdHlwZTsKCi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLwp2YXIgaGFzT3duUHJvcGVydHkkNCA9IG9iamVjdFByb3RvJDUuaGFzT3duUHJvcGVydHk7CgovKioKICogR2V0cyB0aGUgaGFzaCB2YWx1ZSBmb3IgYGtleWAuCiAqCiAqIEBwcml2YXRlCiAqIEBuYW1lIGdldAogKiBAbWVtYmVyT2YgSGFzaAogKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogKi8KZnVuY3Rpb24gaGFzaEdldChrZXkpIHsKICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgaWYgKG5hdGl2ZUNyZWF0ZSQxKSB7CiAgICB2YXIgcmVzdWx0ID0gZGF0YVtrZXldOwogICAgcmV0dXJuIHJlc3VsdCA9PT0gSEFTSF9VTkRFRklORUQkMSA/IHVuZGVmaW5lZCA6IHJlc3VsdDsKICB9CiAgcmV0dXJuIGhhc093blByb3BlcnR5JDQuY2FsbChkYXRhLCBrZXkpID8gZGF0YVtrZXldIDogdW5kZWZpbmVkOwp9CgovKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovCnZhciBvYmplY3RQcm90byQ0ID0gT2JqZWN0LnByb3RvdHlwZTsKCi8qKiBVc2VkIHRvIGNoZWNrIG9iamVjdHMgZm9yIG93biBwcm9wZXJ0aWVzLiAqLwp2YXIgaGFzT3duUHJvcGVydHkkMyA9IG9iamVjdFByb3RvJDQuaGFzT3duUHJvcGVydHk7CgovKioKICogQ2hlY2tzIGlmIGEgaGFzaCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogKgogKiBAcHJpdmF0ZQogKiBAbmFtZSBoYXMKICogQG1lbWJlck9mIEhhc2gKICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICovCmZ1bmN0aW9uIGhhc2hIYXMoa2V5KSB7CiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fOwogIHJldHVybiBuYXRpdmVDcmVhdGUkMSA/IGRhdGFba2V5XSAhPT0gdW5kZWZpbmVkIDogaGFzT3duUHJvcGVydHkkMy5jYWxsKGRhdGEsIGtleSk7Cn0KCi8qKiBVc2VkIHRvIHN0YW5kLWluIGZvciBgdW5kZWZpbmVkYCBoYXNoIHZhbHVlcy4gKi8KdmFyIEhBU0hfVU5ERUZJTkVEID0gJ19fbG9kYXNoX2hhc2hfdW5kZWZpbmVkX18nOwoKLyoqCiAqIFNldHMgdGhlIGhhc2ggYGtleWAgdG8gYHZhbHVlYC4KICoKICogQHByaXZhdGUKICogQG5hbWUgc2V0CiAqIEBtZW1iZXJPZiBIYXNoCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gc2V0LgogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBzZXQuCiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgdGhlIGhhc2ggaW5zdGFuY2UuCiAqLwpmdW5jdGlvbiBoYXNoU2V0KGtleSwgdmFsdWUpIHsKICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX187CiAgdGhpcy5zaXplICs9IHRoaXMuaGFzKGtleSkgPyAwIDogMTsKICBkYXRhW2tleV0gPSBuYXRpdmVDcmVhdGUkMSAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gSEFTSF9VTkRFRklORUQgOiB2YWx1ZTsKICByZXR1cm4gdGhpczsKfQoKLyoqCiAqIENyZWF0ZXMgYSBoYXNoIG9iamVjdC4KICoKICogQHByaXZhdGUKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLgogKi8KZnVuY3Rpb24gSGFzaChlbnRyaWVzKSB7CiAgdmFyIGluZGV4ID0gLTEsCiAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7CiAgdGhpcy5jbGVhcigpOwogIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7CiAgfQp9CgovLyBBZGQgbWV0aG9kcyB0byBgSGFzaGAuCkhhc2gucHJvdG90eXBlLmNsZWFyID0gaGFzaENsZWFyOwpIYXNoLnByb3RvdHlwZVsnZGVsZXRlJ10gPSBoYXNoRGVsZXRlOwpIYXNoLnByb3RvdHlwZS5nZXQgPSBoYXNoR2V0OwpIYXNoLnByb3RvdHlwZS5oYXMgPSBoYXNoSGFzOwpIYXNoLnByb3RvdHlwZS5zZXQgPSBoYXNoU2V0OwoKLyoqCiAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIGxpc3QgY2FjaGUuCiAqCiAqIEBwcml2YXRlCiAqIEBuYW1lIGNsZWFyCiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICovCmZ1bmN0aW9uIGxpc3RDYWNoZUNsZWFyKCkgewogIHRoaXMuX19kYXRhX18gPSBbXTsKICB0aGlzLnNpemUgPSAwOwp9CgovKioKICogUGVyZm9ybXMgYQogKiBbYFNhbWVWYWx1ZVplcm9gXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1zYW1ldmFsdWV6ZXJvKQogKiBjb21wYXJpc29uIGJldHdlZW4gdHdvIHZhbHVlcyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmUgZXF1aXZhbGVudC4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4wLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY29tcGFyZS4KICogQHBhcmFtIHsqfSBvdGhlciBUaGUgb3RoZXIgdmFsdWUgdG8gY29tcGFyZS4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSB2YWx1ZXMgYXJlIGVxdWl2YWxlbnQsIGVsc2UgYGZhbHNlYC4KICogQGV4YW1wbGUKICoKICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxIH07CiAqIHZhciBvdGhlciA9IHsgJ2EnOiAxIH07CiAqCiAqIF8uZXEob2JqZWN0LCBvYmplY3QpOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uZXEob2JqZWN0LCBvdGhlcik7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uZXEoJ2EnLCAnYScpOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uZXEoJ2EnLCBPYmplY3QoJ2EnKSk7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uZXEoTmFOLCBOYU4pOwogKiAvLyA9PiB0cnVlCiAqLwpmdW5jdGlvbiBlcSh2YWx1ZSwgb3RoZXIpIHsKICByZXR1cm4gdmFsdWUgPT09IG90aGVyIHx8IHZhbHVlICE9PSB2YWx1ZSAmJiBvdGhlciAhPT0gb3RoZXI7Cn0KCi8qKgogKiBHZXRzIHRoZSBpbmRleCBhdCB3aGljaCB0aGUgYGtleWAgaXMgZm91bmQgaW4gYGFycmF5YCBvZiBrZXktdmFsdWUgcGFpcnMuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRoZSBhcnJheSB0byBpbnNwZWN0LgogKiBAcGFyYW0geyp9IGtleSBUaGUga2V5IHRvIHNlYXJjaCBmb3IuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBtYXRjaGVkIHZhbHVlLCBlbHNlIGAtMWAuCiAqLwpmdW5jdGlvbiBhc3NvY0luZGV4T2YoYXJyYXksIGtleSkgewogIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICBpZiAoZXEoYXJyYXlbbGVuZ3RoXVswXSwga2V5KSkgewogICAgICByZXR1cm4gbGVuZ3RoOwogICAgfQogIH0KICByZXR1cm4gLTE7Cn0KCi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8KdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7CgovKiogQnVpbHQtaW4gdmFsdWUgcmVmZXJlbmNlcy4gKi8KdmFyIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlOwoKLyoqCiAqIFJlbW92ZXMgYGtleWAgYW5kIGl0cyB2YWx1ZSBmcm9tIHRoZSBsaXN0IGNhY2hlLgogKgogKiBAcHJpdmF0ZQogKiBAbmFtZSBkZWxldGUKICogQG1lbWJlck9mIExpc3RDYWNoZQogKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJlbW92ZS4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIHRoZSBlbnRyeSB3YXMgcmVtb3ZlZCwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gbGlzdENhY2hlRGVsZXRlKGtleSkgewogIHZhciBkYXRhID0gdGhpcy5fX2RhdGFfXywKICAgIGluZGV4ID0gYXNzb2NJbmRleE9mKGRhdGEsIGtleSk7CiAgaWYgKGluZGV4IDwgMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICB2YXIgbGFzdEluZGV4ID0gZGF0YS5sZW5ndGggLSAxOwogIGlmIChpbmRleCA9PSBsYXN0SW5kZXgpIHsKICAgIGRhdGEucG9wKCk7CiAgfSBlbHNlIHsKICAgIHNwbGljZS5jYWxsKGRhdGEsIGluZGV4LCAxKTsKICB9CiAgLS10aGlzLnNpemU7CiAgcmV0dXJuIHRydWU7Cn0KCi8qKgogKiBHZXRzIHRoZSBsaXN0IGNhY2hlIHZhbHVlIGZvciBga2V5YC4KICoKICogQHByaXZhdGUKICogQG5hbWUgZ2V0CiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBnZXQuCiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSBlbnRyeSB2YWx1ZS4KICovCmZ1bmN0aW9uIGxpc3RDYWNoZUdldChrZXkpIHsKICB2YXIgZGF0YSA9IHRoaXMuX19kYXRhX18sCiAgICBpbmRleCA9IGFzc29jSW5kZXhPZihkYXRhLCBrZXkpOwogIHJldHVybiBpbmRleCA8IDAgPyB1bmRlZmluZWQgOiBkYXRhW2luZGV4XVsxXTsKfQoKLyoqCiAqIENoZWNrcyBpZiBhIGxpc3QgY2FjaGUgdmFsdWUgZm9yIGBrZXlgIGV4aXN0cy4KICoKICogQHByaXZhdGUKICogQG5hbWUgaGFzCiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGFuIGVudHJ5IGZvciBga2V5YCBleGlzdHMsIGVsc2UgYGZhbHNlYC4KICovCmZ1bmN0aW9uIGxpc3RDYWNoZUhhcyhrZXkpIHsKICByZXR1cm4gYXNzb2NJbmRleE9mKHRoaXMuX19kYXRhX18sIGtleSkgPiAtMTsKfQoKLyoqCiAqIFNldHMgdGhlIGxpc3QgY2FjaGUgYGtleWAgdG8gYHZhbHVlYC4KICoKICogQHByaXZhdGUKICogQG5hbWUgc2V0CiAqIEBtZW1iZXJPZiBMaXN0Q2FjaGUKICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbGlzdCBjYWNoZSBpbnN0YW5jZS4KICovCmZ1bmN0aW9uIGxpc3RDYWNoZVNldChrZXksIHZhbHVlKSB7CiAgdmFyIGRhdGEgPSB0aGlzLl9fZGF0YV9fLAogICAgaW5kZXggPSBhc3NvY0luZGV4T2YoZGF0YSwga2V5KTsKICBpZiAoaW5kZXggPCAwKSB7CiAgICArK3RoaXMuc2l6ZTsKICAgIGRhdGEucHVzaChba2V5LCB2YWx1ZV0pOwogIH0gZWxzZSB7CiAgICBkYXRhW2luZGV4XVsxXSA9IHZhbHVlOwogIH0KICByZXR1cm4gdGhpczsKfQoKLyoqCiAqIENyZWF0ZXMgYW4gbGlzdCBjYWNoZSBvYmplY3QuCiAqCiAqIEBwcml2YXRlCiAqIEBjb25zdHJ1Y3RvcgogKiBAcGFyYW0ge0FycmF5fSBbZW50cmllc10gVGhlIGtleS12YWx1ZSBwYWlycyB0byBjYWNoZS4KICovCmZ1bmN0aW9uIExpc3RDYWNoZShlbnRyaWVzKSB7CiAgdmFyIGluZGV4ID0gLTEsCiAgICBsZW5ndGggPSBlbnRyaWVzID09IG51bGwgPyAwIDogZW50cmllcy5sZW5ndGg7CiAgdGhpcy5jbGVhcigpOwogIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICB2YXIgZW50cnkgPSBlbnRyaWVzW2luZGV4XTsKICAgIHRoaXMuc2V0KGVudHJ5WzBdLCBlbnRyeVsxXSk7CiAgfQp9CgovLyBBZGQgbWV0aG9kcyB0byBgTGlzdENhY2hlYC4KTGlzdENhY2hlLnByb3RvdHlwZS5jbGVhciA9IGxpc3RDYWNoZUNsZWFyOwpMaXN0Q2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IGxpc3RDYWNoZURlbGV0ZTsKTGlzdENhY2hlLnByb3RvdHlwZS5nZXQgPSBsaXN0Q2FjaGVHZXQ7Ckxpc3RDYWNoZS5wcm90b3R5cGUuaGFzID0gbGlzdENhY2hlSGFzOwpMaXN0Q2FjaGUucHJvdG90eXBlLnNldCA9IGxpc3RDYWNoZVNldDsKCi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHRoYXQgYXJlIHZlcmlmaWVkIHRvIGJlIG5hdGl2ZS4gKi8KdmFyIE1hcCA9IGdldE5hdGl2ZShyb290JDEsICdNYXAnKTsKdmFyIE1hcCQxID0gTWFwOwoKLyoqCiAqIFJlbW92ZXMgYWxsIGtleS12YWx1ZSBlbnRyaWVzIGZyb20gdGhlIG1hcC4KICoKICogQHByaXZhdGUKICogQG5hbWUgY2xlYXIKICogQG1lbWJlck9mIE1hcENhY2hlCiAqLwpmdW5jdGlvbiBtYXBDYWNoZUNsZWFyKCkgewogIHRoaXMuc2l6ZSA9IDA7CiAgdGhpcy5fX2RhdGFfXyA9IHsKICAgICdoYXNoJzogbmV3IEhhc2goKSwKICAgICdtYXAnOiBuZXcgKE1hcCQxIHx8IExpc3RDYWNoZSkoKSwKICAgICdzdHJpbmcnOiBuZXcgSGFzaCgpCiAgfTsKfQoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIHN1aXRhYmxlIGZvciB1c2UgYXMgdW5pcXVlIG9iamVjdCBrZXkuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBzdWl0YWJsZSwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gaXNLZXlhYmxlKHZhbHVlKSB7CiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgcmV0dXJuIHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnbnVtYmVyJyB8fCB0eXBlID09ICdzeW1ib2wnIHx8IHR5cGUgPT0gJ2Jvb2xlYW4nID8gdmFsdWUgIT09ICdfX3Byb3RvX18nIDogdmFsdWUgPT09IG51bGw7Cn0KCi8qKgogKiBHZXRzIHRoZSBkYXRhIGZvciBgbWFwYC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtPYmplY3R9IG1hcCBUaGUgbWFwIHRvIHF1ZXJ5LgogKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSByZWZlcmVuY2Uga2V5LgogKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgbWFwIGRhdGEuCiAqLwpmdW5jdGlvbiBnZXRNYXBEYXRhKG1hcCwga2V5KSB7CiAgdmFyIGRhdGEgPSBtYXAuX19kYXRhX187CiAgcmV0dXJuIGlzS2V5YWJsZShrZXkpID8gZGF0YVt0eXBlb2Yga2V5ID09ICdzdHJpbmcnID8gJ3N0cmluZycgOiAnaGFzaCddIDogZGF0YS5tYXA7Cn0KCi8qKgogKiBSZW1vdmVzIGBrZXlgIGFuZCBpdHMgdmFsdWUgZnJvbSB0aGUgbWFwLgogKgogKiBAcHJpdmF0ZQogKiBAbmFtZSBkZWxldGUKICogQG1lbWJlck9mIE1hcENhY2hlCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gcmVtb3ZlLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGVudHJ5IHdhcyByZW1vdmVkLCBlbHNlIGBmYWxzZWAuCiAqLwpmdW5jdGlvbiBtYXBDYWNoZURlbGV0ZShrZXkpIHsKICB2YXIgcmVzdWx0ID0gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpWydkZWxldGUnXShrZXkpOwogIHRoaXMuc2l6ZSAtPSByZXN1bHQgPyAxIDogMDsKICByZXR1cm4gcmVzdWx0Owp9CgovKioKICogR2V0cyB0aGUgbWFwIHZhbHVlIGZvciBga2V5YC4KICoKICogQHByaXZhdGUKICogQG5hbWUgZ2V0CiAqIEBtZW1iZXJPZiBNYXBDYWNoZQogKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGdldC4KICogQHJldHVybnMgeyp9IFJldHVybnMgdGhlIGVudHJ5IHZhbHVlLgogKi8KZnVuY3Rpb24gbWFwQ2FjaGVHZXQoa2V5KSB7CiAgcmV0dXJuIGdldE1hcERhdGEodGhpcywga2V5KS5nZXQoa2V5KTsKfQoKLyoqCiAqIENoZWNrcyBpZiBhIG1hcCB2YWx1ZSBmb3IgYGtleWAgZXhpc3RzLgogKgogKiBAcHJpdmF0ZQogKiBAbmFtZSBoYXMKICogQG1lbWJlck9mIE1hcENhY2hlCiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBhbiBlbnRyeSBmb3IgYGtleWAgZXhpc3RzLCBlbHNlIGBmYWxzZWAuCiAqLwpmdW5jdGlvbiBtYXBDYWNoZUhhcyhrZXkpIHsKICByZXR1cm4gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpLmhhcyhrZXkpOwp9CgovKioKICogU2V0cyB0aGUgbWFwIGBrZXlgIHRvIGB2YWx1ZWAuCiAqCiAqIEBwcml2YXRlCiAqIEBuYW1lIHNldAogKiBAbWVtYmVyT2YgTWFwQ2FjaGUKICogQHBhcmFtIHtzdHJpbmd9IGtleSBUaGUga2V5IG9mIHRoZSB2YWx1ZSB0byBzZXQuCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldC4KICogQHJldHVybnMge09iamVjdH0gUmV0dXJucyB0aGUgbWFwIGNhY2hlIGluc3RhbmNlLgogKi8KZnVuY3Rpb24gbWFwQ2FjaGVTZXQoa2V5LCB2YWx1ZSkgewogIHZhciBkYXRhID0gZ2V0TWFwRGF0YSh0aGlzLCBrZXkpLAogICAgc2l6ZSA9IGRhdGEuc2l6ZTsKICBkYXRhLnNldChrZXksIHZhbHVlKTsKICB0aGlzLnNpemUgKz0gZGF0YS5zaXplID09IHNpemUgPyAwIDogMTsKICByZXR1cm4gdGhpczsKfQoKLyoqCiAqIENyZWF0ZXMgYSBtYXAgY2FjaGUgb2JqZWN0IHRvIHN0b3JlIGtleS12YWx1ZSBwYWlycy4KICoKICogQHByaXZhdGUKICogQGNvbnN0cnVjdG9yCiAqIEBwYXJhbSB7QXJyYXl9IFtlbnRyaWVzXSBUaGUga2V5LXZhbHVlIHBhaXJzIHRvIGNhY2hlLgogKi8KZnVuY3Rpb24gTWFwQ2FjaGUoZW50cmllcykgewogIHZhciBpbmRleCA9IC0xLAogICAgbGVuZ3RoID0gZW50cmllcyA9PSBudWxsID8gMCA6IGVudHJpZXMubGVuZ3RoOwogIHRoaXMuY2xlYXIoKTsKICB3aGlsZSAoKytpbmRleCA8IGxlbmd0aCkgewogICAgdmFyIGVudHJ5ID0gZW50cmllc1tpbmRleF07CiAgICB0aGlzLnNldChlbnRyeVswXSwgZW50cnlbMV0pOwogIH0KfQoKLy8gQWRkIG1ldGhvZHMgdG8gYE1hcENhY2hlYC4KTWFwQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gbWFwQ2FjaGVDbGVhcjsKTWFwQ2FjaGUucHJvdG90eXBlWydkZWxldGUnXSA9IG1hcENhY2hlRGVsZXRlOwpNYXBDYWNoZS5wcm90b3R5cGUuZ2V0ID0gbWFwQ2FjaGVHZXQ7Ck1hcENhY2hlLnByb3RvdHlwZS5oYXMgPSBtYXBDYWNoZUhhczsKTWFwQ2FjaGUucHJvdG90eXBlLnNldCA9IG1hcENhY2hlU2V0OwoKLyoqIEVycm9yIG1lc3NhZ2UgY29uc3RhbnRzLiAqLwp2YXIgRlVOQ19FUlJPUl9URVhUID0gJ0V4cGVjdGVkIGEgZnVuY3Rpb24nOwoKLyoqCiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IG1lbW9pemVzIHRoZSByZXN1bHQgb2YgYGZ1bmNgLiBJZiBgcmVzb2x2ZXJgIGlzCiAqIHByb3ZpZGVkLCBpdCBkZXRlcm1pbmVzIHRoZSBjYWNoZSBrZXkgZm9yIHN0b3JpbmcgdGhlIHJlc3VsdCBiYXNlZCBvbiB0aGUKICogYXJndW1lbnRzIHByb3ZpZGVkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbi4gQnkgZGVmYXVsdCwgdGhlIGZpcnN0IGFyZ3VtZW50CiAqIHByb3ZpZGVkIHRvIHRoZSBtZW1vaXplZCBmdW5jdGlvbiBpcyB1c2VkIGFzIHRoZSBtYXAgY2FjaGUga2V5LiBUaGUgYGZ1bmNgCiAqIGlzIGludm9rZWQgd2l0aCB0aGUgYHRoaXNgIGJpbmRpbmcgb2YgdGhlIG1lbW9pemVkIGZ1bmN0aW9uLgogKgogKiAqKk5vdGU6KiogVGhlIGNhY2hlIGlzIGV4cG9zZWQgYXMgdGhlIGBjYWNoZWAgcHJvcGVydHkgb24gdGhlIG1lbW9pemVkCiAqIGZ1bmN0aW9uLiBJdHMgY3JlYXRpb24gbWF5IGJlIGN1c3RvbWl6ZWQgYnkgcmVwbGFjaW5nIHRoZSBgXy5tZW1vaXplLkNhY2hlYAogKiBjb25zdHJ1Y3RvciB3aXRoIG9uZSB3aG9zZSBpbnN0YW5jZXMgaW1wbGVtZW50IHRoZQogKiBbYE1hcGBdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXByb3BlcnRpZXMtb2YtdGhlLW1hcC1wcm90b3R5cGUtb2JqZWN0KQogKiBtZXRob2QgaW50ZXJmYWNlIG9mIGBjbGVhcmAsIGBkZWxldGVgLCBgZ2V0YCwgYGhhc2AsIGFuZCBgc2V0YC4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgMC4xLjAKICogQGNhdGVnb3J5IEZ1bmN0aW9uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGhhdmUgaXRzIG91dHB1dCBtZW1vaXplZC4KICogQHBhcmFtIHtGdW5jdGlvbn0gW3Jlc29sdmVyXSBUaGUgZnVuY3Rpb24gdG8gcmVzb2x2ZSB0aGUgY2FjaGUga2V5LgogKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBtZW1vaXplZCBmdW5jdGlvbi4KICogQGV4YW1wbGUKICoKICogdmFyIG9iamVjdCA9IHsgJ2EnOiAxLCAnYic6IDIgfTsKICogdmFyIG90aGVyID0geyAnYyc6IDMsICdkJzogNCB9OwogKgogKiB2YXIgdmFsdWVzID0gXy5tZW1vaXplKF8udmFsdWVzKTsKICogdmFsdWVzKG9iamVjdCk7CiAqIC8vID0+IFsxLCAyXQogKgogKiB2YWx1ZXMob3RoZXIpOwogKiAvLyA9PiBbMywgNF0KICoKICogb2JqZWN0LmEgPSAyOwogKiB2YWx1ZXMob2JqZWN0KTsKICogLy8gPT4gWzEsIDJdCiAqCiAqIC8vIE1vZGlmeSB0aGUgcmVzdWx0IGNhY2hlLgogKiB2YWx1ZXMuY2FjaGUuc2V0KG9iamVjdCwgWydhJywgJ2InXSk7CiAqIHZhbHVlcyhvYmplY3QpOwogKiAvLyA9PiBbJ2EnLCAnYiddCiAqCiAqIC8vIFJlcGxhY2UgYF8ubWVtb2l6ZS5DYWNoZWAuCiAqIF8ubWVtb2l6ZS5DYWNoZSA9IFdlYWtNYXA7CiAqLwpmdW5jdGlvbiBtZW1vaXplKGZ1bmMsIHJlc29sdmVyKSB7CiAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicgfHwgcmVzb2x2ZXIgIT0gbnVsbCAmJiB0eXBlb2YgcmVzb2x2ZXIgIT0gJ2Z1bmN0aW9uJykgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcihGVU5DX0VSUk9SX1RFWFQpOwogIH0KICB2YXIgbWVtb2l6ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cywKICAgICAga2V5ID0gcmVzb2x2ZXIgPyByZXNvbHZlci5hcHBseSh0aGlzLCBhcmdzKSA6IGFyZ3NbMF0sCiAgICAgIGNhY2hlID0gbWVtb2l6ZWQuY2FjaGU7CiAgICBpZiAoY2FjaGUuaGFzKGtleSkpIHsKICAgICAgcmV0dXJuIGNhY2hlLmdldChrZXkpOwogICAgfQogICAgdmFyIHJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7CiAgICBtZW1vaXplZC5jYWNoZSA9IGNhY2hlLnNldChrZXksIHJlc3VsdCkgfHwgY2FjaGU7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CiAgbWVtb2l6ZWQuY2FjaGUgPSBuZXcgKG1lbW9pemUuQ2FjaGUgfHwgTWFwQ2FjaGUpKCk7CiAgcmV0dXJuIG1lbW9pemVkOwp9CgovLyBFeHBvc2UgYE1hcENhY2hlYC4KbWVtb2l6ZS5DYWNoZSA9IE1hcENhY2hlOwoKLyoqIFVzZWQgYXMgdGhlIG1heGltdW0gbWVtb2l6ZSBjYWNoZSBzaXplLiAqLwp2YXIgTUFYX01FTU9JWkVfU0laRSA9IDUwMDsKCi8qKgogKiBBIHNwZWNpYWxpemVkIHZlcnNpb24gb2YgYF8ubWVtb2l6ZWAgd2hpY2ggY2xlYXJzIHRoZSBtZW1vaXplZCBmdW5jdGlvbidzCiAqIGNhY2hlIHdoZW4gaXQgZXhjZWVkcyBgTUFYX01FTU9JWkVfU0laRWAuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1bmMgVGhlIGZ1bmN0aW9uIHRvIGhhdmUgaXRzIG91dHB1dCBtZW1vaXplZC4KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgbWVtb2l6ZWQgZnVuY3Rpb24uCiAqLwpmdW5jdGlvbiBtZW1vaXplQ2FwcGVkKGZ1bmMpIHsKICB2YXIgcmVzdWx0ID0gbWVtb2l6ZShmdW5jLCBmdW5jdGlvbiAoa2V5KSB7CiAgICBpZiAoY2FjaGUuc2l6ZSA9PT0gTUFYX01FTU9JWkVfU0laRSkgewogICAgICBjYWNoZS5jbGVhcigpOwogICAgfQogICAgcmV0dXJuIGtleTsKICB9KTsKICB2YXIgY2FjaGUgPSByZXN1bHQuY2FjaGU7CiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqIFVzZWQgdG8gbWF0Y2ggcHJvcGVydHkgbmFtZXMgd2l0aGluIHByb3BlcnR5IHBhdGhzLiAqLwp2YXIgcmVQcm9wTmFtZSA9IC9bXi5bXF1dK3xcWyg/OigtP1xkKyg/OlwuXGQrKT8pfChbIiddKSgoPzooPyFcMilbXlxcXXxcXC4pKj8pXDIpXF18KD89KD86XC58XFtcXSkoPzpcLnxcW1xdfCQpKS9nOwoKLyoqIFVzZWQgdG8gbWF0Y2ggYmFja3NsYXNoZXMgaW4gcHJvcGVydHkgcGF0aHMuICovCnZhciByZUVzY2FwZUNoYXIgPSAvXFwoXFwpPy9nOwoKLyoqCiAqIENvbnZlcnRzIGBzdHJpbmdgIHRvIGEgcHJvcGVydHkgcGF0aCBhcnJheS4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGNvbnZlcnQuCiAqIEByZXR1cm5zIHtBcnJheX0gUmV0dXJucyB0aGUgcHJvcGVydHkgcGF0aCBhcnJheS4KICovCnZhciBzdHJpbmdUb1BhdGggPSBtZW1vaXplQ2FwcGVkKGZ1bmN0aW9uIChzdHJpbmcpIHsKICB2YXIgcmVzdWx0ID0gW107CiAgaWYgKHN0cmluZy5jaGFyQ29kZUF0KDApID09PSA0NiAvKiAuICovKSB7CiAgICByZXN1bHQucHVzaCgnJyk7CiAgfQogIHN0cmluZy5yZXBsYWNlKHJlUHJvcE5hbWUsIGZ1bmN0aW9uIChtYXRjaCwgbnVtYmVyLCBxdW90ZSwgc3ViU3RyaW5nKSB7CiAgICByZXN1bHQucHVzaChxdW90ZSA/IHN1YlN0cmluZy5yZXBsYWNlKHJlRXNjYXBlQ2hhciwgJyQxJykgOiBudW1iZXIgfHwgbWF0Y2gpOwogIH0pOwogIHJldHVybiByZXN1bHQ7Cn0pOwp2YXIgc3RyaW5nVG9QYXRoJDEgPSBzdHJpbmdUb1BhdGg7CgovKioKICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBfLm1hcGAgZm9yIGFycmF5cyB3aXRob3V0IHN1cHBvcnQgZm9yIGl0ZXJhdGVlCiAqIHNob3J0aGFuZHMuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7QXJyYXl9IFthcnJheV0gVGhlIGFycmF5IHRvIGl0ZXJhdGUgb3Zlci4KICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBuZXcgbWFwcGVkIGFycmF5LgogKi8KZnVuY3Rpb24gYXJyYXlNYXAoYXJyYXksIGl0ZXJhdGVlKSB7CiAgdmFyIGluZGV4ID0gLTEsCiAgICBsZW5ndGggPSBhcnJheSA9PSBudWxsID8gMCA6IGFycmF5Lmxlbmd0aCwKICAgIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShhcnJheVtpbmRleF0sIGluZGV4LCBhcnJheSk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwp2YXIgSU5GSU5JVFkkMiA9IDEgLyAwOwoKLyoqIFVzZWQgdG8gY29udmVydCBzeW1ib2xzIHRvIHByaW1pdGl2ZXMgYW5kIHN0cmluZ3MuICovCnZhciBzeW1ib2xQcm90byA9IFN5bWJvbCQxID8gU3ltYm9sJDEucHJvdG90eXBlIDogdW5kZWZpbmVkLAogIHN5bWJvbFRvU3RyaW5nID0gc3ltYm9sUHJvdG8gPyBzeW1ib2xQcm90by50b1N0cmluZyA6IHVuZGVmaW5lZDsKCi8qKgogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy50b1N0cmluZ2Agd2hpY2ggZG9lc24ndCBjb252ZXJ0IG51bGxpc2gKICogdmFsdWVzIHRvIGVtcHR5IHN0cmluZ3MuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIHN0cmluZy4KICovCmZ1bmN0aW9uIGJhc2VUb1N0cmluZyh2YWx1ZSkgewogIC8vIEV4aXQgZWFybHkgZm9yIHN0cmluZ3MgdG8gYXZvaWQgYSBwZXJmb3JtYW5jZSBoaXQgaW4gc29tZSBlbnZpcm9ubWVudHMuCiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykgewogICAgcmV0dXJuIHZhbHVlOwogIH0KICBpZiAoaXNBcnJheSQxKHZhbHVlKSkgewogICAgLy8gUmVjdXJzaXZlbHkgY29udmVydCB2YWx1ZXMgKHN1c2NlcHRpYmxlIHRvIGNhbGwgc3RhY2sgbGltaXRzKS4KICAgIHJldHVybiBhcnJheU1hcCh2YWx1ZSwgYmFzZVRvU3RyaW5nKSArICcnOwogIH0KICBpZiAoaXNTeW1ib2wodmFsdWUpKSB7CiAgICByZXR1cm4gc3ltYm9sVG9TdHJpbmcgPyBzeW1ib2xUb1N0cmluZy5jYWxsKHZhbHVlKSA6ICcnOwogIH0KICB2YXIgcmVzdWx0ID0gdmFsdWUgKyAnJzsKICByZXR1cm4gcmVzdWx0ID09ICcwJyAmJiAxIC8gdmFsdWUgPT0gLUlORklOSVRZJDIgPyAnLTAnIDogcmVzdWx0Owp9CgovKioKICogQ29udmVydHMgYHZhbHVlYCB0byBhIHN0cmluZy4gQW4gZW1wdHkgc3RyaW5nIGlzIHJldHVybmVkIGZvciBgbnVsbGAKICogYW5kIGB1bmRlZmluZWRgIHZhbHVlcy4gVGhlIHNpZ24gb2YgYC0wYCBpcyBwcmVzZXJ2ZWQuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDQuMC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAqIEByZXR1cm5zIHtzdHJpbmd9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBzdHJpbmcuCiAqIEBleGFtcGxlCiAqCiAqIF8udG9TdHJpbmcobnVsbCk7CiAqIC8vID0+ICcnCiAqCiAqIF8udG9TdHJpbmcoLTApOwogKiAvLyA9PiAnLTAnCiAqCiAqIF8udG9TdHJpbmcoWzEsIDIsIDNdKTsKICogLy8gPT4gJzEsMiwzJwogKi8KZnVuY3Rpb24gdG9TdHJpbmcodmFsdWUpIHsKICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogYmFzZVRvU3RyaW5nKHZhbHVlKTsKfQoKLyoqCiAqIENhc3RzIGB2YWx1ZWAgdG8gYSBwYXRoIGFycmF5IGlmIGl0J3Mgbm90IG9uZS4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICogQHBhcmFtIHtPYmplY3R9IFtvYmplY3RdIFRoZSBvYmplY3QgdG8gcXVlcnkga2V5cyBvbi4KICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBjYXN0IHByb3BlcnR5IHBhdGggYXJyYXkuCiAqLwpmdW5jdGlvbiBjYXN0UGF0aCh2YWx1ZSwgb2JqZWN0KSB7CiAgaWYgKGlzQXJyYXkkMSh2YWx1ZSkpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9CiAgcmV0dXJuIGlzS2V5KHZhbHVlLCBvYmplY3QpID8gW3ZhbHVlXSA6IHN0cmluZ1RvUGF0aCQxKHRvU3RyaW5nKHZhbHVlKSk7Cn0KCi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwp2YXIgSU5GSU5JVFkkMSA9IDEgLyAwOwoKLyoqCiAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBzdHJpbmcga2V5IGlmIGl0J3Mgbm90IGEgc3RyaW5nIG9yIHN5bWJvbC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gaW5zcGVjdC4KICogQHJldHVybnMge3N0cmluZ3xzeW1ib2x9IFJldHVybnMgdGhlIGtleS4KICovCmZ1bmN0aW9uIHRvS2V5KHZhbHVlKSB7CiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJyB8fCBpc1N5bWJvbCh2YWx1ZSkpIHsKICAgIHJldHVybiB2YWx1ZTsKICB9CiAgdmFyIHJlc3VsdCA9IHZhbHVlICsgJyc7CiAgcmV0dXJuIHJlc3VsdCA9PSAnMCcgJiYgMSAvIHZhbHVlID09IC1JTkZJTklUWSQxID8gJy0wJyA6IHJlc3VsdDsKfQoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmdldGAgd2l0aG91dCBzdXBwb3J0IGZvciBkZWZhdWx0IHZhbHVlcy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogKiBAcGFyYW0ge0FycmF5fHN0cmluZ30gcGF0aCBUaGUgcGF0aCBvZiB0aGUgcHJvcGVydHkgdG8gZ2V0LgogKiBAcmV0dXJucyB7Kn0gUmV0dXJucyB0aGUgcmVzb2x2ZWQgdmFsdWUuCiAqLwpmdW5jdGlvbiBiYXNlR2V0KG9iamVjdCwgcGF0aCkgewogIHBhdGggPSBjYXN0UGF0aChwYXRoLCBvYmplY3QpOwogIHZhciBpbmRleCA9IDAsCiAgICBsZW5ndGggPSBwYXRoLmxlbmd0aDsKICB3aGlsZSAob2JqZWN0ICE9IG51bGwgJiYgaW5kZXggPCBsZW5ndGgpIHsKICAgIG9iamVjdCA9IG9iamVjdFt0b0tleShwYXRoW2luZGV4KytdKV07CiAgfQogIHJldHVybiBpbmRleCAmJiBpbmRleCA9PSBsZW5ndGggPyBvYmplY3QgOiB1bmRlZmluZWQ7Cn0KCi8qKgogKiBHZXRzIHRoZSB2YWx1ZSBhdCBgcGF0aGAgb2YgYG9iamVjdGAuIElmIHRoZSByZXNvbHZlZCB2YWx1ZSBpcwogKiBgdW5kZWZpbmVkYCwgdGhlIGBkZWZhdWx0VmFsdWVgIGlzIHJldHVybmVkIGluIGl0cyBwbGFjZS4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgMy43LjAKICogQGNhdGVnb3J5IE9iamVjdAogKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gcXVlcnkuCiAqIEBwYXJhbSB7QXJyYXl8c3RyaW5nfSBwYXRoIFRoZSBwYXRoIG9mIHRoZSBwcm9wZXJ0eSB0byBnZXQuCiAqIEBwYXJhbSB7Kn0gW2RlZmF1bHRWYWx1ZV0gVGhlIHZhbHVlIHJldHVybmVkIGZvciBgdW5kZWZpbmVkYCByZXNvbHZlZCB2YWx1ZXMuCiAqIEByZXR1cm5zIHsqfSBSZXR1cm5zIHRoZSByZXNvbHZlZCB2YWx1ZS4KICogQGV4YW1wbGUKICoKICogdmFyIG9iamVjdCA9IHsgJ2EnOiBbeyAnYic6IHsgJ2MnOiAzIH0gfV0gfTsKICoKICogXy5nZXQob2JqZWN0LCAnYVswXS5iLmMnKTsKICogLy8gPT4gMwogKgogKiBfLmdldChvYmplY3QsIFsnYScsICcwJywgJ2InLCAnYyddKTsKICogLy8gPT4gMwogKgogKiBfLmdldChvYmplY3QsICdhLmIuYycsICdkZWZhdWx0Jyk7CiAqIC8vID0+ICdkZWZhdWx0JwogKi8KZnVuY3Rpb24gZ2V0KG9iamVjdCwgcGF0aCwgZGVmYXVsdFZhbHVlKSB7CiAgdmFyIHJlc3VsdCA9IG9iamVjdCA9PSBudWxsID8gdW5kZWZpbmVkIDogYmFzZUdldChvYmplY3QsIHBhdGgpOwogIHJldHVybiByZXN1bHQgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRWYWx1ZSA6IHJlc3VsdDsKfQoKLyoqCiAqIEEgc3BlY2lhbGl6ZWQgdmVyc2lvbiBvZiBgXy5mb3JFYWNoYCBmb3IgYXJyYXlzIHdpdGhvdXQgc3VwcG9ydCBmb3IKICogaXRlcmF0ZWUgc2hvcnRoYW5kcy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtBcnJheX0gW2FycmF5XSBUaGUgYXJyYXkgdG8gaXRlcmF0ZSBvdmVyLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgYGFycmF5YC4KICovCmZ1bmN0aW9uIGFycmF5RWFjaChhcnJheSwgaXRlcmF0ZWUpIHsKICB2YXIgaW5kZXggPSAtMSwKICAgIGxlbmd0aCA9IGFycmF5ID09IG51bGwgPyAwIDogYXJyYXkubGVuZ3RoOwogIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7CiAgICBpZiAoaXRlcmF0ZWUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpID09PSBmYWxzZSkgewogICAgICBicmVhazsKICAgIH0KICB9CiAgcmV0dXJuIGFycmF5Owp9CgovKioKICogQ3JlYXRlcyBhIGJhc2UgZnVuY3Rpb24gZm9yIG1ldGhvZHMgbGlrZSBgXy5mb3JJbmAgYW5kIGBfLmZvck93bmAuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Zyb21SaWdodF0gU3BlY2lmeSBpdGVyYXRpbmcgZnJvbSByaWdodCB0byBsZWZ0LgogKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBiYXNlIGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gY3JlYXRlQmFzZUZvcihmcm9tUmlnaHQpIHsKICByZXR1cm4gZnVuY3Rpb24gKG9iamVjdCwgaXRlcmF0ZWUsIGtleXNGdW5jKSB7CiAgICB2YXIgaW5kZXggPSAtMSwKICAgICAgaXRlcmFibGUgPSBPYmplY3Qob2JqZWN0KSwKICAgICAgcHJvcHMgPSBrZXlzRnVuYyhvYmplY3QpLAogICAgICBsZW5ndGggPSBwcm9wcy5sZW5ndGg7CiAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgdmFyIGtleSA9IHByb3BzW2Zyb21SaWdodCA/IGxlbmd0aCA6ICsraW5kZXhdOwogICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVba2V5XSwga2V5LCBpdGVyYWJsZSkgPT09IGZhbHNlKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmplY3Q7CiAgfTsKfQoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBiYXNlRm9yT3duYCB3aGljaCBpdGVyYXRlcyBvdmVyIGBvYmplY3RgCiAqIHByb3BlcnRpZXMgcmV0dXJuZWQgYnkgYGtleXNGdW5jYCBhbmQgaW52b2tlcyBgaXRlcmF0ZWVgIGZvciBlYWNoIHByb3BlcnR5LgogKiBJdGVyYXRlZSBmdW5jdGlvbnMgbWF5IGV4aXQgaXRlcmF0aW9uIGVhcmx5IGJ5IGV4cGxpY2l0bHkgcmV0dXJuaW5nIGBmYWxzZWAuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBpdGVyYXRlIG92ZXIuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAqIEBwYXJhbSB7RnVuY3Rpb259IGtleXNGdW5jIFRoZSBmdW5jdGlvbiB0byBnZXQgdGhlIGtleXMgb2YgYG9iamVjdGAuCiAqIEByZXR1cm5zIHtPYmplY3R9IFJldHVybnMgYG9iamVjdGAuCiAqLwp2YXIgYmFzZUZvciA9IGNyZWF0ZUJhc2VGb3IoKTsKdmFyIGJhc2VGb3IkMSA9IGJhc2VGb3I7CgovKioKICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8udGltZXNgIHdpdGhvdXQgc3VwcG9ydCBmb3IgaXRlcmF0ZWUgc2hvcnRoYW5kcwogKiBvciBtYXggYXJyYXkgbGVuZ3RoIGNoZWNrcy4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtudW1iZXJ9IG4gVGhlIG51bWJlciBvZiB0aW1lcyB0byBpbnZva2UgYGl0ZXJhdGVlYC4KICogQHBhcmFtIHtGdW5jdGlvbn0gaXRlcmF0ZWUgVGhlIGZ1bmN0aW9uIGludm9rZWQgcGVyIGl0ZXJhdGlvbi4KICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiByZXN1bHRzLgogKi8KZnVuY3Rpb24gYmFzZVRpbWVzKG4sIGl0ZXJhdGVlKSB7CiAgdmFyIGluZGV4ID0gLTEsCiAgICByZXN1bHQgPSBBcnJheShuKTsKICB3aGlsZSAoKytpbmRleCA8IG4pIHsKICAgIHJlc3VsdFtpbmRleF0gPSBpdGVyYXRlZShpbmRleCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8KdmFyIGFyZ3NUYWckMSA9ICdbb2JqZWN0IEFyZ3VtZW50c10nOwoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmlzQXJndW1lbnRzYC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGBhcmd1bWVudHNgIG9iamVjdCwKICovCmZ1bmN0aW9uIGJhc2VJc0FyZ3VtZW50cyh2YWx1ZSkgewogIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGJhc2VHZXRUYWcodmFsdWUpID09IGFyZ3NUYWckMTsKfQoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgb2JqZWN0UHJvdG8kMyA9IE9iamVjdC5wcm90b3R5cGU7CgovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KdmFyIGhhc093blByb3BlcnR5JDIgPSBvYmplY3RQcm90byQzLmhhc093blByb3BlcnR5OwoKLyoqIEJ1aWx0LWluIHZhbHVlIHJlZmVyZW5jZXMuICovCnZhciBwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IG9iamVjdFByb3RvJDMucHJvcGVydHlJc0VudW1lcmFibGU7CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgbGlrZWx5IGFuIGBhcmd1bWVudHNgIG9iamVjdC4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgMC4xLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGBhcmd1bWVudHNgIG9iamVjdCwKICogIGVsc2UgYGZhbHNlYC4KICogQGV4YW1wbGUKICoKICogXy5pc0FyZ3VtZW50cyhmdW5jdGlvbigpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzQXJndW1lbnRzKFsxLCAyLCAzXSk7CiAqIC8vID0+IGZhbHNlCiAqLwp2YXIgaXNBcmd1bWVudHMgPSBiYXNlSXNBcmd1bWVudHMoZnVuY3Rpb24gKCkgewogIHJldHVybiBhcmd1bWVudHM7Cn0oKSkgPyBiYXNlSXNBcmd1bWVudHMgOiBmdW5jdGlvbiAodmFsdWUpIHsKICByZXR1cm4gaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBoYXNPd25Qcm9wZXJ0eSQyLmNhbGwodmFsdWUsICdjYWxsZWUnKSAmJiAhcHJvcGVydHlJc0VudW1lcmFibGUuY2FsbCh2YWx1ZSwgJ2NhbGxlZScpOwp9Owp2YXIgaXNBcmd1bWVudHMkMSA9IGlzQXJndW1lbnRzOwoKLyoqCiAqIFRoaXMgbWV0aG9kIHJldHVybnMgYGZhbHNlYC4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4xMy4wCiAqIEBjYXRlZ29yeSBVdGlsCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGBmYWxzZWAuCiAqIEBleGFtcGxlCiAqCiAqIF8udGltZXMoMiwgXy5zdHViRmFsc2UpOwogKiAvLyA9PiBbZmFsc2UsIGZhbHNlXQogKi8KZnVuY3Rpb24gc3R1YkZhbHNlKCkgewogIHJldHVybiBmYWxzZTsKfQoKLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBleHBvcnRzYC4gKi8KdmFyIGZyZWVFeHBvcnRzJDEgPSB0eXBlb2YgZXhwb3J0cyA9PSAnb2JqZWN0JyAmJiBleHBvcnRzICYmICFleHBvcnRzLm5vZGVUeXBlICYmIGV4cG9ydHM7CgovKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYG1vZHVsZWAuICovCnZhciBmcmVlTW9kdWxlJDEgPSBmcmVlRXhwb3J0cyQxICYmIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwoKLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi8KdmFyIG1vZHVsZUV4cG9ydHMkMSA9IGZyZWVNb2R1bGUkMSAmJiBmcmVlTW9kdWxlJDEuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHMkMTsKCi8qKiBCdWlsdC1pbiB2YWx1ZSByZWZlcmVuY2VzLiAqLwp2YXIgQnVmZmVyID0gbW9kdWxlRXhwb3J0cyQxID8gcm9vdCQxLkJ1ZmZlciA6IHVuZGVmaW5lZDsKCi8qIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIGZvciB0aG9zZSB3aXRoIHRoZSBzYW1lIG5hbWUgYXMgb3RoZXIgYGxvZGFzaGAgbWV0aG9kcy4gKi8KdmFyIG5hdGl2ZUlzQnVmZmVyID0gQnVmZmVyID8gQnVmZmVyLmlzQnVmZmVyIDogdW5kZWZpbmVkOwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgYnVmZmVyLgogKgogKiBAc3RhdGljCiAqIEBtZW1iZXJPZiBfCiAqIEBzaW5jZSA0LjMuMAogKiBAY2F0ZWdvcnkgTGFuZwogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSBidWZmZXIsIGVsc2UgYGZhbHNlYC4KICogQGV4YW1wbGUKICoKICogXy5pc0J1ZmZlcihuZXcgQnVmZmVyKDIpKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzQnVmZmVyKG5ldyBVaW50OEFycmF5KDIpKTsKICogLy8gPT4gZmFsc2UKICovCnZhciBpc0J1ZmZlciA9IG5hdGl2ZUlzQnVmZmVyIHx8IHN0dWJGYWxzZTsKdmFyIGlzQnVmZmVyJDEgPSBpc0J1ZmZlcjsKCi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwp2YXIgTUFYX1NBRkVfSU5URUdFUiQxID0gOTAwNzE5OTI1NDc0MDk5MTsKCi8qKiBVc2VkIHRvIGRldGVjdCB1bnNpZ25lZCBpbnRlZ2VyIHZhbHVlcy4gKi8KdmFyIHJlSXNVaW50ID0gL14oPzowfFsxLTldXGQqKSQvOwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgYXJyYXktbGlrZSBpbmRleC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEBwYXJhbSB7bnVtYmVyfSBbbGVuZ3RoPU1BWF9TQUZFX0lOVEVHRVJdIFRoZSB1cHBlciBib3VuZHMgb2YgYSB2YWxpZCBpbmRleC4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBpbmRleCwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gaXNJbmRleCh2YWx1ZSwgbGVuZ3RoKSB7CiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7CiAgbGVuZ3RoID0gbGVuZ3RoID09IG51bGwgPyBNQVhfU0FGRV9JTlRFR0VSJDEgOiBsZW5ndGg7CiAgcmV0dXJuICEhbGVuZ3RoICYmICh0eXBlID09ICdudW1iZXInIHx8IHR5cGUgIT0gJ3N5bWJvbCcgJiYgcmVJc1VpbnQudGVzdCh2YWx1ZSkpICYmIHZhbHVlID4gLTEgJiYgdmFsdWUgJSAxID09IDAgJiYgdmFsdWUgPCBsZW5ndGg7Cn0KCi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqLwp2YXIgTUFYX1NBRkVfSU5URUdFUiA9IDkwMDcxOTkyNTQ3NDA5OTE7CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYSB2YWxpZCBhcnJheS1saWtlIGxlbmd0aC4KICoKICogKipOb3RlOioqIFRoaXMgbWV0aG9kIGlzIGxvb3NlbHkgYmFzZWQgb24KICogW2BUb0xlbmd0aGBdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLXRvbGVuZ3RoKS4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4wLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdmFsaWQgbGVuZ3RoLCBlbHNlIGBmYWxzZWAuCiAqIEBleGFtcGxlCiAqCiAqIF8uaXNMZW5ndGgoMyk7CiAqIC8vID0+IHRydWUKICoKICogXy5pc0xlbmd0aChOdW1iZXIuTUlOX1ZBTFVFKTsKICogLy8gPT4gZmFsc2UKICoKICogXy5pc0xlbmd0aChJbmZpbml0eSk7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uaXNMZW5ndGgoJzMnKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzTGVuZ3RoKHZhbHVlKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJyAmJiB2YWx1ZSA+IC0xICYmIHZhbHVlICUgMSA9PSAwICYmIHZhbHVlIDw9IE1BWF9TQUZFX0lOVEVHRVI7Cn0KCi8qKiBgT2JqZWN0I3RvU3RyaW5nYCByZXN1bHQgcmVmZXJlbmNlcy4gKi8KdmFyIGFyZ3NUYWcgPSAnW29iamVjdCBBcmd1bWVudHNdJywKICBhcnJheVRhZyA9ICdbb2JqZWN0IEFycmF5XScsCiAgYm9vbFRhZyA9ICdbb2JqZWN0IEJvb2xlYW5dJywKICBkYXRlVGFnID0gJ1tvYmplY3QgRGF0ZV0nLAogIGVycm9yVGFnID0gJ1tvYmplY3QgRXJyb3JdJywKICBmdW5jVGFnID0gJ1tvYmplY3QgRnVuY3Rpb25dJywKICBtYXBUYWcgPSAnW29iamVjdCBNYXBdJywKICBudW1iZXJUYWcgPSAnW29iamVjdCBOdW1iZXJdJywKICBvYmplY3RUYWcgPSAnW29iamVjdCBPYmplY3RdJywKICByZWdleHBUYWcgPSAnW29iamVjdCBSZWdFeHBdJywKICBzZXRUYWcgPSAnW29iamVjdCBTZXRdJywKICBzdHJpbmdUYWcgPSAnW29iamVjdCBTdHJpbmddJywKICB3ZWFrTWFwVGFnID0gJ1tvYmplY3QgV2Vha01hcF0nOwp2YXIgYXJyYXlCdWZmZXJUYWcgPSAnW29iamVjdCBBcnJheUJ1ZmZlcl0nLAogIGRhdGFWaWV3VGFnID0gJ1tvYmplY3QgRGF0YVZpZXddJywKICBmbG9hdDMyVGFnID0gJ1tvYmplY3QgRmxvYXQzMkFycmF5XScsCiAgZmxvYXQ2NFRhZyA9ICdbb2JqZWN0IEZsb2F0NjRBcnJheV0nLAogIGludDhUYWcgPSAnW29iamVjdCBJbnQ4QXJyYXldJywKICBpbnQxNlRhZyA9ICdbb2JqZWN0IEludDE2QXJyYXldJywKICBpbnQzMlRhZyA9ICdbb2JqZWN0IEludDMyQXJyYXldJywKICB1aW50OFRhZyA9ICdbb2JqZWN0IFVpbnQ4QXJyYXldJywKICB1aW50OENsYW1wZWRUYWcgPSAnW29iamVjdCBVaW50OENsYW1wZWRBcnJheV0nLAogIHVpbnQxNlRhZyA9ICdbb2JqZWN0IFVpbnQxNkFycmF5XScsCiAgdWludDMyVGFnID0gJ1tvYmplY3QgVWludDMyQXJyYXldJzsKCi8qKiBVc2VkIHRvIGlkZW50aWZ5IGB0b1N0cmluZ1RhZ2AgdmFsdWVzIG9mIHR5cGVkIGFycmF5cy4gKi8KdmFyIHR5cGVkQXJyYXlUYWdzID0ge307CnR5cGVkQXJyYXlUYWdzW2Zsb2F0MzJUYWddID0gdHlwZWRBcnJheVRhZ3NbZmxvYXQ2NFRhZ10gPSB0eXBlZEFycmF5VGFnc1tpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDE2VGFnXSA9IHR5cGVkQXJyYXlUYWdzW2ludDMyVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4VGFnXSA9IHR5cGVkQXJyYXlUYWdzW3VpbnQ4Q2xhbXBlZFRhZ10gPSB0eXBlZEFycmF5VGFnc1t1aW50MTZUYWddID0gdHlwZWRBcnJheVRhZ3NbdWludDMyVGFnXSA9IHRydWU7CnR5cGVkQXJyYXlUYWdzW2FyZ3NUYWddID0gdHlwZWRBcnJheVRhZ3NbYXJyYXlUYWddID0gdHlwZWRBcnJheVRhZ3NbYXJyYXlCdWZmZXJUYWddID0gdHlwZWRBcnJheVRhZ3NbYm9vbFRhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRhVmlld1RhZ10gPSB0eXBlZEFycmF5VGFnc1tkYXRlVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Vycm9yVGFnXSA9IHR5cGVkQXJyYXlUYWdzW2Z1bmNUYWddID0gdHlwZWRBcnJheVRhZ3NbbWFwVGFnXSA9IHR5cGVkQXJyYXlUYWdzW251bWJlclRhZ10gPSB0eXBlZEFycmF5VGFnc1tvYmplY3RUYWddID0gdHlwZWRBcnJheVRhZ3NbcmVnZXhwVGFnXSA9IHR5cGVkQXJyYXlUYWdzW3NldFRhZ10gPSB0eXBlZEFycmF5VGFnc1tzdHJpbmdUYWddID0gdHlwZWRBcnJheVRhZ3Nbd2Vha01hcFRhZ10gPSBmYWxzZTsKCi8qKgogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy5pc1R5cGVkQXJyYXlgIHdpdGhvdXQgTm9kZS5qcyBvcHRpbWl6YXRpb25zLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay4KICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgYSB0eXBlZCBhcnJheSwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gYmFzZUlzVHlwZWRBcnJheSh2YWx1ZSkgewogIHJldHVybiBpc09iamVjdExpa2UodmFsdWUpICYmIGlzTGVuZ3RoKHZhbHVlLmxlbmd0aCkgJiYgISF0eXBlZEFycmF5VGFnc1tiYXNlR2V0VGFnKHZhbHVlKV07Cn0KCi8qKgogKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvZiBgXy51bmFyeWAgd2l0aG91dCBzdXBwb3J0IGZvciBzdG9yaW5nIG1ldGFkYXRhLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBjYXAgYXJndW1lbnRzIGZvci4KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgY2FwcGVkIGZ1bmN0aW9uLgogKi8KZnVuY3Rpb24gYmFzZVVuYXJ5KGZ1bmMpIHsKICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICByZXR1cm4gZnVuYyh2YWx1ZSk7CiAgfTsKfQoKLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBleHBvcnRzYC4gKi8KdmFyIGZyZWVFeHBvcnRzID0gdHlwZW9mIGV4cG9ydHMgPT0gJ29iamVjdCcgJiYgZXhwb3J0cyAmJiAhZXhwb3J0cy5ub2RlVHlwZSAmJiBleHBvcnRzOwoKLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBtb2R1bGVgLiAqLwp2YXIgZnJlZU1vZHVsZSA9IGZyZWVFeHBvcnRzICYmIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwoKLyoqIERldGVjdCB0aGUgcG9wdWxhciBDb21tb25KUyBleHRlbnNpb24gYG1vZHVsZS5leHBvcnRzYC4gKi8KdmFyIG1vZHVsZUV4cG9ydHMgPSBmcmVlTW9kdWxlICYmIGZyZWVNb2R1bGUuZXhwb3J0cyA9PT0gZnJlZUV4cG9ydHM7CgovKiogRGV0ZWN0IGZyZWUgdmFyaWFibGUgYHByb2Nlc3NgIGZyb20gTm9kZS5qcy4gKi8KdmFyIGZyZWVQcm9jZXNzID0gbW9kdWxlRXhwb3J0cyAmJiBmcmVlR2xvYmFsJDEucHJvY2VzczsKCi8qKiBVc2VkIHRvIGFjY2VzcyBmYXN0ZXIgTm9kZS5qcyBoZWxwZXJzLiAqLwp2YXIgbm9kZVV0aWwgPSBmdW5jdGlvbiAoKSB7CiAgdHJ5IHsKICAgIC8vIFVzZSBgdXRpbC50eXBlc2AgZm9yIE5vZGUuanMgMTArLgogICAgdmFyIHR5cGVzID0gZnJlZU1vZHVsZSAmJiBmcmVlTW9kdWxlLnJlcXVpcmUgJiYgZnJlZU1vZHVsZS5yZXF1aXJlKCd1dGlsJykudHlwZXM7CiAgICBpZiAodHlwZXMpIHsKICAgICAgcmV0dXJuIHR5cGVzOwogICAgfQoKICAgIC8vIExlZ2FjeSBgcHJvY2Vzcy5iaW5kaW5nKCd1dGlsJylgIGZvciBOb2RlLmpzIDwgMTAuCiAgICByZXR1cm4gZnJlZVByb2Nlc3MgJiYgZnJlZVByb2Nlc3MuYmluZGluZyAmJiBmcmVlUHJvY2Vzcy5iaW5kaW5nKCd1dGlsJyk7CiAgfSBjYXRjaCAoZSkge30KfSgpOwp2YXIgbm9kZVV0aWwkMSA9IG5vZGVVdGlsOwoKLyogTm9kZS5qcyBoZWxwZXIgcmVmZXJlbmNlcy4gKi8KdmFyIG5vZGVJc1R5cGVkQXJyYXkgPSBub2RlVXRpbCQxICYmIG5vZGVVdGlsJDEuaXNUeXBlZEFycmF5OwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSB0eXBlZCBhcnJheS4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgMy4wLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgdHlwZWQgYXJyYXksIGVsc2UgYGZhbHNlYC4KICogQGV4YW1wbGUKICoKICogXy5pc1R5cGVkQXJyYXkobmV3IFVpbnQ4QXJyYXkpOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uaXNUeXBlZEFycmF5KFtdKTsKICogLy8gPT4gZmFsc2UKICovCnZhciBpc1R5cGVkQXJyYXkgPSBub2RlSXNUeXBlZEFycmF5ID8gYmFzZVVuYXJ5KG5vZGVJc1R5cGVkQXJyYXkpIDogYmFzZUlzVHlwZWRBcnJheTsKdmFyIGlzVHlwZWRBcnJheSQxID0gaXNUeXBlZEFycmF5OwoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgb2JqZWN0UHJvdG8kMiA9IE9iamVjdC5wcm90b3R5cGU7CgovKiogVXNlZCB0byBjaGVjayBvYmplY3RzIGZvciBvd24gcHJvcGVydGllcy4gKi8KdmFyIGhhc093blByb3BlcnR5JDEgPSBvYmplY3RQcm90byQyLmhhc093blByb3BlcnR5OwoKLyoqCiAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGhlIGVudW1lcmFibGUgcHJvcGVydHkgbmFtZXMgb2YgdGhlIGFycmF5LWxpa2UgYHZhbHVlYC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcXVlcnkuCiAqIEBwYXJhbSB7Ym9vbGVhbn0gaW5oZXJpdGVkIFNwZWNpZnkgcmV0dXJuaW5nIGluaGVyaXRlZCBwcm9wZXJ0eSBuYW1lcy4KICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICovCmZ1bmN0aW9uIGFycmF5TGlrZUtleXModmFsdWUsIGluaGVyaXRlZCkgewogIHZhciBpc0FyciA9IGlzQXJyYXkkMSh2YWx1ZSksCiAgICBpc0FyZyA9ICFpc0FyciAmJiBpc0FyZ3VtZW50cyQxKHZhbHVlKSwKICAgIGlzQnVmZiA9ICFpc0FyciAmJiAhaXNBcmcgJiYgaXNCdWZmZXIkMSh2YWx1ZSksCiAgICBpc1R5cGUgPSAhaXNBcnIgJiYgIWlzQXJnICYmICFpc0J1ZmYgJiYgaXNUeXBlZEFycmF5JDEodmFsdWUpLAogICAgc2tpcEluZGV4ZXMgPSBpc0FyciB8fCBpc0FyZyB8fCBpc0J1ZmYgfHwgaXNUeXBlLAogICAgcmVzdWx0ID0gc2tpcEluZGV4ZXMgPyBiYXNlVGltZXModmFsdWUubGVuZ3RoLCBTdHJpbmcpIDogW10sCiAgICBsZW5ndGggPSByZXN1bHQubGVuZ3RoOwogIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgaWYgKChpbmhlcml0ZWQgfHwgaGFzT3duUHJvcGVydHkkMS5jYWxsKHZhbHVlLCBrZXkpKSAmJiAhKHNraXBJbmRleGVzICYmICgKICAgIC8vIFNhZmFyaSA5IGhhcyBlbnVtZXJhYmxlIGBhcmd1bWVudHMubGVuZ3RoYCBpbiBzdHJpY3QgbW9kZS4KICAgIGtleSA9PSAnbGVuZ3RoJyB8fAogICAgLy8gTm9kZS5qcyAwLjEwIGhhcyBlbnVtZXJhYmxlIG5vbi1pbmRleCBwcm9wZXJ0aWVzIG9uIGJ1ZmZlcnMuCiAgICBpc0J1ZmYgJiYgKGtleSA9PSAnb2Zmc2V0JyB8fCBrZXkgPT0gJ3BhcmVudCcpIHx8CiAgICAvLyBQaGFudG9tSlMgMiBoYXMgZW51bWVyYWJsZSBub24taW5kZXggcHJvcGVydGllcyBvbiB0eXBlZCBhcnJheXMuCiAgICBpc1R5cGUgJiYgKGtleSA9PSAnYnVmZmVyJyB8fCBrZXkgPT0gJ2J5dGVMZW5ndGgnIHx8IGtleSA9PSAnYnl0ZU9mZnNldCcpIHx8CiAgICAvLyBTa2lwIGluZGV4IHByb3BlcnRpZXMuCiAgICBpc0luZGV4KGtleSwgbGVuZ3RoKSkpKSB7CiAgICAgIHJlc3VsdC5wdXNoKGtleSk7CiAgICB9CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KCi8qKiBVc2VkIGZvciBidWlsdC1pbiBtZXRob2QgcmVmZXJlbmNlcy4gKi8KdmFyIG9iamVjdFByb3RvJDEgPSBPYmplY3QucHJvdG90eXBlOwoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGxpa2VseSBhIHByb3RvdHlwZSBvYmplY3QuCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhIHByb3RvdHlwZSwgZWxzZSBgZmFsc2VgLgogKi8KZnVuY3Rpb24gaXNQcm90b3R5cGUodmFsdWUpIHsKICB2YXIgQ3RvciA9IHZhbHVlICYmIHZhbHVlLmNvbnN0cnVjdG9yLAogICAgcHJvdG8gPSB0eXBlb2YgQ3RvciA9PSAnZnVuY3Rpb24nICYmIEN0b3IucHJvdG90eXBlIHx8IG9iamVjdFByb3RvJDE7CiAgcmV0dXJuIHZhbHVlID09PSBwcm90bzsKfQoKLyoqCiAqIENyZWF0ZXMgYSB1bmFyeSBmdW5jdGlvbiB0aGF0IGludm9rZXMgYGZ1bmNgIHdpdGggaXRzIGFyZ3VtZW50IHRyYW5zZm9ybWVkLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byB3cmFwLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSB0cmFuc2Zvcm0gVGhlIGFyZ3VtZW50IHRyYW5zZm9ybS4KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgZnVuY3Rpb24uCiAqLwpmdW5jdGlvbiBvdmVyQXJnKGZ1bmMsIHRyYW5zZm9ybSkgewogIHJldHVybiBmdW5jdGlvbiAoYXJnKSB7CiAgICByZXR1cm4gZnVuYyh0cmFuc2Zvcm0oYXJnKSk7CiAgfTsKfQoKLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwp2YXIgbmF0aXZlS2V5cyA9IG92ZXJBcmcoT2JqZWN0LmtleXMsIE9iamVjdCk7CnZhciBuYXRpdmVLZXlzJDEgPSBuYXRpdmVLZXlzOwoKLyoqIFVzZWQgZm9yIGJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzLiAqLwp2YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoKLyoqIFVzZWQgdG8gY2hlY2sgb2JqZWN0cyBmb3Igb3duIHByb3BlcnRpZXMuICovCnZhciBoYXNPd25Qcm9wZXJ0eSA9IG9iamVjdFByb3RvLmhhc093blByb3BlcnR5OwoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmtleXNgIHdoaWNoIGRvZXNuJ3QgdHJlYXQgc3BhcnNlIGFycmF5cyBhcyBkZW5zZS4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgb2JqZWN0IHRvIHF1ZXJ5LgogKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IG9mIHByb3BlcnR5IG5hbWVzLgogKi8KZnVuY3Rpb24gYmFzZUtleXMob2JqZWN0KSB7CiAgaWYgKCFpc1Byb3RvdHlwZShvYmplY3QpKSB7CiAgICByZXR1cm4gbmF0aXZlS2V5cyQxKG9iamVjdCk7CiAgfQogIHZhciByZXN1bHQgPSBbXTsKICBmb3IgKHZhciBrZXkgaW4gT2JqZWN0KG9iamVjdCkpIHsKICAgIGlmIChoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwga2V5KSAmJiBrZXkgIT0gJ2NvbnN0cnVjdG9yJykgewogICAgICByZXN1bHQucHVzaChrZXkpOwogICAgfQogIH0KICByZXR1cm4gcmVzdWx0Owp9CgovKioKICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgYXJyYXktbGlrZS4gQSB2YWx1ZSBpcyBjb25zaWRlcmVkIGFycmF5LWxpa2UgaWYgaXQncwogKiBub3QgYSBmdW5jdGlvbiBhbmQgaGFzIGEgYHZhbHVlLmxlbmd0aGAgdGhhdCdzIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIG9yCiAqIGVxdWFsIHRvIGAwYCBhbmQgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUmAuCiAqCiAqIEBzdGF0aWMKICogQG1lbWJlck9mIF8KICogQHNpbmNlIDQuMC4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLgogKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhcnJheS1saWtlLCBlbHNlIGBmYWxzZWAuCiAqIEBleGFtcGxlCiAqCiAqIF8uaXNBcnJheUxpa2UoWzEsIDIsIDNdKTsKICogLy8gPT4gdHJ1ZQogKgogKiBfLmlzQXJyYXlMaWtlKGRvY3VtZW50LmJvZHkuY2hpbGRyZW4pOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uaXNBcnJheUxpa2UoJ2FiYycpOwogKiAvLyA9PiB0cnVlCiAqCiAqIF8uaXNBcnJheUxpa2UoXy5ub29wKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzQXJyYXlMaWtlKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgaXNMZW5ndGgodmFsdWUubGVuZ3RoKSAmJiAhaXNGdW5jdGlvbih2YWx1ZSk7Cn0KCi8qKgogKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRoZSBvd24gZW51bWVyYWJsZSBwcm9wZXJ0eSBuYW1lcyBvZiBgb2JqZWN0YC4KICoKICogKipOb3RlOioqIE5vbi1vYmplY3QgdmFsdWVzIGFyZSBjb2VyY2VkIHRvIG9iamVjdHMuIFNlZSB0aGUKICogW0VTIHNwZWNdKGh0dHA6Ly9lY21hLWludGVybmF0aW9uYWwub3JnL2VjbWEtMjYyLzcuMC8jc2VjLW9iamVjdC5rZXlzKQogKiBmb3IgbW9yZSBkZXRhaWxzLgogKgogKiBAc3RhdGljCiAqIEBzaW5jZSAwLjEuMAogKiBAbWVtYmVyT2YgXwogKiBAY2F0ZWdvcnkgT2JqZWN0CiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgVGhlIG9iamVjdCB0byBxdWVyeS4KICogQHJldHVybnMge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBvZiBwcm9wZXJ0eSBuYW1lcy4KICogQGV4YW1wbGUKICoKICogZnVuY3Rpb24gRm9vKCkgewogKiAgIHRoaXMuYSA9IDE7CiAqICAgdGhpcy5iID0gMjsKICogfQogKgogKiBGb28ucHJvdG90eXBlLmMgPSAzOwogKgogKiBfLmtleXMobmV3IEZvbyk7CiAqIC8vID0+IFsnYScsICdiJ10gKGl0ZXJhdGlvbiBvcmRlciBpcyBub3QgZ3VhcmFudGVlZCkKICoKICogXy5rZXlzKCdoaScpOwogKiAvLyA9PiBbJzAnLCAnMSddCiAqLwpmdW5jdGlvbiBrZXlzKG9iamVjdCkgewogIHJldHVybiBpc0FycmF5TGlrZShvYmplY3QpID8gYXJyYXlMaWtlS2V5cyhvYmplY3QpIDogYmFzZUtleXMob2JqZWN0KTsKfQoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLmZvck93bmAgd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IFRoZSBvYmplY3QgdG8gaXRlcmF0ZSBvdmVyLgogKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRlZSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIGBvYmplY3RgLgogKi8KZnVuY3Rpb24gYmFzZUZvck93bihvYmplY3QsIGl0ZXJhdGVlKSB7CiAgcmV0dXJuIG9iamVjdCAmJiBiYXNlRm9yJDEob2JqZWN0LCBpdGVyYXRlZSwga2V5cyk7Cn0KCi8qKgogKiBDcmVhdGVzIGEgYGJhc2VFYWNoYCBvciBgYmFzZUVhY2hSaWdodGAgZnVuY3Rpb24uCiAqCiAqIEBwcml2YXRlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGVhY2hGdW5jIFRoZSBmdW5jdGlvbiB0byBpdGVyYXRlIG92ZXIgYSBjb2xsZWN0aW9uLgogKiBAcGFyYW0ge2Jvb2xlYW59IFtmcm9tUmlnaHRdIFNwZWNpZnkgaXRlcmF0aW5nIGZyb20gcmlnaHQgdG8gbGVmdC4KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgYmFzZSBmdW5jdGlvbi4KICovCmZ1bmN0aW9uIGNyZWF0ZUJhc2VFYWNoKGVhY2hGdW5jLCBmcm9tUmlnaHQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGl0ZXJhdGVlKSB7CiAgICBpZiAoY29sbGVjdGlvbiA9PSBudWxsKSB7CiAgICAgIHJldHVybiBjb2xsZWN0aW9uOwogICAgfQogICAgaWYgKCFpc0FycmF5TGlrZShjb2xsZWN0aW9uKSkgewogICAgICByZXR1cm4gZWFjaEZ1bmMoY29sbGVjdGlvbiwgaXRlcmF0ZWUpOwogICAgfQogICAgdmFyIGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoLAogICAgICBpbmRleCA9IGZyb21SaWdodCA/IGxlbmd0aCA6IC0xLAogICAgICBpdGVyYWJsZSA9IE9iamVjdChjb2xsZWN0aW9uKTsKICAgIHdoaWxlIChmcm9tUmlnaHQgPyBpbmRleC0tIDogKytpbmRleCA8IGxlbmd0aCkgewogICAgICBpZiAoaXRlcmF0ZWUoaXRlcmFibGVbaW5kZXhdLCBpbmRleCwgaXRlcmFibGUpID09PSBmYWxzZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY29sbGVjdGlvbjsKICB9Owp9CgovKioKICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uZm9yRWFjaGAgd2l0aG91dCBzdXBwb3J0IGZvciBpdGVyYXRlZSBzaG9ydGhhbmRzLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuCiAqIEBwYXJhbSB7RnVuY3Rpb259IGl0ZXJhdGVlIFRoZSBmdW5jdGlvbiBpbnZva2VkIHBlciBpdGVyYXRpb24uCiAqIEByZXR1cm5zIHtBcnJheXxPYmplY3R9IFJldHVybnMgYGNvbGxlY3Rpb25gLgogKi8KdmFyIGJhc2VFYWNoID0gY3JlYXRlQmFzZUVhY2goYmFzZUZvck93bik7CnZhciBiYXNlRWFjaCQxID0gYmFzZUVhY2g7CgovKioKICogVGhpcyBtZXRob2QgcmV0dXJucyB0aGUgZmlyc3QgYXJndW1lbnQgaXQgcmVjZWl2ZXMuCiAqCiAqIEBzdGF0aWMKICogQHNpbmNlIDAuMS4wCiAqIEBtZW1iZXJPZiBfCiAqIEBjYXRlZ29yeSBVdGlsCiAqIEBwYXJhbSB7Kn0gdmFsdWUgQW55IHZhbHVlLgogKiBAcmV0dXJucyB7Kn0gUmV0dXJucyBgdmFsdWVgLgogKiBAZXhhbXBsZQogKgogKiB2YXIgb2JqZWN0ID0geyAnYSc6IDEgfTsKICoKICogY29uc29sZS5sb2coXy5pZGVudGl0eShvYmplY3QpID09PSBvYmplY3QpOwogKiAvLyA9PiB0cnVlCiAqLwpmdW5jdGlvbiBpZGVudGl0eSh2YWx1ZSkgewogIHJldHVybiB2YWx1ZTsKfQoKLyoqCiAqIENhc3RzIGB2YWx1ZWAgdG8gYGlkZW50aXR5YCBpZiBpdCdzIG5vdCBhIGZ1bmN0aW9uLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBpbnNwZWN0LgogKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgY2FzdCBmdW5jdGlvbi4KICovCmZ1bmN0aW9uIGNhc3RGdW5jdGlvbih2YWx1ZSkgewogIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlIDogaWRlbnRpdHk7Cn0KCi8qKgogKiBJdGVyYXRlcyBvdmVyIGVsZW1lbnRzIG9mIGBjb2xsZWN0aW9uYCBhbmQgaW52b2tlcyBgaXRlcmF0ZWVgIGZvciBlYWNoIGVsZW1lbnQuCiAqIFRoZSBpdGVyYXRlZSBpcyBpbnZva2VkIHdpdGggdGhyZWUgYXJndW1lbnRzOiAodmFsdWUsIGluZGV4fGtleSwgY29sbGVjdGlvbikuCiAqIEl0ZXJhdGVlIGZ1bmN0aW9ucyBtYXkgZXhpdCBpdGVyYXRpb24gZWFybHkgYnkgZXhwbGljaXRseSByZXR1cm5pbmcgYGZhbHNlYC4KICoKICogKipOb3RlOioqIEFzIHdpdGggb3RoZXIgIkNvbGxlY3Rpb25zIiBtZXRob2RzLCBvYmplY3RzIHdpdGggYSAibGVuZ3RoIgogKiBwcm9wZXJ0eSBhcmUgaXRlcmF0ZWQgbGlrZSBhcnJheXMuIFRvIGF2b2lkIHRoaXMgYmVoYXZpb3IgdXNlIGBfLmZvckluYAogKiBvciBgXy5mb3JPd25gIGZvciBvYmplY3QgaXRlcmF0aW9uLgogKgogKiBAc3RhdGljCiAqIEBtZW1iZXJPZiBfCiAqIEBzaW5jZSAwLjEuMAogKiBAYWxpYXMgZWFjaAogKiBAY2F0ZWdvcnkgQ29sbGVjdGlvbgogKiBAcGFyYW0ge0FycmF5fE9iamVjdH0gY29sbGVjdGlvbiBUaGUgY29sbGVjdGlvbiB0byBpdGVyYXRlIG92ZXIuCiAqIEBwYXJhbSB7RnVuY3Rpb259IFtpdGVyYXRlZT1fLmlkZW50aXR5XSBUaGUgZnVuY3Rpb24gaW52b2tlZCBwZXIgaXRlcmF0aW9uLgogKiBAcmV0dXJucyB7QXJyYXl8T2JqZWN0fSBSZXR1cm5zIGBjb2xsZWN0aW9uYC4KICogQHNlZSBfLmZvckVhY2hSaWdodAogKiBAZXhhbXBsZQogKgogKiBfLmZvckVhY2goWzEsIDJdLCBmdW5jdGlvbih2YWx1ZSkgewogKiAgIGNvbnNvbGUubG9nKHZhbHVlKTsKICogfSk7CiAqIC8vID0+IExvZ3MgYDFgIHRoZW4gYDJgLgogKgogKiBfLmZvckVhY2goeyAnYSc6IDEsICdiJzogMiB9LCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7CiAqICAgY29uc29sZS5sb2coa2V5KTsKICogfSk7CiAqIC8vID0+IExvZ3MgJ2EnIHRoZW4gJ2InIChpdGVyYXRpb24gb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQpLgogKi8KZnVuY3Rpb24gZm9yRWFjaChjb2xsZWN0aW9uLCBpdGVyYXRlZSkgewogIHZhciBmdW5jID0gaXNBcnJheSQxKGNvbGxlY3Rpb24pID8gYXJyYXlFYWNoIDogYmFzZUVhY2gkMTsKICByZXR1cm4gZnVuYyhjb2xsZWN0aW9uLCBjYXN0RnVuY3Rpb24oaXRlcmF0ZWUpKTsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrrlrZfkuLINCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc3N0ci50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNzdHIoMCkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzc3RyKCcwJykpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNzdHIoJycpKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqLwpmdW5jdGlvbiBpc3N0cih2KSB7CiAgbGV0IGMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodik7CiAgcmV0dXJuIGMgPT09ICdbb2JqZWN0IFN0cmluZ10nOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuuacieaViOWtl+S4sg0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzZXN0ci50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNlc3RyKCcxLjI1JykpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNlc3RyKDEyNSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzZXN0cignJykpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqLwpmdW5jdGlvbiBpc2VzdHIodikgewogIC8vY2hlY2sKICBpZiAoaXNzdHIodikpIHsKICAgIGlmICh2ICE9PSAnJykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuumZo+WIlw0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzYXJyLnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc2FycihbXSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNhcnIoW3t9XSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzYXJyKHYpIHsKICBsZXQgYyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KTsKICByZXR1cm4gYyA9PT0gJ1tvYmplY3QgQXJyYXldJzsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrp1bmRlZmluZWQNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc3VuZGVmaW5lZC50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXN1bmRlZmluZWQodW5kZWZpbmVkKSkNCiAqIC8vID0+IHRydWUNCiAqDQogKi8KZnVuY3Rpb24gaXN1bmRlZmluZWQodikgewogIGxldCBjID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHYpOwogIHJldHVybiBjID09PSAnW29iamVjdCBVbmRlZmluZWRdJzsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrpudWxsDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvaXNudWxsLnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc251bGwobnVsbCkpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzbnVsbCh2KSB7CiAgbGV0IGMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodik7CiAgcmV0dXJuIGMgPT09ICdbb2JqZWN0IE51bGxdJzsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrrnianku7YNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc29iai50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNvYmooe30pKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzb2JqKHsgYTogMTIzIH0pKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqLwpmdW5jdGlvbiBpc29iaih2KSB7CiAgbGV0IGMgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodik7CiAgcmV0dXJuIGMgPT09ICdbb2JqZWN0IE9iamVjdF0nOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuuepuueJqeS7tg0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzb2JqMC50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNvYmowKHt9KSkNCiAqIC8vID0+IHRydWUNCiAqDQogKiBjb25zb2xlLmxvZyhpc29iajAoeyBhOiAxMjMgfSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqLwpmdW5jdGlvbiBpc29iajAodikgewogIGlmIChpc29iaih2KSkgewogICAgZm9yIChsZXQgayBpbiB2KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICByZXR1cm4gZmFsc2U7Cn0KCi8qKg0KICog5Yik5pa35piv5ZCm54K656m65a2X5LiyDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvaXNzdHIwLnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc3N0cjAoJycpKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzc3RyMCgnMCcpKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBjb25zb2xlLmxvZyhpc3N0cjAoJ2FiYzEyNScpKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKi8KZnVuY3Rpb24gaXNzdHIwKHYpIHsKICBpZiAoaXNzdHIodikpIHsKICAgIGlmICh2ID09PSAnJykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuueEoeWFp+WuuemZo+WIlw0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzYXJyMC50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNhcnIoW10pKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzYXJyKFt7fV0pKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKi8KZnVuY3Rpb24gaXNhcnIwKHYpIHsKICBpZiAoaXNhcnIodikpIHsKICAgIGlmICh2Lmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CgovLyBpbXBvcnQgaXNOYU4gZnJvbSAnbG9kYXNoLWVzL2lzTmFOLmpzJwoKLyoqDQogKiDliKTmlrfmmK/lkKbngrpOYU4NCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc25hbi50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNuYW4oTmFOKSkNCiAqIC8vID0+IHRydWUNCiAqDQogKi8KZnVuY3Rpb24gaXNuYW4odikgewogIC8vIHJldHVybiBpc05hTih2KQogIHJldHVybiB2ICE9PSB2Owp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuuW7o+e+qeeEoeaViA0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzZXIudGVzdC5tanMgR2l0aHVifQ0KICogQG1lbWJlck9mIHdzZW1pDQogKiBAcGFyYW0geyp9IHYg6Ly45YWl5Lu75oSP6LOH5paZDQogKiBAcmV0dXJucyB7Qm9vbGVhbn0g5Zue5YKz5Yik5pa35biD5p6X5YC8DQogKiBAZXhhbXBsZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzZXIoJzEyYTUnKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICogY29uc29sZS5sb2coaXNlcignJykpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNlcihbXSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNlcihbe31dKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICogY29uc29sZS5sb2coaXNlcihbJyddKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICogY29uc29sZS5sb2coaXNlcih7fSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNlcihudWxsKSkNCiAqIC8vID0+IHRydWUNCiAqDQogKiBjb25zb2xlLmxvZyhpc2VyKHVuZGVmaW5lZCkpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNlcihOYU4pKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqLwpmdW5jdGlvbiBpc2VyKHYpIHsKICBpZiAoaXN1bmRlZmluZWQodikpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoaXNudWxsKHYpKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKGlzb2JqMCh2KSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGlmIChpc3N0cjAodikpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAoaXNhcnIwKHYpKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgaWYgKGlzbmFuKHYpKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuuacieaViOmZo+WIl++8jOmVt+W6puiHs+WwkeWkp+aWvOetieaWvDHvvIzlkITlhYPntKDoh7PlsJHnmobngrrmnInmlYgNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc2VhcnIudGVzdC5tanMgR2l0aHVifQ0KICogQG1lbWJlck9mIHdzZW1pDQogKiBAcGFyYW0geyp9IHYg6Ly45YWl5Lu75oSP6LOH5paZDQogKiBAcmV0dXJucyB7Qm9vbGVhbn0g5Zue5YKz5Yik5pa35biD5p6X5YC8DQogKiBAZXhhbXBsZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzZWFycihbe31dKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICogY29uc29sZS5sb2coaXNlYXJyKFt7IGE6IDEyMyB9XSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzZWFycih2KSB7CiAgLy9jaGVjawogIGlmICghaXNhcnIodikpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vY2hlY2sgbGVuZ3RoCiAgaWYgKHYubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvL2NoZWNrIGxlbmd0aD0xCiAgaWYgKHYubGVuZ3RoID09PSAxKSB7CiAgICBpZiAoaXNlcih2WzBdKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCulByb21pc2UNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc3BtLnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc3BtKCcxLjI1JykpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzcG0obmV3IFByb21pc2UoZnVuY3Rpb24oKSB7fSkpKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqLwpmdW5jdGlvbiBpc3BtKHYpIHsKICBsZXQgYjsKICBsZXQgYyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KTsKICBiID0gYyA9PT0gJ1tvYmplY3QgUHJvbWlzZV0nOwogIGlmIChiKSB7CiAgICByZXR1cm4gdHJ1ZTsgLy/oi6Xngrpbb2JqZWN0IFByb21pc2Vd5YmH55u05o6l5Zue5YKzdHJ1ZQogIH0KICBpZiAoYyAhPT0gJ1tvYmplY3QgRnVuY3Rpb25dJykgewogICAgcmV0dXJuIGZhbHNlOyAvL+iLpeS4jeaYr1tvYmplY3QgUHJvbWlzZV3kuZ/kuI3mmK9bb2JqZWN0IEZ1bmN0aW9uXeWJh+ebtOaOpeWbnuWCs2ZhbHNlCiAgfQogIHRyeSB7CiAgICBiID0gdHlwZW9mIHYuc3Vic2NyaWJlICE9PSAnZnVuY3Rpb24nICYmIHR5cGVvZiB2LnRoZW4gPT09ICdmdW5jdGlvbic7IC8v5Y+v5YG15risYXN5bmMgZnVuY3Rpb24KICB9IGNhdGNoIChlcnIpIHt9CiAgcmV0dXJuIGI7Cn0KCi8qKiBVc2VkIHRvIG1hdGNoIGEgc2luZ2xlIHdoaXRlc3BhY2UgY2hhcmFjdGVyLiAqLwp2YXIgcmVXaGl0ZXNwYWNlID0gL1xzLzsKCi8qKgogKiBVc2VkIGJ5IGBfLnRyaW1gIGFuZCBgXy50cmltRW5kYCB0byBnZXQgdGhlIGluZGV4IG9mIHRoZSBsYXN0IG5vbi13aGl0ZXNwYWNlCiAqIGNoYXJhY3RlciBvZiBgc3RyaW5nYC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtzdHJpbmd9IHN0cmluZyBUaGUgc3RyaW5nIHRvIGluc3BlY3QuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBsYXN0IG5vbi13aGl0ZXNwYWNlIGNoYXJhY3Rlci4KICovCmZ1bmN0aW9uIHRyaW1tZWRFbmRJbmRleChzdHJpbmcpIHsKICB2YXIgaW5kZXggPSBzdHJpbmcubGVuZ3RoOwogIHdoaWxlIChpbmRleC0tICYmIHJlV2hpdGVzcGFjZS50ZXN0KHN0cmluZy5jaGFyQXQoaW5kZXgpKSkge30KICByZXR1cm4gaW5kZXg7Cn0KCi8qKiBVc2VkIHRvIG1hdGNoIGxlYWRpbmcgd2hpdGVzcGFjZS4gKi8KdmFyIHJlVHJpbVN0YXJ0ID0gL15ccysvOwoKLyoqCiAqIFRoZSBiYXNlIGltcGxlbWVudGF0aW9uIG9mIGBfLnRyaW1gLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge3N0cmluZ30gc3RyaW5nIFRoZSBzdHJpbmcgdG8gdHJpbS4KICogQHJldHVybnMge3N0cmluZ30gUmV0dXJucyB0aGUgdHJpbW1lZCBzdHJpbmcuCiAqLwpmdW5jdGlvbiBiYXNlVHJpbShzdHJpbmcpIHsKICByZXR1cm4gc3RyaW5nID8gc3RyaW5nLnNsaWNlKDAsIHRyaW1tZWRFbmRJbmRleChzdHJpbmcpICsgMSkucmVwbGFjZShyZVRyaW1TdGFydCwgJycpIDogc3RyaW5nOwp9CgovKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB2YXJpb3VzIGBOdW1iZXJgIGNvbnN0YW50cy4gKi8KdmFyIE5BTiA9IDAgLyAwOwoKLyoqIFVzZWQgdG8gZGV0ZWN0IGJhZCBzaWduZWQgaGV4YWRlY2ltYWwgc3RyaW5nIHZhbHVlcy4gKi8KdmFyIHJlSXNCYWRIZXggPSAvXlstK10weFswLTlhLWZdKyQvaTsKCi8qKiBVc2VkIHRvIGRldGVjdCBiaW5hcnkgc3RyaW5nIHZhbHVlcy4gKi8KdmFyIHJlSXNCaW5hcnkgPSAvXjBiWzAxXSskL2k7CgovKiogVXNlZCB0byBkZXRlY3Qgb2N0YWwgc3RyaW5nIHZhbHVlcy4gKi8KdmFyIHJlSXNPY3RhbCA9IC9eMG9bMC03XSskL2k7CgovKiogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgd2l0aG91dCBhIGRlcGVuZGVuY3kgb24gYHJvb3RgLiAqLwp2YXIgZnJlZVBhcnNlSW50ID0gcGFyc2VJbnQ7CgovKioKICogQ29udmVydHMgYHZhbHVlYCB0byBhIG51bWJlci4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4wLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gcHJvY2Vzcy4KICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgbnVtYmVyLgogKiBAZXhhbXBsZQogKgogKiBfLnRvTnVtYmVyKDMuMik7CiAqIC8vID0+IDMuMgogKgogKiBfLnRvTnVtYmVyKE51bWJlci5NSU5fVkFMVUUpOwogKiAvLyA9PiA1ZS0zMjQKICoKICogXy50b051bWJlcihJbmZpbml0eSk7CiAqIC8vID0+IEluZmluaXR5CiAqCiAqIF8udG9OdW1iZXIoJzMuMicpOwogKiAvLyA9PiAzLjIKICovCmZ1bmN0aW9uIHRvTnVtYmVyKHZhbHVlKSB7CiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykgewogICAgcmV0dXJuIHZhbHVlOwogIH0KICBpZiAoaXNTeW1ib2wodmFsdWUpKSB7CiAgICByZXR1cm4gTkFOOwogIH0KICBpZiAoaXNPYmplY3QodmFsdWUpKSB7CiAgICB2YXIgb3RoZXIgPSB0eXBlb2YgdmFsdWUudmFsdWVPZiA9PSAnZnVuY3Rpb24nID8gdmFsdWUudmFsdWVPZigpIDogdmFsdWU7CiAgICB2YWx1ZSA9IGlzT2JqZWN0KG90aGVyKSA/IG90aGVyICsgJycgOiBvdGhlcjsKICB9CiAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgewogICAgcmV0dXJuIHZhbHVlID09PSAwID8gdmFsdWUgOiArdmFsdWU7CiAgfQogIHZhbHVlID0gYmFzZVRyaW0odmFsdWUpOwogIHZhciBpc0JpbmFyeSA9IHJlSXNCaW5hcnkudGVzdCh2YWx1ZSk7CiAgcmV0dXJuIGlzQmluYXJ5IHx8IHJlSXNPY3RhbC50ZXN0KHZhbHVlKSA/IGZyZWVQYXJzZUludCh2YWx1ZS5zbGljZSgyKSwgaXNCaW5hcnkgPyAyIDogOCkgOiByZUlzQmFkSGV4LnRlc3QodmFsdWUpID8gTkFOIDogK3ZhbHVlOwp9CgovKiogVXNlZCBhcyByZWZlcmVuY2VzIGZvciB2YXJpb3VzIGBOdW1iZXJgIGNvbnN0YW50cy4gKi8KdmFyIElORklOSVRZID0gMSAvIDAsCiAgTUFYX0lOVEVHRVIgPSAxLjc5NzY5MzEzNDg2MjMxNTdlKzMwODsKCi8qKgogKiBDb252ZXJ0cyBgdmFsdWVgIHRvIGEgZmluaXRlIG51bWJlci4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4xMi4wCiAqIEBjYXRlZ29yeSBMYW5nCiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNvbnZlcnQuCiAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIGNvbnZlcnRlZCBudW1iZXIuCiAqIEBleGFtcGxlCiAqCiAqIF8udG9GaW5pdGUoMy4yKTsKICogLy8gPT4gMy4yCiAqCiAqIF8udG9GaW5pdGUoTnVtYmVyLk1JTl9WQUxVRSk7CiAqIC8vID0+IDVlLTMyNAogKgogKiBfLnRvRmluaXRlKEluZmluaXR5KTsKICogLy8gPT4gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDgKICoKICogXy50b0Zpbml0ZSgnMy4yJyk7CiAqIC8vID0+IDMuMgogKi8KZnVuY3Rpb24gdG9GaW5pdGUodmFsdWUpIHsKICBpZiAoIXZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgPT09IDAgPyB2YWx1ZSA6IDA7CiAgfQogIHZhbHVlID0gdG9OdW1iZXIodmFsdWUpOwogIGlmICh2YWx1ZSA9PT0gSU5GSU5JVFkgfHwgdmFsdWUgPT09IC1JTkZJTklUWSkgewogICAgdmFyIHNpZ24gPSB2YWx1ZSA8IDAgPyAtMSA6IDE7CiAgICByZXR1cm4gc2lnbiAqIE1BWF9JTlRFR0VSOwogIH0KICByZXR1cm4gdmFsdWUgPT09IHZhbHVlID8gdmFsdWUgOiAwOwp9CgovKioKICogQ29udmVydHMgYHZhbHVlYCB0byBhbiBpbnRlZ2VyLgogKgogKiAqKk5vdGU6KiogVGhpcyBtZXRob2QgaXMgbG9vc2VseSBiYXNlZCBvbgogKiBbYFRvSW50ZWdlcmBdKGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy10b2ludGVnZXIpLgogKgogKiBAc3RhdGljCiAqIEBtZW1iZXJPZiBfCiAqIEBzaW5jZSA0LjAuMAogKiBAY2F0ZWdvcnkgTGFuZwogKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjb252ZXJ0LgogKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBjb252ZXJ0ZWQgaW50ZWdlci4KICogQGV4YW1wbGUKICoKICogXy50b0ludGVnZXIoMy4yKTsKICogLy8gPT4gMwogKgogKiBfLnRvSW50ZWdlcihOdW1iZXIuTUlOX1ZBTFVFKTsKICogLy8gPT4gMAogKgogKiBfLnRvSW50ZWdlcihJbmZpbml0eSk7CiAqIC8vID0+IDEuNzk3NjkzMTM0ODYyMzE1N2UrMzA4CiAqCiAqIF8udG9JbnRlZ2VyKCczLjInKTsKICogLy8gPT4gMwogKi8KZnVuY3Rpb24gdG9JbnRlZ2VyKHZhbHVlKSB7CiAgdmFyIHJlc3VsdCA9IHRvRmluaXRlKHZhbHVlKSwKICAgIHJlbWFpbmRlciA9IHJlc3VsdCAlIDE7CiAgcmV0dXJuIHJlc3VsdCA9PT0gcmVzdWx0ID8gcmVtYWluZGVyID8gcmVzdWx0IC0gcmVtYWluZGVyIDogcmVzdWx0IDogMDsKfQoKLyoqCiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGFuIGludGVnZXIuCiAqCiAqICoqTm90ZToqKiBUaGlzIG1ldGhvZCBpcyBiYXNlZCBvbgogKiBbYE51bWJlci5pc0ludGVnZXJgXShodHRwczovL21kbi5pby9OdW1iZXIvaXNJbnRlZ2VyKS4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgNC4wLjAKICogQGNhdGVnb3J5IExhbmcKICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suCiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGFuIGludGVnZXIsIGVsc2UgYGZhbHNlYC4KICogQGV4YW1wbGUKICoKICogXy5pc0ludGVnZXIoMyk7CiAqIC8vID0+IHRydWUKICoKICogXy5pc0ludGVnZXIoTnVtYmVyLk1JTl9WQUxVRSk7CiAqIC8vID0+IGZhbHNlCiAqCiAqIF8uaXNJbnRlZ2VyKEluZmluaXR5KTsKICogLy8gPT4gZmFsc2UKICoKICogXy5pc0ludGVnZXIoJzMnKTsKICogLy8gPT4gZmFsc2UKICovCmZ1bmN0aW9uIGlzSW50ZWdlcih2YWx1ZSkgewogIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicgJiYgdmFsdWUgPT0gdG9JbnRlZ2VyKHZhbHVlKTsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrrmlbjlrZcNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc25ici50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNuYnIoMS4yNSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNuYnIoJzEuMjUnKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICovCmZ1bmN0aW9uIGlzbmJyKHYpIHsKICBsZXQgYyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KTsKICByZXR1cm4gYyA9PT0gJ1tvYmplY3QgTnVtYmVyXSc7Cn0KCi8qKg0KICog5Yik5pa35piv5ZCm54K65pW45a2XDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvaXNudW0udGVzdC5tanMgR2l0aHVifQ0KICogQG1lbWJlck9mIHdzZW1pDQogKiBAcGFyYW0geyp9IHYg6Ly45YWl5Lu75oSP6LOH5paZDQogKiBAcmV0dXJucyB7Qm9vbGVhbn0g5Zue5YKz5Yik5pa35biD5p6X5YC8DQogKiBAZXhhbXBsZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzbnVtKDApKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzbnVtKDEuMjUpKQ0KICogLy8gPT4gdHJ1ZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzbnVtKCctMTI1JykpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzbnVtKHYpIHsKICBsZXQgYiA9IGZhbHNlOwogIGlmIChpc2VzdHIodikpIHsKICAgIGIgPSAhaXNOYU4oTnVtYmVyKHYpKTsKICB9IGVsc2UgaWYgKGlzbmJyKHYpKSB7CiAgICAvL+azqOaEj05hTueCuk51bWJlciwg5pWFaXNuYnLlm57lgrN0cnVlCiAgICBpZiAoaXNuYW4odikpIHsKICAgICAgcmV0dXJuIGZhbHNlOyAvL+atpOiZleWIpOWumueCuuacieaViOaVuOWtlywg5pWFTmFO6aCI5YmU6ZmkCiAgICB9IGVsc2UgewogICAgICBiID0gdHJ1ZTsKICAgIH0KICB9CiAgcmV0dXJuIGI7Cn0KCi8qKg0KICog5pW45a2X5oiW5a2X5Liy6L2J5rWu6bue5pW4DQogKiDoi6XovLjlhaXpnZ7mlbjlrZfliYflm57lgrMwDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvY2RibC50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gdiDovLjlhaXmlbjlrZfmiJblrZfkuLINCiAqIEByZXR1cm5zIHtOdW1iZXJ9IOWbnuWCs+aVuOWtlw0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhjZGJsKCcyNScpKQ0KICogLy8gPT4gMjUNCiAqDQogKi8KZnVuY3Rpb24gY2RibCh2KSB7CiAgLy9jaGVjawogIGlmICghaXNudW0odikpIHsKICAgIHJldHVybiAwOwogIH0KICBsZXQgciA9IHRvRmluaXRlKHYpOwogIHJldHVybiByOwp9CgovKioNCiAqIOWIpOaWt+aYr+WQpueCuuaVtOaVuA0KICoNCiAqIFVuaXQgVGVzdDoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS95dWRhLWx5dS93c2VtaS9ibG9iL21hc3Rlci90ZXN0L2lzaW50LnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc2ludCgnMS4yNScpKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBjb25zb2xlLmxvZyhpc2ludCgnMTI1JykpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNpbnQoMS4yNSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzaW50KDEyNSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzaW50KHYpIHsKICBpZiAoaXNudW0odikpIHsKICAgIHYgPSBjZGJsKHYpOwogICAgcmV0dXJuIGlzSW50ZWdlcih2KTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqLwp2YXIgbmF0aXZlSXNGaW5pdGUgPSByb290JDEuaXNGaW5pdGUsCiAgbmF0aXZlTWluID0gTWF0aC5taW47CgovKioKICogQ3JlYXRlcyBhIGZ1bmN0aW9uIGxpa2UgYF8ucm91bmRgLgogKgogKiBAcHJpdmF0ZQogKiBAcGFyYW0ge3N0cmluZ30gbWV0aG9kTmFtZSBUaGUgbmFtZSBvZiB0aGUgYE1hdGhgIG1ldGhvZCB0byB1c2Ugd2hlbiByb3VuZGluZy4KICogQHJldHVybnMge0Z1bmN0aW9ufSBSZXR1cm5zIHRoZSBuZXcgcm91bmQgZnVuY3Rpb24uCiAqLwpmdW5jdGlvbiBjcmVhdGVSb3VuZChtZXRob2ROYW1lKSB7CiAgdmFyIGZ1bmMgPSBNYXRoW21ldGhvZE5hbWVdOwogIHJldHVybiBmdW5jdGlvbiAobnVtYmVyLCBwcmVjaXNpb24pIHsKICAgIG51bWJlciA9IHRvTnVtYmVyKG51bWJlcik7CiAgICBwcmVjaXNpb24gPSBwcmVjaXNpb24gPT0gbnVsbCA/IDAgOiBuYXRpdmVNaW4odG9JbnRlZ2VyKHByZWNpc2lvbiksIDI5Mik7CiAgICBpZiAocHJlY2lzaW9uICYmIG5hdGl2ZUlzRmluaXRlKG51bWJlcikpIHsKICAgICAgLy8gU2hpZnQgd2l0aCBleHBvbmVudGlhbCBub3RhdGlvbiB0byBhdm9pZCBmbG9hdGluZy1wb2ludCBpc3N1ZXMuCiAgICAgIC8vIFNlZSBbTUROXShodHRwczovL21kbi5pby9yb3VuZCNFeGFtcGxlcykgZm9yIG1vcmUgZGV0YWlscy4KICAgICAgdmFyIHBhaXIgPSAodG9TdHJpbmcobnVtYmVyKSArICdlJykuc3BsaXQoJ2UnKSwKICAgICAgICB2YWx1ZSA9IGZ1bmMocGFpclswXSArICdlJyArICgrcGFpclsxXSArIHByZWNpc2lvbikpOwogICAgICBwYWlyID0gKHRvU3RyaW5nKHZhbHVlKSArICdlJykuc3BsaXQoJ2UnKTsKICAgICAgcmV0dXJuICsocGFpclswXSArICdlJyArICgrcGFpclsxXSAtIHByZWNpc2lvbikpOwogICAgfQogICAgcmV0dXJuIGZ1bmMobnVtYmVyKTsKICB9Owp9CgovKioKICogQ29tcHV0ZXMgYG51bWJlcmAgcm91bmRlZCB0byBgcHJlY2lzaW9uYC4KICoKICogQHN0YXRpYwogKiBAbWVtYmVyT2YgXwogKiBAc2luY2UgMy4xMC4wCiAqIEBjYXRlZ29yeSBNYXRoCiAqIEBwYXJhbSB7bnVtYmVyfSBudW1iZXIgVGhlIG51bWJlciB0byByb3VuZC4KICogQHBhcmFtIHtudW1iZXJ9IFtwcmVjaXNpb249MF0gVGhlIHByZWNpc2lvbiB0byByb3VuZCB0by4KICogQHJldHVybnMge251bWJlcn0gUmV0dXJucyB0aGUgcm91bmRlZCBudW1iZXIuCiAqIEBleGFtcGxlCiAqCiAqIF8ucm91bmQoNC4wMDYpOwogKiAvLyA9PiA0CiAqCiAqIF8ucm91bmQoNC4wMDYsIDIpOwogKiAvLyA9PiA0LjAxCiAqCiAqIF8ucm91bmQoNDA2MCwgLTIpOwogKiAvLyA9PiA0MTAwCiAqLwp2YXIgcm91bmQgPSBjcmVhdGVSb3VuZCgncm91bmQnKTsKdmFyIHJvdW5kJDEgPSByb3VuZDsKCi8qKg0KICog5pW45a2X5oiW5a2X5Liy5Zub5o2o5LqU5YWl6L2J5pW05pW4DQogKiDoi6XovLjlhaXpnZ7mlbjlrZfliYflm57lgrMwDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvY2ludC50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gdiDovLjlhaXmlbjlrZfmiJblrZfkuLINCiAqIEByZXR1cm5zIHtJbnRlZ2VyfSDlm57lgrPlm5vmjajkupTlhaXlvozmlbTmlbgNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coY2ludCgnMS41JykpDQogKiAvLyA9PiAyDQogKg0KICogY29uc29sZS5sb2coY2ludCgnLTEuNScpKQ0KICogLy8gPT4gLTENCiAqDQogKi8KZnVuY3Rpb24gY2ludCh2KSB7CiAgLy9jaGVjawogIGlmICghaXNudW0odikpIHsKICAgIHJldHVybiAwOwogIH0KICB2ID0gY2RibCh2KTsKICBsZXQgciA9IHJvdW5kJDEodik7CgogIC8vY2hlY2sgLTAKICBpZiAoU3RyaW5nKHIpID09PSAnMCcpIHsKICAgIHJldHVybiAwOwogIH0KICByZXR1cm4gcjsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrrmraPmlbTmlbgNCiAqIOato+aVtOaVuOS4jeWMheWQqzDvvIzngrrlpKfmlrww55qE5pW05pW4DQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvaXNwaW50LnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQHBhcmFtIHsqfSB2IOi8uOWFpeS7u+aEj+izh+aWmQ0KICogQHJldHVybnMge0Jvb2xlYW59IOWbnuWCs+WIpOaWt+W4g+ael+WAvA0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhpc3BpbnQoMCkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzcGludCgnMCcpKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBjb25zb2xlLmxvZyhpc3BpbnQoMTI1KSkNCiAqIC8vID0+IHRydWUNCiAqDQogKiBjb25zb2xlLmxvZyhpc3BpbnQoMS4yNSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzcGludCgnMTI1JykpDQogKiAvLyA9PiB0cnVlDQogKg0KICogY29uc29sZS5sb2coaXNwaW50KCcxLjI1JykpDQogKiAvLyA9PiBmYWxzZQ0KDQogKiBjb25zb2xlLmxvZyhpc3BpbnQoLTEyNSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzcGludCgtMS4yNSkpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqIGNvbnNvbGUubG9nKGlzcGludCgnLTEyNScpKQ0KICogLy8gPT4gZmFsc2UNCiAqDQogKiBjb25zb2xlLmxvZyhpc3BpbnQoJy0xLjI1JykpDQogKiAvLyA9PiBmYWxzZQ0KICoNCiAqLwpmdW5jdGlvbiBpc3BpbnQodikgewogIC8vY2hlY2sKICBpZiAoIWlzaW50KHYpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGxldCByID0gY2ludCh2KSA+IDA7CiAgcmV0dXJuIHI7Cn0KCmxldCBjaGFycyA9ICcwMTIzNDU2Nzg5QUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicuc3BsaXQoJycpOwpsZXQgcmFkaXggPSBjaGFycy5sZW5ndGg7CgovKioNCiAqIOeUoueUn+maqOapn2lkDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3QvZ2VuSUQudGVzdC5tanMgR2l0aHVifQ0KICogQG1lbWJlck9mIHdzZW1pDQogKiBAcGFyYW0ge0ludGVnZXJ9IFtsZW49MzJdIOi8uOWFpXV1aWTplbfluqbvvIzngrrmraPmlbTmlbjvvIzpoJDoqK0zMg0KICogQHJldHVybnMge1N0cmluZ30g5Zue5YKzdXVpZOWtl+S4sg0KICogQGV4YW1wbGUNCiAqDQogKiBjb25zb2xlLmxvZyhnZW5JRCgpKQ0KICogLy8gPT4gSXMxTnlJbVUzQTlmeXFGeVlCV3VKdTRpdlhYY0daQWIgKGlzIHJhbmRvbSkNCiAqDQogKi8KZnVuY3Rpb24gZ2VuSUQobGVuID0gMzIpIHsKICBsZXQgdXVpZCA9IFtdOwoKICAvL2NoZWNrCiAgaWYgKGlzcGludChsZW4pKSB7CiAgICBsZW4gPSBjaW50KGxlbik7CiAgfSBlbHNlIHsKICAgIGxlbiA9IDMyOwogIH0KCiAgLy91dWlkCiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykgdXVpZFtpXSA9IGNoYXJzWzAgfCBNYXRoLnJhbmRvbSgpICogcmFkaXhdOwoKICAvL3JmYzQxMjIsIHZlcnNpb24gNCBmb3JtCiAgLy8gLy9yZXF1aXJlcyB0aGVzZSBjaGFyYWN0ZXJzCiAgLy8gdXVpZFs4XSA9IHV1aWRbMTNdID0gdXVpZFsxOF0gPSB1dWlkWzIzXSA9ICctJwogIC8vIHV1aWRbMTRdID0gJzQnCiAgLy8gLy9maWxsIGluIHJhbmRvbSBkYXRhLiAgQXQgaT09MTkgc2V0IHRoZSBoaWdoIGJpdHMgb2YgY2xvY2sgc2VxdWVuY2UgYXMgcGVyIHJmYzQxMjIsIHNlYy4gNC4xLjUKICAvLyBsZXQgcgogIC8vIGZvciAoaSA9IDA7IGkgPCAzNjsgaSsrKSB7CiAgLy8gICAgIGlmICghdXVpZFtpXSkgewogIC8vICAgICAgICAgciA9IDAgfCBNYXRoLnJhbmRvbSgpICogMTYKICAvLyAgICAgICAgIHV1aWRbaV0gPSBjaGFyc1soaSA9PT0gMTkpID8gKHIgJiAweDMpIHwgMHg4IDogcl0KICAvLyAgICAgfQogIC8vIH0KCiAgbGV0IHIgPSB1dWlkLmpvaW4oJycpOwogIHJldHVybiByOwp9CgovKioNCiAqIOeUoueUn1Byb21pc2Xnianku7bvvIzlhbflgpnpj4jlvI9yZXNvbHZl6IiHcmVqZWN0DQogKiDkuLvopoHlj5dqUXVlcnkgRGVmZXJyZWTmpoLlv7XllZ/nmbwNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9nZW5QbS50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEByZXR1cm5zIHtPYmplY3R9IOWbnuWCs1Byb21pc2Xnianku7YNCiAqIEBleGFtcGxlDQogKg0KICogYXN5bmMgZnVuY3Rpb24gdG9wQXN5bmMoKSB7DQogKg0KICogICAgIGZ1bmN0aW9uIHRlc3QxKCkgew0KICogICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICogICAgICAgICAgICAgbGV0IG1zID0gW10NCiAqDQogKiAgICAgICAgICAgICBsZXQgZm4gPSBmdW5jdGlvbihuYW1lKSB7DQogKiAgICAgICAgICAgICAgICAgbGV0IHBtID0gZ2VuUG0oKQ0KICogICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goJ3Jlc29sdmU6ICcgKyBuYW1lKQ0KICogICAgICAgICAgICAgICAgICAgICBwbS5yZXNvbHZlKCdyZXNvbHZlOiAnICsgbmFtZSkNCiAqICAgICAgICAgICAgICAgICB9LCAxKQ0KICogICAgICAgICAgICAgICAgIHJldHVybiBwbQ0KICogICAgICAgICAgICAgfQ0KICoNCiAqICAgICAgICAgICAgIGZuKCdhYmMnKQ0KICogICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG1zZykgew0KICogICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndDEgdGhlbicsIG1zZykNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCgndDEgdGhlbjogJyArIG1zZykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihtc2cpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3QxIGNhdGNoJywgbXNnKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKCd0MSBjYXRjaDogJyArIG1zZykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAqICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtcykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICoNCiAqICAgICAgICAgfSkNCiAqICAgICB9DQogKiAgICAgY29uc29sZS5sb2coJ3Rlc3QxJykNCiAqICAgICBsZXQgcjEgPSBhd2FpdCB0ZXN0MSgpDQogKiAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocjEpKQ0KICogICAgIC8vIHRlc3QxDQogKiAgICAgLy8gdDEgdGhlbiByZXNvbHZlOiBhYmMNCiAqICAgICAvLyBbInJlc29sdmU6IGFiYyIsInQxIHRoZW46IHJlc29sdmU6IGFiYyJdDQogKg0KICogICAgIGZ1bmN0aW9uIHRlc3QyKCkgew0KICogICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICogICAgICAgICAgICAgbGV0IG1zID0gW10NCiAqDQogKiAgICAgICAgICAgICBsZXQgZm4gPSBmdW5jdGlvbihuYW1lKSB7DQogKiAgICAgICAgICAgICAgICAgbGV0IHBtID0gZ2VuUG0oKQ0KICogICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goJ3JlamVjdDogJyArIG5hbWUpDQogKiAgICAgICAgICAgICAgICAgICAgIHBtLnJlamVjdCgncmVqZWN0OiAnICsgbmFtZSkNCiAqICAgICAgICAgICAgICAgICB9LCAxKQ0KICogICAgICAgICAgICAgICAgIHJldHVybiBwbQ0KICogICAgICAgICAgICAgfQ0KICoNCiAqICAgICAgICAgICAgIGZuKCdhYmMnKQ0KICogICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKG1zZykgew0KICogICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndDEgdGhlbicsIG1zZykNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCgndDEgdGhlbjogJyArIG1zZykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbihtc2cpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3QxIGNhdGNoJywgbXNnKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKCd0MSBjYXRjaDogJyArIG1zZykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgICAgIC5maW5hbGx5KCgpID0+IHsNCiAqICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtcykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICoNCiAqICAgICAgICAgfSkNCiAqICAgICB9DQogKiAgICAgY29uc29sZS5sb2coJ3Rlc3QyJykNCiAqICAgICBsZXQgcjIgPSBhd2FpdCB0ZXN0MigpDQogKiAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocjIpKQ0KICogICAgIC8vIHRlc3QyDQogKiAgICAgLy8gdDEgY2F0Y2ggcmVqZWN0OiBhYmMNCiAqICAgICAvLyBbInJlamVjdDogYWJjIiwidDEgY2F0Y2g6IHJlamVjdDogYWJjIl0NCiAqDQogKiB9DQogKiB0b3BBc3luYygpLmNhdGNoKCgpID0+IHt9KQ0KICoNCiAqLwpmdW5jdGlvbiBnZW5QbSgpIHsKICBsZXQgcmVzb2x2ZTsKICBsZXQgcmVqZWN0OwogIGxldCBwID0gbmV3IFByb21pc2UoZnVuY3Rpb24gKCkgewogICAgcmVzb2x2ZSA9IGFyZ3VtZW50c1swXTsKICAgIHJlamVjdCA9IGFyZ3VtZW50c1sxXTsKICB9KTsKICBwLnJlc29sdmUgPSByZXNvbHZlOwogIHAucmVqZWN0ID0gcmVqZWN0OwogIHJldHVybiBwOwp9CgovKioKICogVGhlIGJhc2UgaW1wbGVtZW50YXRpb24gb2YgYF8uc2xpY2VgIHdpdGhvdXQgYW4gaXRlcmF0ZWUgY2FsbCBndWFyZC4KICoKICogQHByaXZhdGUKICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHNsaWNlLgogKiBAcGFyYW0ge251bWJlcn0gW3N0YXJ0PTBdIFRoZSBzdGFydCBwb3NpdGlvbi4KICogQHBhcmFtIHtudW1iZXJ9IFtlbmQ9YXJyYXkubGVuZ3RoXSBUaGUgZW5kIHBvc2l0aW9uLgogKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAqLwpmdW5jdGlvbiBiYXNlU2xpY2UoYXJyYXksIHN0YXJ0LCBlbmQpIHsKICB2YXIgaW5kZXggPSAtMSwKICAgIGxlbmd0aCA9IGFycmF5Lmxlbmd0aDsKICBpZiAoc3RhcnQgPCAwKSB7CiAgICBzdGFydCA9IC1zdGFydCA+IGxlbmd0aCA/IDAgOiBsZW5ndGggKyBzdGFydDsKICB9CiAgZW5kID0gZW5kID4gbGVuZ3RoID8gbGVuZ3RoIDogZW5kOwogIGlmIChlbmQgPCAwKSB7CiAgICBlbmQgKz0gbGVuZ3RoOwogIH0KICBsZW5ndGggPSBzdGFydCA+IGVuZCA/IDAgOiBlbmQgLSBzdGFydCA+Pj4gMDsKICBzdGFydCA+Pj49IDA7CiAgdmFyIHJlc3VsdCA9IEFycmF5KGxlbmd0aCk7CiAgd2hpbGUgKCsraW5kZXggPCBsZW5ndGgpIHsKICAgIHJlc3VsdFtpbmRleF0gPSBhcnJheVtpbmRleCArIHN0YXJ0XTsKICB9CiAgcmV0dXJuIHJlc3VsdDsKfQoKLyoqCiAqIENyZWF0ZXMgYSBzbGljZSBvZiBgYXJyYXlgIHdpdGggYG5gIGVsZW1lbnRzIGRyb3BwZWQgZnJvbSB0aGUgYmVnaW5uaW5nLgogKgogKiBAc3RhdGljCiAqIEBtZW1iZXJPZiBfCiAqIEBzaW5jZSAwLjUuMAogKiBAY2F0ZWdvcnkgQXJyYXkKICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGhlIGFycmF5IHRvIHF1ZXJ5LgogKiBAcGFyYW0ge251bWJlcn0gW249MV0gVGhlIG51bWJlciBvZiBlbGVtZW50cyB0byBkcm9wLgogKiBAcGFyYW0tIHtPYmplY3R9IFtndWFyZF0gRW5hYmxlcyB1c2UgYXMgYW4gaXRlcmF0ZWUgZm9yIG1ldGhvZHMgbGlrZSBgXy5tYXBgLgogKiBAcmV0dXJucyB7QXJyYXl9IFJldHVybnMgdGhlIHNsaWNlIG9mIGBhcnJheWAuCiAqIEBleGFtcGxlCiAqCiAqIF8uZHJvcChbMSwgMiwgM10pOwogKiAvLyA9PiBbMiwgM10KICoKICogXy5kcm9wKFsxLCAyLCAzXSwgMik7CiAqIC8vID0+IFszXQogKgogKiBfLmRyb3AoWzEsIDIsIDNdLCA1KTsKICogLy8gPT4gW10KICoKICogXy5kcm9wKFsxLCAyLCAzXSwgMCk7CiAqIC8vID0+IFsxLCAyLCAzXQogKi8KZnVuY3Rpb24gZHJvcChhcnJheSwgbiwgZ3VhcmQpIHsKICB2YXIgbGVuZ3RoID0gYXJyYXkgPT0gbnVsbCA/IDAgOiBhcnJheS5sZW5ndGg7CiAgaWYgKCFsZW5ndGgpIHsKICAgIHJldHVybiBbXTsKICB9CiAgbiA9IGd1YXJkIHx8IG4gPT09IHVuZGVmaW5lZCA/IDEgOiB0b0ludGVnZXIobik7CiAgcmV0dXJuIGJhc2VTbGljZShhcnJheSwgbiA8IDAgPyAwIDogbiwgbGVuZ3RoKTsKfQoKLyoqDQogKiDliKTmlrfmmK/lkKbngrrlh73mlbgNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9pc2Z1bi50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7Kn0gdiDovLjlhaXku7vmhI/os4fmlpkNCiAqIEByZXR1cm5zIHtCb29sZWFufSDlm57lgrPliKTmlrfluIPmnpflgLwNCiAqIEBleGFtcGxlDQogKg0KICogY29uc29sZS5sb2coaXNmdW4oJzEuMjUnKSkNCiAqIC8vID0+IGZhbHNlDQogKg0KICogY29uc29sZS5sb2coaXNmdW4oZnVuY3Rpb24oKSB7fSkpDQogKiAvLyA9PiB0cnVlDQogKg0KICovCmZ1bmN0aW9uIGlzZnVuKHYpIHsKICBsZXQgYyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2KTsKICByZXR1cm4gYyA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJyB8fCBjID09PSAnW29iamVjdCBBc3luY0Z1bmN0aW9uXSc7Cn0KCi8qKg0KICogUHJvbWlzZeeahG1hcFNlcmllc++8jOW+quW6j+Wft+ihjFByb21pc2UNCiAqDQogKiDoi6XovLjlhaVyc+eCuuizh+aWmemZo+WIl+WJh2Zu6ZyA5bCH5pW45pOa6JmV55CG5Lim5Zue5YKzUHJvbWlzZe+8jOiLpei8uOWFpXJz54K6UHJvbWlzZemZo+WIl+WJh2Zu5Y+v5LiN57Wm77yM5Lim5b6q5bqP5Z+36KGM5ZCEUHJvbWlzZeOAgg0KICog5L2/55So5Ye95pW45Z+36KGM5pmC77yM562J5ZCM5pa8cG1NYXDkvb/nlKjlh73mlbjln7fooYzkuJR0YWtlTGltaXQ9Me+8jHByb21pc2Xkvp3luo/ln7fooYzlroznlaLmiY3mnIPoqr/nlKjkuIvkuIDlgItwcm9taXNl44CCDQogKiDlhYjooYznlKLnlJ9wcm9taXNl5pmC77yM562J5ZCM5pa8cG1NYXDkvb/nlKjlh73mlbjln7fooYzkuJR0YWtlTGltaXQ9MO+8jOaIluaYr+etieWQjOaWvHBtTWFw5YWI6KGM55Si55SfcHJvbWlzZe+8jOWQhHByb21pc2Xnm7TmjqXln7fooYzoppblkIToh6rln7fooYzmmYLplpPntZDmnZ/jgIINCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9wbVNlcmllcy50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7QXJyYXl9IHJzIOi8uOWFpeizh+aWmemZo+WIl++8jOiLpeS4jee1pmZu5YmHcnPpnIDopoHngrpQcm9taXNl6Zmj5YiXDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW4g6Ly45YWl5b6q5bqP5Z+36KGM5YC855qE5ZG85Y+r5Ye95pW4DQogKiBAcmV0dXJucyB7UHJvbWlzZX0g5Zue5YKzUHJvbWlzZe+8jHJlc29sdmXlm57lgrPmiJDlip/ntZDmnpzvvIxyZWplY3Tlm57lgrPlpLHmlZfntZDmnpwNCiAqIEBleGFtcGxlDQogKg0KICogYXN5bmMgZnVuY3Rpb24gdG9wQXN5bmMoKSB7DQogKg0KICogICAgIGFzeW5jIGZ1bmN0aW9uIHRlc3QxKCkgew0KICogICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICogICAgICAgICAgICAgbGV0IG1zID0gW10NCiAqDQogKiAgICAgICAgICAgICAvL+mAmumBjmZ1bmN0aW9u6Kq/55So55Si55SfcHJvbWlzZSwg5ZCEcHJvbWlzZeW+quW6j+iqv+eUqA0KICogICAgICAgICAgICAgcG1TZXJpZXMoWzEsIDIsIDMsIDQsIDVdLCBmdW5jdGlvbiAodiwgaykgew0KICogICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgbGV0IGQgPSA0MDAgLSAoKHYgKiogMikgKiAxMCArIDUwKQ0KICogICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2FsbCcsIHYpDQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyBjYWxsOiB2IH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2ZScsIHYsICdkJywgZCkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyByZXNvbHZlOiB2LCBkIH0pDQogKiAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCcjJyArIHYpDQogKiAgICAgICAgICAgICAgICAgICAgIH0sIGQpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgIH0pDQogKiAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0aGVuJywgSlNPTi5zdHJpbmdpZnkocmVzKSkNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCh7IHJlcyB9KQ0KICogICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG1zKQ0KICogICAgICAgICAgICAgICAgIH0pDQogKiAgICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycikgew0KICogICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2F0Y2gnLCBKU09OLnN0cmluZ2lmeShlcnIpKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgZXJyIH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobXMpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqDQogKiAgICAgICAgIH0pDQogKg0KICogICAgIH0NCiAqICAgICBjb25zb2xlLmxvZygndGVzdDEnKQ0KICogICAgIGxldCByMSA9IGF3YWl0IHRlc3QxKCkNCiAqICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyMSkpDQogKiAgICAgLy8gdGVzdDENCiAqICAgICAvLyBjYWxsIDENCiAqICAgICAvLyByZXNvbHZlIDEgZCAzNDANCiAqICAgICAvLyBjYWxsIDINCiAqICAgICAvLyByZXNvbHZlIDIgZCAzMTANCiAqICAgICAvLyBjYWxsIDMNCiAqICAgICAvLyByZXNvbHZlIDMgZCAyNjANCiAqICAgICAvLyBjYWxsIDQNCiAqICAgICAvLyByZXNvbHZlIDQgZCAxOTANCiAqICAgICAvLyBjYWxsIDUNCiAqICAgICAvLyByZXNvbHZlIDUgZCAxMDANCiAqICAgICAvLyB0aGVuIFsiIzEiLCIjMiIsIiMzIiwiIzQiLCIjNSJdDQogKiAgICAgLy8gW3siY2FsbCI6MX0seyJyZXNvbHZlIjoxLCJkIjozNDB9LHsiY2FsbCI6Mn0seyJyZXNvbHZlIjoyLCJkIjozMTB9LHsiY2FsbCI6M30seyJyZXNvbHZlIjozLCJkIjoyNjB9LHsiY2FsbCI6NH0seyJyZXNvbHZlIjo0LCJkIjoxOTB9LHsiY2FsbCI6NX0seyJyZXNvbHZlIjo1LCJkIjoxMDB9LHsicmVzIjpbIiMxIiwiIzIiLCIjMyIsIiM0IiwiIzUiXX1dDQogKg0KICogICAgIGFzeW5jIGZ1bmN0aW9uIHRlc3QyKCkgew0KICogICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICogICAgICAgICAgICAgbGV0IG1zID0gW10NCiAqDQogKiAgICAgICAgICAgICAvL+mAmumBjmZ1bmN0aW9u6Kq/55So55Si55SfcHJvbWlzZSwg5ZCEcHJvbWlzZeW+quW6j+iqv+eUqCwg5pa8M+acg+inuOeZvHJlamVjdOiAjOi3s+WHunBtU2VyaWVzDQogKiAgICAgICAgICAgICBwbVNlcmllcyhbMSwgMiwgMywgNCwgNV0sIGZ1bmN0aW9uICh2LCBrKSB7DQogKiAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgew0KICogICAgICAgICAgICAgICAgICAgICBsZXQgZCA9IDQwMCAtICgodiAqKiAyKSAqIDEwICsgNTApDQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYWxsJywgdikNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCh7IGNhbGw6IHYgfSkNCiAqICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2ID09PSAzKSB7DQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3JlamVjdCcsIHYsICdkJywgZCkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgcmVqZWN0OiB2LCBkIH0pDQogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCcjJyArIHYpDQogKiAgICAgICAgICAgICAgICAgICAgICAgICB9DQogKiAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2ZScsIHYsICdkJywgZCkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgcmVzb2x2ZTogdiwgZCB9KQ0KICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoJyMnICsgdikNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAqICAgICAgICAgICAgICAgICAgICAgfSwgZCkNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoZW4nLCBKU09OLnN0cmluZ2lmeShyZXMpKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgcmVzIH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobXMpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXRjaCcsIEpTT04uc3RyaW5naWZ5KGVycikpDQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyBlcnIgfSkNCiAqICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtcykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICoNCiAqICAgICAgICAgfSkNCiAqDQogKiAgICAgfQ0KICogICAgIGNvbnNvbGUubG9nKCd0ZXN0MicpDQogKiAgICAgbGV0IHIyID0gYXdhaXQgdGVzdDIoKQ0KICogICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHIyKSkNCiAqICAgICAvLyB0ZXN0Mg0KICogICAgIC8vIGNhbGwgMQ0KICogICAgIC8vIHJlc29sdmUgMSBkIDM0MA0KICogICAgIC8vIGNhbGwgMg0KICogICAgIC8vIHJlc29sdmUgMiBkIDMxMA0KICogICAgIC8vIGNhbGwgMw0KICogICAgIC8vIHJlamVjdCAzIGQgMjYwDQogKiAgICAgLy8gY2F0Y2ggIiMzIg0KICogICAgIC8vIFt7ImNhbGwiOjF9LHsicmVzb2x2ZSI6MSwiZCI6MzQwfSx7ImNhbGwiOjJ9LHsicmVzb2x2ZSI6MiwiZCI6MzEwfSx7ImNhbGwiOjN9LHsicmVqZWN0IjozLCJkIjoyNjB9LHsiZXJyIjoiIzMifV0NCiAqDQogKiAgICAgYXN5bmMgZnVuY3Rpb24gdGVzdDMoKSB7DQogKiAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogKiAgICAgICAgICAgICBsZXQgbXMgPSBbXQ0KICoNCiAqICAgICAgICAgICAgIC8v5YWI55Si55SfcHJvbWlzZSwg5Zug5LqL5YWI5Yid5aeL5YyW5pWF5ZCEcHJvbWlzZeacg+S+neeFp+WQhOiHquWft+ihjOaZgumWk+e1kOadnw0KICogICAgICAgICAgICAgbGV0IHJzID0gWzEsIDIsIDMsIDQsIDVdLm1hcChmdW5jdGlvbiAodiwgaykgew0KICogICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgbGV0IGQgPSA0MDAgLSAoKHYgKiogMikgKiAxMCArIDUwKQ0KICogICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2FsbCcsIHYpDQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyBjYWxsOiB2IH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzb2x2ZScsIHYsICdkJywgZCkNCiAqICAgICAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyByZXNvbHZlOiB2LCBkIH0pDQogKiAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCcjJyArIHYpDQogKiAgICAgICAgICAgICAgICAgICAgIH0sIGQpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgIH0pDQogKiAgICAgICAgICAgICBwbVNlcmllcyhycywgbnVsbCkNCiAqICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoZW4nLCBKU09OLnN0cmluZ2lmeShyZXMpKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgcmVzIH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobXMpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXRjaCcsIEpTT04uc3RyaW5naWZ5KGVycikpDQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyBlcnIgfSkNCiAqICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtcykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICoNCiAqICAgICAgICAgfSkNCiAqDQogKiAgICAgfQ0KICogICAgIGNvbnNvbGUubG9nKCd0ZXN0MycpDQogKiAgICAgbGV0IHIzID0gYXdhaXQgdGVzdDMoKQ0KICogICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHIzKSkNCiAqICAgICAvLyB0ZXN0Mw0KICogICAgIC8vIGNhbGwgMQ0KICogICAgIC8vIGNhbGwgMg0KICogICAgIC8vIGNhbGwgMw0KICogICAgIC8vIGNhbGwgNA0KICogICAgIC8vIGNhbGwgNQ0KICogICAgIC8vIHJlc29sdmUgNSBkIDEwMA0KICogICAgIC8vIHJlc29sdmUgNCBkIDE5MA0KICogICAgIC8vIHJlc29sdmUgMyBkIDI2MA0KICogICAgIC8vIHJlc29sdmUgMiBkIDMxMA0KICogICAgIC8vIHJlc29sdmUgMSBkIDM0MA0KICogICAgIC8vIHRoZW4gWyIjMSIsIiMyIiwiIzMiLCIjNCIsIiM1Il0NCiAqICAgICAvLyBbeyJjYWxsIjoxfSx7ImNhbGwiOjJ9LHsiY2FsbCI6M30seyJjYWxsIjo0fSx7ImNhbGwiOjV9LHsicmVzb2x2ZSI6NSwiZCI6MTAwfSx7InJlc29sdmUiOjQsImQiOjE5MH0seyJyZXNvbHZlIjozLCJkIjoyNjB9LHsicmVzb2x2ZSI6MiwiZCI6MzEwfSx7InJlc29sdmUiOjEsImQiOjM0MH0seyJyZXMiOlsiIzEiLCIjMiIsIiMzIiwiIzQiLCIjNSJdfV0NCiAqDQogKiAgICAgYXN5bmMgZnVuY3Rpb24gdGVzdDQoKSB7DQogKiAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogKiAgICAgICAgICAgICBsZXQgbXMgPSBbXQ0KICoNCiAqICAgICAgICAgICAgIC8v6YCa6YGOZnVuY3Rpb27oqr/nlKjnlKLnlJ9wcm9taXNlLCDlkIRwcm9taXNl5b6q5bqP6Kq/55SoDQogKiAgICAgICAgICAgICBwbVNlcmllcyh7DQogKiAgICAgICAgICAgICAgICAgdDE6IDEsDQogKiAgICAgICAgICAgICAgICAgdDI6IDIuMzQ1LA0KICogICAgICAgICAgICAgICAgIHQzOiAnYWJjJywNCiAqICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh2LCBrKSB7DQogKiAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgew0KICogICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGBrPSR7a30sdj0ke3Z9YCkNCiAqICAgICAgICAgICAgICAgICB9KQ0KICogICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RoZW4nLCBKU09OLnN0cmluZ2lmeShyZXMpKQ0KICogICAgICAgICAgICAgICAgICAgICBtcy5wdXNoKHsgcmVzIH0pDQogKiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobXMpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqICAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXRjaCcsIEpTT04uc3RyaW5naWZ5KGVycikpDQogKiAgICAgICAgICAgICAgICAgICAgIG1zLnB1c2goeyBlcnIgfSkNCiAqICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShtcykNCiAqICAgICAgICAgICAgICAgICB9KQ0KICoNCiAqICAgICAgICAgfSkNCiAqDQogKiAgICAgfQ0KICogICAgIGNvbnNvbGUubG9nKCd0ZXN0NCcpDQogKiAgICAgbGV0IHI0ID0gYXdhaXQgdGVzdDQoKQ0KICogICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHI0KSkNCiAqICAgICAvLyB0ZXN0NA0KICogICAgIC8vIHRoZW4gWyJrPXQxLHY9MSIsIms9dDIsdj0yLjM0NSIsIms9dDMsdj1hYmMiXQ0KICogICAgIC8vIFt7InJlcyI6WyJrPXQxLHY9MSIsIms9dDIsdj0yLjM0NSIsIms9dDMsdj1hYmMiXX1dDQogKg0KICogfQ0KICogdG9wQXN5bmMoKS5jYXRjaCgoKSA9PiB7fSkNCiAqDQogKi8KZnVuY3Rpb24gcG1TZXJpZXMocnMsIGZ1bikgewogIC8vcG0KICBsZXQgcG0gPSBnZW5QbSgpOwoKICAvL2NoZWNrCiAgaWYgKCFpc2FycihycykgJiYgIWlzb2JqKHJzKSkgewogICAgcG0ucmVqZWN0KCdycyBpcyBub3QgYW4gYXJyYXkgb3Igb2JqZWN0Jyk7CiAgICByZXR1cm4gcG07CiAgfQoKICAvL29iamVjdCBycyB0byBhcnJheQogIGxldCB1c2VPYmogPSBmYWxzZTsKICBpZiAoaXNvYmoocnMpKSB7CiAgICB1c2VPYmogPSB0cnVlOwogICAgbGV0IF9ycyA9IFtdOwogICAgZm9yRWFjaChycywgKHYsIGspID0+IHsKICAgICAgX3JzLnB1c2goewogICAgICAgIGssCiAgICAgICAgdgogICAgICB9KTsKICAgIH0pOwogICAgcnMgPSBfcnM7CiAgfQoKICAvL2RlZmF1bHQgZnVuCiAgaWYgKCFpc2Z1bihmdW4pKSB7CiAgICBmdW4gPSBmdW5jdGlvbiAodikgewogICAgICByZXR1cm4gdjsKICAgIH07CiAgfQoKICAvL3RzCiAgbGV0IGsgPSAtMTsKICBsZXQgdHMgPSBbXTsKICBycy5yZWR1Y2UoZnVuY3Rpb24gKHBtbSwgdikgewogICAgcmV0dXJuIHBtbS50aGVuKGZ1bmN0aW9uICh0KSB7CiAgICAgIHRzLnB1c2godCk7CiAgICAgIGsgKz0gMTsKICAgICAgbGV0IHVrID0gazsKICAgICAgbGV0IHV2ID0gdjsKICAgICAgaWYgKHVzZU9iaikgewogICAgICAgIHVrID0gdi5rOwogICAgICAgIHV2ID0gdi52OwogICAgICB9CiAgICAgIGlmIChpc2Z1bihmdW4pKSB7CiAgICAgICAgcmV0dXJuIGZ1bih1diwgdWspOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB1djsKICAgICAgfQogICAgfSk7CiAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpLnRoZW4oZnVuY3Rpb24gKHQpIHsKICAgIHRzLnB1c2godCk7CiAgICB0cyA9IGRyb3AodHMpOwogICAgcG0ucmVzb2x2ZSh0cyk7CiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgcG0ucmVqZWN0KGVycik7CiAgfSk7CiAgcmV0dXJuIHBtOwp9CgovKioNCiAqIGpzb27mloflrZfovYnku7vmhI/os4fmlpkNCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9qMm8udGVzdC5tanMgR2l0aHVifQ0KICogQG1lbWJlck9mIHdzZW1pDQogKiBAcGFyYW0ge1N0cmluZ30gdiDovLjlhaVqc29u5qC85byP5a2X5LiyDQogKiBAcmV0dXJucyB7Kn0g5Zue5YKz5Lu75oSP6LOH5paZDQogKiBAZXhhbXBsZQ0KICoNCiAqIGNvbnNvbGUubG9nKGoybygnWzEsIjMiLCJhYmMiXScpKQ0KICogLy8gPT4gWzEsICczJywgJ2FiYyddDQogKg0KICogY29uc29sZS5sb2coajJvKCd7ImEiOjEyLjM0LCJiIjoiYWJjIn0nKSkNCiAqIC8vID0+IHsgYTogMTIuMzQsIGI6ICdhYmMnIH0NCiAqDQogKi8KZnVuY3Rpb24gajJvKHYpIHsKICAvL2NoZWNrCiAgaWYgKCFpc2VzdHIodikpIHsKICAgIHJldHVybiB7fTsKICB9CiAgbGV0IGMgPSB7fTsKICB0cnkgewogICAgYyA9IEpTT04ucGFyc2Uodik7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjID0ge307CiAgfQogIHJldHVybiBjOwp9CgpmdW5jdGlvbiBnZXREZWZhdWx0RXhwb3J0RnJvbUNqcyAoeCkgewoJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKfQoKdmFyIGV2ZW50ZW1pdHRlcjMgPSB7ZXhwb3J0czoge319OwoKKGZ1bmN0aW9uIChtb2R1bGUpIHsKCiAgdmFyIGhhcyA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksCiAgICBwcmVmaXggPSAnfic7CgogIC8qKgogICAqIENvbnN0cnVjdG9yIHRvIGNyZWF0ZSBhIHN0b3JhZ2UgZm9yIG91ciBgRUVgIG9iamVjdHMuCiAgICogQW4gYEV2ZW50c2AgaW5zdGFuY2UgaXMgYSBwbGFpbiBvYmplY3Qgd2hvc2UgcHJvcGVydGllcyBhcmUgZXZlbnQgbmFtZXMuCiAgICoKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcHJpdmF0ZQogICAqLwogIGZ1bmN0aW9uIEV2ZW50cygpIHt9CgogIC8vCiAgLy8gV2UgdHJ5IHRvIG5vdCBpbmhlcml0IGZyb20gYE9iamVjdC5wcm90b3R5cGVgLiBJbiBzb21lIGVuZ2luZXMgY3JlYXRpbmcgYW4KICAvLyBpbnN0YW5jZSBpbiB0aGlzIHdheSBpcyBmYXN0ZXIgdGhhbiBjYWxsaW5nIGBPYmplY3QuY3JlYXRlKG51bGwpYCBkaXJlY3RseS4KICAvLyBJZiBgT2JqZWN0LmNyZWF0ZShudWxsKWAgaXMgbm90IHN1cHBvcnRlZCB3ZSBwcmVmaXggdGhlIGV2ZW50IG5hbWVzIHdpdGggYQogIC8vIGNoYXJhY3RlciB0byBtYWtlIHN1cmUgdGhhdCB0aGUgYnVpbHQtaW4gb2JqZWN0IHByb3BlcnRpZXMgYXJlIG5vdAogIC8vIG92ZXJyaWRkZW4gb3IgdXNlZCBhcyBhbiBhdHRhY2sgdmVjdG9yLgogIC8vCiAgaWYgKE9iamVjdC5jcmVhdGUpIHsKICAgIEV2ZW50cy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICAgIC8vCiAgICAvLyBUaGlzIGhhY2sgaXMgbmVlZGVkIGJlY2F1c2UgdGhlIGBfX3Byb3RvX19gIHByb3BlcnR5IGlzIHN0aWxsIGluaGVyaXRlZCBpbgogICAgLy8gc29tZSBvbGQgYnJvd3NlcnMgbGlrZSBBbmRyb2lkIDQsIGlQaG9uZSA1LjEsIE9wZXJhIDExIGFuZCBTYWZhcmkgNS4KICAgIC8vCiAgICBpZiAoIW5ldyBFdmVudHMoKS5fX3Byb3RvX18pIHByZWZpeCA9IGZhbHNlOwogIH0KCiAgLyoqCiAgICogUmVwcmVzZW50YXRpb24gb2YgYSBzaW5nbGUgZXZlbnQgbGlzdGVuZXIuCiAgICoKICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgbGlzdGVuZXIgZnVuY3Rpb24uCiAgICogQHBhcmFtIHsqfSBjb250ZXh0IFRoZSBjb250ZXh0IHRvIGludm9rZSB0aGUgbGlzdGVuZXIgd2l0aC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IFtvbmNlPWZhbHNlXSBTcGVjaWZ5IGlmIHRoZSBsaXN0ZW5lciBpcyBhIG9uZS10aW1lIGxpc3RlbmVyLgogICAqIEBjb25zdHJ1Y3RvcgogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gRUUoZm4sIGNvbnRleHQsIG9uY2UpIHsKICAgIHRoaXMuZm4gPSBmbjsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICB0aGlzLm9uY2UgPSBvbmNlIHx8IGZhbHNlOwogIH0KCiAgLyoqCiAgICogQWRkIGEgbGlzdGVuZXIgZm9yIGEgZ2l2ZW4gZXZlbnQuCiAgICoKICAgKiBAcGFyYW0ge0V2ZW50RW1pdHRlcn0gZW1pdHRlciBSZWZlcmVuY2UgdG8gdGhlIGBFdmVudEVtaXR0ZXJgIGluc3RhbmNlLgogICAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBldmVudCBUaGUgZXZlbnQgbmFtZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgbGlzdGVuZXIgZnVuY3Rpb24uCiAgICogQHBhcmFtIHsqfSBjb250ZXh0IFRoZSBjb250ZXh0IHRvIGludm9rZSB0aGUgbGlzdGVuZXIgd2l0aC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9uY2UgU3BlY2lmeSBpZiB0aGUgbGlzdGVuZXIgaXMgYSBvbmUtdGltZSBsaXN0ZW5lci4KICAgKiBAcmV0dXJucyB7RXZlbnRFbWl0dGVyfQogICAqIEBwcml2YXRlCiAgICovCiAgZnVuY3Rpb24gYWRkTGlzdGVuZXIoZW1pdHRlciwgZXZlbnQsIGZuLCBjb250ZXh0LCBvbmNlKSB7CiAgICBpZiAodHlwZW9mIGZuICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1RoZSBsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24nKTsKICAgIH0KICAgIHZhciBsaXN0ZW5lciA9IG5ldyBFRShmbiwgY29udGV4dCB8fCBlbWl0dGVyLCBvbmNlKSwKICAgICAgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudDsKICAgIGlmICghZW1pdHRlci5fZXZlbnRzW2V2dF0pIGVtaXR0ZXIuX2V2ZW50c1tldnRdID0gbGlzdGVuZXIsIGVtaXR0ZXIuX2V2ZW50c0NvdW50Kys7ZWxzZSBpZiAoIWVtaXR0ZXIuX2V2ZW50c1tldnRdLmZuKSBlbWl0dGVyLl9ldmVudHNbZXZ0XS5wdXNoKGxpc3RlbmVyKTtlbHNlIGVtaXR0ZXIuX2V2ZW50c1tldnRdID0gW2VtaXR0ZXIuX2V2ZW50c1tldnRdLCBsaXN0ZW5lcl07CiAgICByZXR1cm4gZW1pdHRlcjsKICB9CgogIC8qKgogICAqIENsZWFyIGV2ZW50IGJ5IG5hbWUuCiAgICoKICAgKiBAcGFyYW0ge0V2ZW50RW1pdHRlcn0gZW1pdHRlciBSZWZlcmVuY2UgdG8gdGhlIGBFdmVudEVtaXR0ZXJgIGluc3RhbmNlLgogICAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBldnQgVGhlIEV2ZW50IG5hbWUuCiAgICogQHByaXZhdGUKICAgKi8KICBmdW5jdGlvbiBjbGVhckV2ZW50KGVtaXR0ZXIsIGV2dCkgewogICAgaWYgKC0tZW1pdHRlci5fZXZlbnRzQ291bnQgPT09IDApIGVtaXR0ZXIuX2V2ZW50cyA9IG5ldyBFdmVudHMoKTtlbHNlIGRlbGV0ZSBlbWl0dGVyLl9ldmVudHNbZXZ0XTsKICB9CgogIC8qKgogICAqIE1pbmltYWwgYEV2ZW50RW1pdHRlcmAgaW50ZXJmYWNlIHRoYXQgaXMgbW9sZGVkIGFnYWluc3QgdGhlIE5vZGUuanMKICAgKiBgRXZlbnRFbWl0dGVyYCBpbnRlcmZhY2UuCiAgICoKICAgKiBAY29uc3RydWN0b3IKICAgKiBAcHVibGljCiAgICovCiAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkgewogICAgdGhpcy5fZXZlbnRzID0gbmV3IEV2ZW50cygpOwogICAgdGhpcy5fZXZlbnRzQ291bnQgPSAwOwogIH0KCiAgLyoqCiAgICogUmV0dXJuIGFuIGFycmF5IGxpc3RpbmcgdGhlIGV2ZW50cyBmb3Igd2hpY2ggdGhlIGVtaXR0ZXIgaGFzIHJlZ2lzdGVyZWQKICAgKiBsaXN0ZW5lcnMuCiAgICoKICAgKiBAcmV0dXJucyB7QXJyYXl9CiAgICogQHB1YmxpYwogICAqLwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUuZXZlbnROYW1lcyA9IGZ1bmN0aW9uIGV2ZW50TmFtZXMoKSB7CiAgICB2YXIgbmFtZXMgPSBbXSwKICAgICAgZXZlbnRzLAogICAgICBuYW1lOwogICAgaWYgKHRoaXMuX2V2ZW50c0NvdW50ID09PSAwKSByZXR1cm4gbmFtZXM7CiAgICBmb3IgKG5hbWUgaW4gZXZlbnRzID0gdGhpcy5fZXZlbnRzKSB7CiAgICAgIGlmIChoYXMuY2FsbChldmVudHMsIG5hbWUpKSBuYW1lcy5wdXNoKHByZWZpeCA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lKTsKICAgIH0KICAgIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICAgIHJldHVybiBuYW1lcy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhldmVudHMpKTsKICAgIH0KICAgIHJldHVybiBuYW1lczsKICB9OwoKICAvKioKICAgKiBSZXR1cm4gdGhlIGxpc3RlbmVycyByZWdpc3RlcmVkIGZvciBhIGdpdmVuIGV2ZW50LgogICAqCiAgICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLgogICAqIEByZXR1cm5zIHtBcnJheX0gVGhlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLgogICAqIEBwdWJsaWMKICAgKi8KICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uIGxpc3RlbmVycyhldmVudCkgewogICAgdmFyIGV2dCA9IHByZWZpeCA/IHByZWZpeCArIGV2ZW50IDogZXZlbnQsCiAgICAgIGhhbmRsZXJzID0gdGhpcy5fZXZlbnRzW2V2dF07CiAgICBpZiAoIWhhbmRsZXJzKSByZXR1cm4gW107CiAgICBpZiAoaGFuZGxlcnMuZm4pIHJldHVybiBbaGFuZGxlcnMuZm5dOwogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBoYW5kbGVycy5sZW5ndGgsIGVlID0gbmV3IEFycmF5KGwpOyBpIDwgbDsgaSsrKSB7CiAgICAgIGVlW2ldID0gaGFuZGxlcnNbaV0uZm47CiAgICB9CiAgICByZXR1cm4gZWU7CiAgfTsKCiAgLyoqCiAgICogUmV0dXJuIHRoZSBudW1iZXIgb2YgbGlzdGVuZXJzIGxpc3RlbmluZyB0byBhIGdpdmVuIGV2ZW50LgogICAqCiAgICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLgogICAqIEByZXR1cm5zIHtOdW1iZXJ9IFRoZSBudW1iZXIgb2YgbGlzdGVuZXJzLgogICAqIEBwdWJsaWMKICAgKi8KICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbiBsaXN0ZW5lckNvdW50KGV2ZW50KSB7CiAgICB2YXIgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudCwKICAgICAgbGlzdGVuZXJzID0gdGhpcy5fZXZlbnRzW2V2dF07CiAgICBpZiAoIWxpc3RlbmVycykgcmV0dXJuIDA7CiAgICBpZiAobGlzdGVuZXJzLmZuKSByZXR1cm4gMTsKICAgIHJldHVybiBsaXN0ZW5lcnMubGVuZ3RoOwogIH07CgogIC8qKgogICAqIENhbGxzIGVhY2ggb2YgdGhlIGxpc3RlbmVycyByZWdpc3RlcmVkIGZvciBhIGdpdmVuIGV2ZW50LgogICAqCiAgICogQHBhcmFtIHsoU3RyaW5nfFN5bWJvbCl9IGV2ZW50IFRoZSBldmVudCBuYW1lLgogICAqIEByZXR1cm5zIHtCb29sZWFufSBgdHJ1ZWAgaWYgdGhlIGV2ZW50IGhhZCBsaXN0ZW5lcnMsIGVsc2UgYGZhbHNlYC4KICAgKiBAcHVibGljCiAgICovCiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdChldmVudCwgYTEsIGEyLCBhMywgYTQsIGE1KSB7CiAgICB2YXIgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudDsKICAgIGlmICghdGhpcy5fZXZlbnRzW2V2dF0pIHJldHVybiBmYWxzZTsKICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZ0XSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCwKICAgICAgYXJncywKICAgICAgaTsKICAgIGlmIChsaXN0ZW5lcnMuZm4pIHsKICAgICAgaWYgKGxpc3RlbmVycy5vbmNlKSB0aGlzLnJlbW92ZUxpc3RlbmVyKGV2ZW50LCBsaXN0ZW5lcnMuZm4sIHVuZGVmaW5lZCwgdHJ1ZSk7CiAgICAgIHN3aXRjaCAobGVuKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmV0dXJuIGxpc3RlbmVycy5mbi5jYWxsKGxpc3RlbmVycy5jb250ZXh0KSwgdHJ1ZTsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExKSwgdHJ1ZTsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExLCBhMiksIHRydWU7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgcmV0dXJuIGxpc3RlbmVycy5mbi5jYWxsKGxpc3RlbmVycy5jb250ZXh0LCBhMSwgYTIsIGEzKSwgdHJ1ZTsKICAgICAgICBjYXNlIDU6CiAgICAgICAgICByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExLCBhMiwgYTMsIGE0KSwgdHJ1ZTsKICAgICAgICBjYXNlIDY6CiAgICAgICAgICByZXR1cm4gbGlzdGVuZXJzLmZuLmNhbGwobGlzdGVuZXJzLmNvbnRleHQsIGExLCBhMiwgYTMsIGE0LCBhNSksIHRydWU7CiAgICAgIH0KICAgICAgZm9yIChpID0gMSwgYXJncyA9IG5ldyBBcnJheShsZW4gLSAxKTsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CiAgICAgIH0KICAgICAgbGlzdGVuZXJzLmZuLmFwcGx5KGxpc3RlbmVycy5jb250ZXh0LCBhcmdzKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBsZW5ndGggPSBsaXN0ZW5lcnMubGVuZ3RoLAogICAgICAgIGo7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChsaXN0ZW5lcnNbaV0ub25jZSkgdGhpcy5yZW1vdmVMaXN0ZW5lcihldmVudCwgbGlzdGVuZXJzW2ldLmZuLCB1bmRlZmluZWQsIHRydWUpOwogICAgICAgIHN3aXRjaCAobGVuKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5mbi5jYWxsKGxpc3RlbmVyc1tpXS5jb250ZXh0KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5mbi5jYWxsKGxpc3RlbmVyc1tpXS5jb250ZXh0LCBhMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBsaXN0ZW5lcnNbaV0uZm4uY2FsbChsaXN0ZW5lcnNbaV0uY29udGV4dCwgYTEsIGEyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5mbi5jYWxsKGxpc3RlbmVyc1tpXS5jb250ZXh0LCBhMSwgYTIsIGEzKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoIWFyZ3MpIGZvciAoaiA9IDEsIGFyZ3MgPSBuZXcgQXJyYXkobGVuIC0gMSk7IGogPCBsZW47IGorKykgewogICAgICAgICAgICAgIGFyZ3NbaiAtIDFdID0gYXJndW1lbnRzW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5mbi5hcHBseShsaXN0ZW5lcnNbaV0uY29udGV4dCwgYXJncyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKICAvKioKICAgKiBBZGQgYSBsaXN0ZW5lciBmb3IgYSBnaXZlbiBldmVudC4KICAgKgogICAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBldmVudCBUaGUgZXZlbnQgbmFtZS4KICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBUaGUgbGlzdGVuZXIgZnVuY3Rpb24uCiAgICogQHBhcmFtIHsqfSBbY29udGV4dD10aGlzXSBUaGUgY29udGV4dCB0byBpbnZva2UgdGhlIGxpc3RlbmVyIHdpdGguCiAgICogQHJldHVybnMge0V2ZW50RW1pdHRlcn0gYHRoaXNgLgogICAqIEBwdWJsaWMKICAgKi8KICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gb24oZXZlbnQsIGZuLCBjb250ZXh0KSB7CiAgICByZXR1cm4gYWRkTGlzdGVuZXIodGhpcywgZXZlbnQsIGZuLCBjb250ZXh0LCBmYWxzZSk7CiAgfTsKCiAgLyoqCiAgICogQWRkIGEgb25lLXRpbWUgbGlzdGVuZXIgZm9yIGEgZ2l2ZW4gZXZlbnQuCiAgICoKICAgKiBAcGFyYW0geyhTdHJpbmd8U3ltYm9sKX0gZXZlbnQgVGhlIGV2ZW50IG5hbWUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gVGhlIGxpc3RlbmVyIGZ1bmN0aW9uLgogICAqIEBwYXJhbSB7Kn0gW2NvbnRleHQ9dGhpc10gVGhlIGNvbnRleHQgdG8gaW52b2tlIHRoZSBsaXN0ZW5lciB3aXRoLgogICAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IGB0aGlzYC4KICAgKiBAcHVibGljCiAgICovCiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gb25jZShldmVudCwgZm4sIGNvbnRleHQpIHsKICAgIHJldHVybiBhZGRMaXN0ZW5lcih0aGlzLCBldmVudCwgZm4sIGNvbnRleHQsIHRydWUpOwogIH07CgogIC8qKgogICAqIFJlbW92ZSB0aGUgbGlzdGVuZXJzIG9mIGEgZ2l2ZW4gZXZlbnQuCiAgICoKICAgKiBAcGFyYW0geyhTdHJpbmd8U3ltYm9sKX0gZXZlbnQgVGhlIGV2ZW50IG5hbWUuCiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gT25seSByZW1vdmUgdGhlIGxpc3RlbmVycyB0aGF0IG1hdGNoIHRoaXMgZnVuY3Rpb24uCiAgICogQHBhcmFtIHsqfSBjb250ZXh0IE9ubHkgcmVtb3ZlIHRoZSBsaXN0ZW5lcnMgdGhhdCBoYXZlIHRoaXMgY29udGV4dC4KICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9uY2UgT25seSByZW1vdmUgb25lLXRpbWUgbGlzdGVuZXJzLgogICAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IGB0aGlzYC4KICAgKiBAcHVibGljCiAgICovCiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKGV2ZW50LCBmbiwgY29udGV4dCwgb25jZSkgewogICAgdmFyIGV2dCA9IHByZWZpeCA/IHByZWZpeCArIGV2ZW50IDogZXZlbnQ7CiAgICBpZiAoIXRoaXMuX2V2ZW50c1tldnRdKSByZXR1cm4gdGhpczsKICAgIGlmICghZm4pIHsKICAgICAgY2xlYXJFdmVudCh0aGlzLCBldnQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHNbZXZ0XTsKICAgIGlmIChsaXN0ZW5lcnMuZm4pIHsKICAgICAgaWYgKGxpc3RlbmVycy5mbiA9PT0gZm4gJiYgKCFvbmNlIHx8IGxpc3RlbmVycy5vbmNlKSAmJiAoIWNvbnRleHQgfHwgbGlzdGVuZXJzLmNvbnRleHQgPT09IGNvbnRleHQpKSB7CiAgICAgICAgY2xlYXJFdmVudCh0aGlzLCBldnQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMCwgZXZlbnRzID0gW10sIGxlbmd0aCA9IGxpc3RlbmVycy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGlmIChsaXN0ZW5lcnNbaV0uZm4gIT09IGZuIHx8IG9uY2UgJiYgIWxpc3RlbmVyc1tpXS5vbmNlIHx8IGNvbnRleHQgJiYgbGlzdGVuZXJzW2ldLmNvbnRleHQgIT09IGNvbnRleHQpIHsKICAgICAgICAgIGV2ZW50cy5wdXNoKGxpc3RlbmVyc1tpXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLwogICAgICAvLyBSZXNldCB0aGUgYXJyYXksIG9yIHJlbW92ZSBpdCBjb21wbGV0ZWx5IGlmIHdlIGhhdmUgbm8gbW9yZSBsaXN0ZW5lcnMuCiAgICAgIC8vCiAgICAgIGlmIChldmVudHMubGVuZ3RoKSB0aGlzLl9ldmVudHNbZXZ0XSA9IGV2ZW50cy5sZW5ndGggPT09IDEgPyBldmVudHNbMF0gOiBldmVudHM7ZWxzZSBjbGVhckV2ZW50KHRoaXMsIGV2dCk7CiAgICB9CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvKioKICAgKiBSZW1vdmUgYWxsIGxpc3RlbmVycywgb3IgdGhvc2Ugb2YgdGhlIHNwZWNpZmllZCBldmVudC4KICAgKgogICAqIEBwYXJhbSB7KFN0cmluZ3xTeW1ib2wpfSBbZXZlbnRdIFRoZSBldmVudCBuYW1lLgogICAqIEByZXR1cm5zIHtFdmVudEVtaXR0ZXJ9IGB0aGlzYC4KICAgKiBAcHVibGljCiAgICovCiAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnMgPSBmdW5jdGlvbiByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnQpIHsKICAgIHZhciBldnQ7CiAgICBpZiAoZXZlbnQpIHsKICAgICAgZXZ0ID0gcHJlZml4ID8gcHJlZml4ICsgZXZlbnQgOiBldmVudDsKICAgICAgaWYgKHRoaXMuX2V2ZW50c1tldnRdKSBjbGVhckV2ZW50KHRoaXMsIGV2dCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9ldmVudHMgPSBuZXcgRXZlbnRzKCk7CiAgICAgIHRoaXMuX2V2ZW50c0NvdW50ID0gMDsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH07CgogIC8vCiAgLy8gQWxpYXMgbWV0aG9kcyBuYW1lcyBiZWNhdXNlIHBlb3BsZSByb2xsIGxpa2UgdGhhdC4KICAvLwogIEV2ZW50RW1pdHRlci5wcm90b3R5cGUub2ZmID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcjsKICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmFkZExpc3RlbmVyID0gRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vbjsKCiAgLy8KICAvLyBFeHBvc2UgdGhlIHByZWZpeC4KICAvLwogIEV2ZW50RW1pdHRlci5wcmVmaXhlZCA9IHByZWZpeDsKCiAgLy8KICAvLyBBbGxvdyBgRXZlbnRFbWl0dGVyYCB0byBiZSBpbXBvcnRlZCBhcyBtb2R1bGUgbmFtZXNwYWNlLgogIC8vCiAgRXZlbnRFbWl0dGVyLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjsKCiAgLy8KICAvLyBFeHBvc2UgdGhlIG1vZHVsZS4KICAvLwogIHsKICAgIG1vZHVsZS5leHBvcnRzID0gRXZlbnRFbWl0dGVyOwogIH0KfSkoZXZlbnRlbWl0dGVyMyk7CnZhciBldmVudGVtaXR0ZXIzRXhwb3J0cyA9IGV2ZW50ZW1pdHRlcjMuZXhwb3J0czsKdmFyIEV2ZW50RW1pdHRlciA9IC8qQF9fUFVSRV9fKi9nZXREZWZhdWx0RXhwb3J0RnJvbUNqcyhldmVudGVtaXR0ZXIzRXhwb3J0cyk7CgovKioNCiAqIEV2ZW50RW1pdHRlciBmcm9tIGV2ZW50ZW1pdHRlcjMNCiAqDQogKiBTZWU6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vcHJpbXVzL2V2ZW50ZW1pdHRlcjMgZXZlbnRlbWl0dGVyM30NCiAqDQogKiBVbml0IFRlc3Q6IHtAbGluayBodHRwczovL2dpdGh1Yi5jb20veXVkYS1seXUvd3NlbWkvYmxvYi9tYXN0ZXIvdGVzdC9ldmVtLnRlc3QubWpzIEdpdGh1Yn0NCiAqIEBtZW1iZXJPZiB3c2VtaQ0KICogQGV4YW1wbGUNCiAqDQogKiBsZXQgZXYgPSB3c2VtaS5ldmVtKCkNCiAqIGV2Lm9uKCdldk5hbWUnLGZ1bmN0aW9uKG1zZyl7DQogKiAgICAgY29uc29sZS5sb2cobXNnKQ0KICogICAgIC8vID0+IHthYmM6IDEyLjM0fQ0KICogfSkNCiAqIGxldCBkYXRhID0ge2FiYzoxMi4zNH0NCiAqIGV2LmVtaXQoJ2V2TmFtZScsZGF0YSkNCiAqDQogKi8KZnVuY3Rpb24gZXZlbSgpIHsKICByZXR1cm4gbmV3IEV2ZW50RW1pdHRlcigpOwp9CgovKioNCiAqIOetieW+hWblh73mlbjlm57lgrN0cnVlDQogKg0KICogVW5pdCBUZXN0OiB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3l1ZGEtbHl1L3dzZW1pL2Jsb2IvbWFzdGVyL3Rlc3Qvd2FpdEZ1bi50ZXN0Lm1qcyBHaXRodWJ9DQogKiBAbWVtYmVyT2Ygd3NlbWkNCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZ1biDovLjlhaXliKTmlrfnlKjlh73mlbgNCiAqIEBwYXJhbSB7T2JqZWN0fSBvcHQg6Ly45YWl6Kit5a6a54mp5Lu277yM6aCQ6Kite30NCiAqIEBwYXJhbSB7SW50ZWdlcn0gW29wdC5hdHRlbXB0TnVtPTIwMF0g6Ly45YWl5pyA5aSn5ZiX6Kmm5qyh5pW477yM54K65q2j5pW05pW477yM6aCQ6KitMjAwDQogKiBAcGFyYW0ge0ludGVnZXJ9IFtvcHQudGltZUludGVydmFsPTEwMDBdIOi8uOWFpeWYl+ippuaZgumWk+mAseacn++8jOeCuuato+aVtOaVuO+8jOWWruS9jeeCum1z77yM6aCQ6KitMTAwMA0KICogQHJldHVybnMge1Byb21pc2V9IOWbnuWCs1Byb21pc2XvvIxyZXNvbHZl5Zue5YKz54K656m65Luj6KGoZuWHveaVuOWbnuWCs3RydWXmiJbotoXpgY7mnIDlpKflmJfoqabmrKHmlbjvvIxyZWplY3Tlm57lgrPpjK/oqqToqIrmga8NCiAqIEBleGFtcGxlDQogKg0KICogYXN5bmMgZnVuY3Rpb24gdG9wQXN5bmMoKSB7DQogKg0KICogICAgIGZ1bmN0aW9uIHRlc3QxKCkgew0KICogICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICogICAgICAgICAgICAgbGV0IG1zID0gW10NCiAqDQogKiAgICAgICAgICAgICBsZXQgaSA9IDANCiAqICAgICAgICAgICAgIHdhaXRGdW4oZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgaSsrDQogKiAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3dhaXRpbmc6ICcgKyBpKQ0KICogICAgICAgICAgICAgICAgIG1zLnB1c2goJ3dhaXRpbmc6ICcgKyBpKQ0KICogICAgICAgICAgICAgICAgIHJldHVybiBpID49IDINCiAqICAgICAgICAgICAgIH0pDQogKiAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0ZXN0MSB0aGVuJykNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCgndGVzdDEgdGhlbicpDQogKiAgICAgICAgICAgICAgICAgfSkNCiAqDQogKiAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICogICAgICAgICAgICAgICAgIHJlc29sdmUobXMpDQogKiAgICAgICAgICAgICB9LCAxMTAwKQ0KICoNCiAqICAgICAgICAgfSkNCiAqICAgICB9DQogKiAgICAgY29uc29sZS5sb2coJ3Rlc3QxJykNCiAqICAgICBsZXQgcjEgPSBhd2FpdCB0ZXN0MSgpDQogKiAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocjEpKQ0KICogICAgIC8vIHRlc3QxDQogKiAgICAgLy8gd2FpdGluZzogMQ0KICogICAgIC8vIHdhaXRpbmc6IDINCiAqICAgICAvLyB0ZXN0MSB0aGVuDQogKiAgICAgLy8gWyJ3YWl0aW5nOiAxIiwid2FpdGluZzogMiIsInRlc3QxIHRoZW4iXQ0KICoNCiAqICAgICBmdW5jdGlvbiB0ZXN0MigpIHsNCiAqICAgICAgICAgbGV0IG1zID0gW10NCiAqICAgICAgICAgbGV0IGkgPSAwDQogKg0KICogICAgICAgICBsZXQgZiA9ICgpID0+IHsNCiAqICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogKiAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAqICAgICAgICAgICAgICAgICAgICAgaSsrDQogKiAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd3YWl0aW5nOiAnICsgaSkNCiAqICAgICAgICAgICAgICAgICAgICAgbXMucHVzaCgnd2FpdGluZzogJyArIGkpDQogKiAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoaSA+PSAyKQ0KICogICAgICAgICAgICAgICAgIH0sIDExMDApDQogKiAgICAgICAgICAgICB9KQ0KICogICAgICAgICB9DQogKg0KICogICAgICAgICByZXR1cm4gd2FpdEZ1bihmKQ0KICogICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7DQogKiAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Rlc3QyIHRoZW4nKQ0KICogICAgICAgICAgICAgICAgIG1zLnB1c2goJ3Rlc3QyIHRoZW4nKQ0KICogICAgICAgICAgICAgICAgIHJldHVybiBtcw0KICogICAgICAgICAgICAgfSkNCiAqDQogKiAgICAgfQ0KICogICAgIGNvbnNvbGUubG9nKCd0ZXN0MicpDQogKiAgICAgbGV0IHIyID0gYXdhaXQgdGVzdDIoKQ0KICogICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHIyKSkNCiAqICAgICAvLyB0ZXN0Mg0KICogICAgIC8vIHdhaXRpbmc6IDENCiAqICAgICAvLyB3YWl0aW5nOiAyDQogKiAgICAgLy8gdGVzdDIgdGhlbg0KICogICAgIC8vIFsid2FpdGluZzogMSIsIndhaXRpbmc6IDIiLCJ0ZXN0MiB0aGVuIl0NCiAqICAgICAvLyB3YWl0aW5nOiAzDQogKg0KICogfQ0KICogdG9wQXN5bmMoKS5jYXRjaCgoKSA9PiB7fSkNCiAqDQogKi8KYXN5bmMgZnVuY3Rpb24gd2FpdEZ1bihmdW4sIG9wdCA9IHt9KSB7CiAgbGV0IHIgPSBudWxsOwoKICAvL3BtCiAgbGV0IHBtID0gZ2VuUG0oKTsKCiAgLy9jaGVjawogIGlmICghaXNmdW4oZnVuKSkgewogICAgcG0ucmVqZWN0KCd3YWl0ZnVuY3Rpb27pnIDovLjlhaXlh73mlbhmJyk7CiAgICByZXR1cm4gcG07CiAgfQoKICAvL2Z1bmMKICBsZXQgZnVuYyA9IGFzeW5jICgpID0+IHsKICAgIGxldCByID0gZnVuKCk7CiAgICBpZiAoaXNwbShyKSkgewogICAgICByID0gYXdhaXQgcjsKICAgIH0KICAgIHJldHVybiByOwogIH07CgogIC8vaW1tZWRpYXRlIGNhbGwKICByID0gYXdhaXQgZnVuYygpOwogIGlmIChyID09PSB0cnVlKSB7CiAgICBwbS5yZXNvbHZlKCk7CiAgICByZXR1cm4gcG07CiAgfQoKICAvL2F0dGVtcHROdW0KICBsZXQgYXR0ZW1wdE51bSA9IGdldChvcHQsICdhdHRlbXB0TnVtJywgbnVsbCk7CiAgaWYgKCFpc3BpbnQoYXR0ZW1wdE51bSkpIHsKICAgIGF0dGVtcHROdW0gPSAyMDA7CiAgfQoKICAvL3RpbWVJbnRlcnZhbAogIGxldCB0aW1lSW50ZXJ2YWwgPSBnZXQob3B0LCAndGltZUludGVydmFsJywgbnVsbCk7CiAgaWYgKCFpc3BpbnQodGltZUludGVydmFsKSkgewogICAgdGltZUludGVydmFsID0gMTAwMDsKICB9CgogIC8vc2V0SW50ZXJ2YWwKICBsZXQgbiA9IDA7CiAgbGV0IHQgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiAgICBuICs9IDE7CiAgICAvL2NvbnNvbGUubG9nKCd3YWl0RnVuOiAnLCBuKQoKICAgIHIgPSBhd2FpdCBmdW5jKCk7CiAgICBpZiAociA9PT0gdHJ1ZSkgewogICAgICAvL2NvbnNvbGUubG9nKCdyZXNvbHZlJywgbikKICAgICAgY2xlYXJJbnRlcnZhbCh0KTsKICAgICAgcG0ucmVzb2x2ZSgpOwogICAgfQogICAgaWYgKG4gPiBhdHRlbXB0TnVtKSB7CiAgICAgIC8vY29uc29sZS5sb2coJ3JlamVjdCcsIG4sIGF0dGVtcHROdW0pCiAgICAgIGNsZWFySW50ZXJ2YWwodCk7CiAgICAgIHBtLnJlamVjdChgZXhjZWVkZWQgYXR0ZW1wdE51bVske2F0dGVtcHROdW19XWApOyAvL+W3sui2hemBjuacgOWkp+asoeaVuAogICAgfQogIH0sIHRpbWVJbnRlcnZhbCk7CiAgcmV0dXJuIHBtOwp9CgovKioNCiAqIOW7uueri+S4gOWAiyBNUVRUIOWuouaItuerr++8jOaUr+aPtOaMgeS5hemAo+e3muOAgVRva2VuIOmpl+itieOAgeiHquWLlemHjemAo+OAgeiogumWseiIh+eZvOS9iOWKn+iDvQ0KICoNCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0PXt9XSAtIOioreWumumBuOmghQ0KICogQHBhcmFtIHtTdHJpbmd9IFtvcHQudXJsPSdtcXR0Oi8vbG9jYWxob3N0J10gLSBNUVRUIGJyb2tlciDpgKPnt5ogVVJMDQogKiBAcGFyYW0ge051bWJlcn0gW29wdC5wb3J0PTgwODBdIC0gQnJva2VyIOmAo+e3miBwb3J0DQogKiBAcGFyYW0ge1N0cmluZ30gW29wdC50b2tlbj0nJ10gLSDpgKPnt5rmmYLnlKjkvobpqZforYnnmoQgVG9rZW4NCiAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0LmNsaWVudElkXSAtIOaMh+WumiBDbGllbnQgSUTvvIzoi6XmnKrmjIflrprliYfoh6rli5XnlKLnlJ8NCiAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0LnRpbWVSZWNvbm5lY3Q9MjAwMF0gLSDmlrfnt5rlvozph43mlrDpgKPnt5rnmoTplpPpmpTmmYLplpPvvIjmr6vnp5LvvIkNCiAqIEByZXR1cm5zIHtPYmplY3R9IC0g5YKz5Zue5LiA5YCL5YW35pyJIGBzdWJzY3JpYmVg44CBYHVuc3Vic2NyaWJlYOOAgWBwdWJsaXNoYOOAgWBjbGVhcmAg5pa55rOV55qE5LqL5Lu254mp5Lu2DQogKiBAZXhhbXBsZQ0KICoNCiAqIGltcG9ydCB3IGZyb20gJ3dzZW1pJw0KICogaW1wb3J0IFdQdWJzdWJDbGllbnQgZnJvbSAnLi9zcmMvV1B1YnN1YkNsaWVudC5tanMnDQogKiAvLyBpbXBvcnQgV1B1YnN1YkNsaWVudCBmcm9tICcuL2Rpc3Qvdy1wdWJzdWItY2xpZW50LnVtZC5qcycNCiAqIC8vIGltcG9ydCBXUHVic3ViQ2xpZW50IGZyb20gJy4vZGlzdC93LXB1YnN1Yi1jbGllbnQud2sudW1kLmpzJw0KICoNCiAqIGxldCB0ZXN0ID0gYXN5bmMgKCkgPT4gew0KICogICAgIGxldCBwbSA9IHcuZ2VuUG0oKQ0KICoNCiAqICAgICBsZXQgbXMgPSBbXQ0KICoNCiAqICAgICBsZXQgY2xpZW50SWQgPSAnaWQtZm9yLWNsaWVudCcNCiAqDQogKiAgICAgbGV0IG9wdCA9IHsNCiAqICAgICAgICAgcG9ydDogODA4MCwNCiAqICAgICAgICAgdG9rZW46ICd0b2tlbi1mb3ItdGVzdCcsDQogKiAgICAgICAgIGNsaWVudElkLA0KICogICAgIH0NCiAqICAgICBsZXQgd3BjID0gbmV3IFdQdWJzdWJDbGllbnQob3B0KQ0KICogICAgIC8vIGNvbnNvbGUubG9nKCd3cGMnLCB3cGMpDQogKg0KICogICAgIGxldCB0b3BpYyA9ICd0YXNrJw0KICoNCiAqICAgICB3cGMub24oJ2Nvbm5lY3QnLCAoKSA9PiB7DQogKiAgICAgICAgIGNvbnNvbGUubG9nKCdjb25uZWN0JykNCiAqICAgICAgICAgbXMucHVzaCh7IGNsaWVudElkOiBgY29ubmVjdGAgfSkNCiAqICAgICB9KQ0KICogICAgIHdwYy5vbigncmVjb25uZWN0JywgKCkgPT4gew0KICogICAgICAgICBjb25zb2xlLmxvZygncmVjb25uZWN0JykNCiAqICAgICB9KQ0KICogICAgIHdwYy5vbignb2ZmbGluZScsICgpID0+IHsNCiAqICAgICAgICAgY29uc29sZS5sb2coJ29mZmxpbmUnKQ0KICogICAgIH0pDQogKiAgICAgd3BjLm9uKCdtZXNzYWdlJywgKHsgdG9waWMsIG1lc3NhZ2UgfSkgPT4gew0KICogICAgICAgICBjb25zb2xlLmxvZyhgbWVzc2FnZWAsIHRvcGljLCBtZXNzYWdlKQ0KICogICAgICAgICBtcy5wdXNoKHsgY2xpZW50SWQ6IGByZWNlaXZlIHRvcGljWyR7dG9waWN9XSwgbWVzc2FnZVske21lc3NhZ2V9XWAgfSkNCiAqICAgICB9KQ0KICogICAgIHdwYy5vbignY2xvc2UnLCAoKSA9PiB7DQogKiAgICAgICAgIGNvbnNvbGUubG9nKCdjbG9zZScpDQogKiAgICAgICAgIG1zLnB1c2goeyBjbGllbnRJZDogYGNsb3NlYCB9KQ0KICogICAgIH0pDQogKiAgICAgd3BjLm9uKCdlbmQnLCAoKSA9PiB7DQogKiAgICAgICAgIGNvbnNvbGUubG9nKCdlbmQnKQ0KICogICAgIH0pDQogKiAgICAgd3BjLm9uKCdlcnJvcicsIChlcnIpID0+IHsNCiAqICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJywgZXJyKQ0KICogICAgIH0pDQogKg0KICogICAgIGF3YWl0IHdwYy5zdWJzY3JpYmUodG9waWMsIDIpDQogKiAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWJzY3JpYmUgdGhlbicsIHJlcykNCiAqICAgICAgICAgICAgIG1zLnB1c2goeyBjbGllbnRJZDogYHN1YnNjcmliZWAsIHN1YnNjcmlwdGlvbnM6IEpTT04uc3RyaW5naWZ5KHJlcykgfSkNCiAqICAgICAgICAgfSkNCiAqICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzdWJzY3JpYmUgY2F0Y2gnLCBlcnIpDQogKiAgICAgICAgIH0pDQogKg0KICogICAgIGF3YWl0IHdwYy5wdWJsaXNoKHRvcGljLCAncmVzdWx0JywgMikNCiAqICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICogICAgICAgICAgICAgY29uc29sZS5sb2coJ3B1Ymxpc2ggdGhlbicsIHJlcykNCiAqICAgICAgICAgICAgIG1zLnB1c2goeyBjbGllbnRJZDogYHB1Ymxpc2hgLCByZXMgfSkNCiAqICAgICAgICAgfSkNCiAqICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsNCiAqICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwdWJsaXNoIGNhdGNoJywgZXJyKQ0KICogICAgICAgICB9KQ0KICoNCiAqICAgICBzZXRUaW1lb3V0KGFzeW5jKCkgPT4gew0KICogICAgICAgICBhd2FpdCB3cGMuY2xlYXIoKQ0KICogICAgICAgICB0cnkgeyAvL+S9v+eUqHdvcmtlcueJiOaZguimgeWPpuWkluWRvOWPq3Rlcm1pbmF0ZeS4reatog0KICogICAgICAgICAgICAgd3BjLnRlcm1pbmF0ZSgpDQogKiAgICAgICAgIH0NCiAqICAgICAgICAgY2F0Y2ggKGVycikge30NCiAqICAgICAgICAgY29uc29sZS5sb2coJ21zJywgbXMpDQogKiAgICAgICAgIHBtLnJlc29sdmUobXMpDQogKiAgICAgfSwgNTAwMCkNCiAqDQogKiAgICAgcmV0dXJuIHBtDQogKiB9DQogKiBhd2FpdCB0ZXN0KCkNCiAqICAgICAuY2F0Y2goKGVycikgPT4gew0KICogICAgICAgICBjb25zb2xlLmxvZyhlcnIpDQogKiAgICAgfSkNCiAqIC8vID0+IG1zIFsNCiAqIC8vICAgeyBjbGllbnRJZDogJ2Nvbm5lY3QnIH0sDQogKiAvLyAgIHsNCiAqIC8vICAgICBjbGllbnRJZDogJ3N1YnNjcmliZScsDQogKiAvLyAgICAgc3Vic2NyaXB0aW9uczogJ1t7InRvcGljIjoidGFzayIsInFvcyI6Mn1dJw0KICogLy8gICB9LA0KICogLy8gICB7IGNsaWVudElkOiAncHVibGlzaCcsIHJlczogJ2RvbmUnIH0sDQogKiAvLyAgIHsgY2xpZW50SWQ6ICdyZWNlaXZlIHRvcGljW3Rhc2tdJyB9LA0KICogLy8gICB7IGNsaWVudElkOiAnY2xvc2UnIH0NCiAqIC8vIF0NCiAqDQogKi8KZnVuY3Rpb24gV1B1YnN1YkNsaWVudChvcHQgPSB7fSkgewogIC8va2V5TXNnCiAgbGV0IGtleU1zZyA9ICdfX21zZ19fJzsKCiAgLy91cmwKICBsZXQgdXJsID0gZ2V0KG9wdCwgJ3VybCcpOwogIGlmICghaXNlc3RyKHVybCkpIHsKICAgIHVybCA9ICdtcXR0Oi8vbG9jYWxob3N0JzsKICB9CgogIC8vcG9ydAogIGxldCBwb3J0ID0gZ2V0KG9wdCwgJ3BvcnQnKTsKICBpZiAoIWlzcGludChwb3J0KSkgewogICAgcG9ydCA9IDgwODA7CiAgfQogIHBvcnQgPSBjaW50KHBvcnQpOwoKICAvL3Rva2VuCiAgbGV0IHRva2VuID0gZ2V0KG9wdCwgJ3Rva2VuJyk7CiAgaWYgKCFpc2VzdHIodG9rZW4pKSB7CiAgICB0b2tlbiA9ICcnOwogIH0KCiAgLy9jbGllbnRJZAogIGxldCBjbGllbnRJZCA9IGdldChvcHQsICdjbGllbnRJZCcpOwogIGlmICghaXNlc3RyKGNsaWVudElkKSkgewogICAgY2xpZW50SWQgPSBgY2wtJHtnZW5JRCgpfWA7CiAgfQoKICAvL3RpbWVSZWNvbm5lY3QKICBsZXQgdGltZVJlY29ubmVjdCA9IGdldChvcHQsICd0aW1lUmVjb25uZWN0Jyk7CiAgaWYgKCFpc3BpbnQodGltZVJlY29ubmVjdCkpIHsKICAgIHRpbWVSZWNvbm5lY3QgPSAyMDAwOwogIH0KICB0aW1lUmVjb25uZWN0ID0gY2ludCh0aW1lUmVjb25uZWN0KTsKCiAgLy91cmxCcm9rZXIKICBsZXQgdXJsQnJva2VyID0gYCR7dXJsfToke3BvcnR9YDsKCiAgLy9jbGllbnQKICBsZXQgY2xpZW50ID0gbXF0dC5jb25uZWN0KHVybEJyb2tlciwgewogICAgY2xpZW50SWQsCiAgICB1c2VybmFtZTogdG9rZW4sCiAgICAvL+aPkOS+m3Rva2Vu6amX6K2JCiAgICBwYXNzd29yZDogJycsCiAgICAvL+S4jeaPkOS+mwogICAgY2xlYW46IGZhbHNlLAogICAgLy/oqK3lrprmjIHkuYVTZXNzaW9uKOmboue3muijnOaUtikKICAgIHJlY29ubmVjdFBlcmlvZDogdGltZVJlY29ubmVjdCAvL+aWt+e3muW+jOiHquWLlemHjemAo+aZgumWkwogIH0pOwoKICAvL2V2CiAgbGV0IGV2ID0gZXZlbSgpOwoKICAvL29ubGluZQogIGxldCBvbmxpbmUgPSBmYWxzZTsKCiAgLy9jb25uZWN0CiAgY2xpZW50Lm9uKCdjb25uZWN0JywgKCkgPT4gewogICAgLy8gY29uc29sZS5sb2coYGNsaWVudCBpbmAsIGNsaWVudElkKQogICAgb25saW5lID0gdHJ1ZTsKICAgIGV2LmVtaXQoJ2Nvbm5lY3QnKTsKICB9KTsKCiAgLy9yZWNvbm5lY3QsIOiHquWLlemHjemAo+acn+mWk+avj+asoXJldHJ56YO95pyD6Ke455m85LiA5qyhCiAgY2xpZW50Lm9uKCdyZWNvbm5lY3QnLCAoKSA9PiB7CiAgICAvLyBjb25zb2xlLmxvZyhgY2xpZW50IHJlY29ubmVjdGAsIGNsaWVudElkKQogICAgZXYuZW1pdCgncmVjb25uZWN0Jyk7CiAgfSk7CgogIC8vc3Vic2NyaWJlCiAgbGV0IHN1YnNjcmliZSA9IGFzeW5jICh0b3BpYywgcW9zID0gMikgPT4gewogICAgLy9xb3M6CiAgICAvLzAsIOacgOWkmumAgeS4gOasoQogICAgLy8xLCDoh7PlsJHpgIHkuIDmrKEsIOS/neitiemAgeWIsOS9huWPr+iDvemHjeikh+mAgQogICAgLy8yLCDliZvlpb3pgIHkuIDmrKEsIOS/neitieWPqumAgeS4gOasoeS4lOS4jemHjeikhwoKICAgIC8vcG0KICAgIGxldCBwbSA9IGdlblBtKCk7CgogICAgLy93YWl0IG9ubGluZQogICAgYXdhaXQgd2FpdEZ1bigoKSA9PiB7CiAgICAgIHJldHVybiBvbmxpbmU7CiAgICB9KTsKCiAgICAvL+iogumWseS4u+mhjAogICAgY2xpZW50LnN1YnNjcmliZSh0b3BpYywgewogICAgICBxb3MKICAgIH0sIChlcnIsIGdyYW50ZWQpID0+IHsKICAgICAgLy8gZ3JhbnRlZCA9PiBbCiAgICAgIC8vICAgeyB0b3BpYzogJ2dlbmVyYXRlL3JlcG9ydCcsIHFvczogMiB9LAogICAgICAvLyAgIHsgdG9waWM6ICduZXdzL3VwZGF0ZScsIHFvczogMSB9CiAgICAgIC8vIF0KICAgICAgaWYgKGVycikgewogICAgICAgIHBtLnJlamVjdChlcnIpOwogICAgICB9IGVsc2UgewogICAgICAgIHBtLnJlc29sdmUoZ3JhbnRlZCk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHBtOwogIH07CgogIC8vdW5zdWJzY3JpYmUKICBsZXQgdW5zdWJzY3JpYmUgPSBhc3luYyB0b3BpYyA9PiB7CiAgICAvL3BtCiAgICBsZXQgcG0gPSBnZW5QbSgpOwoKICAgIC8vd2FpdCBvbmxpbmUKICAgIGF3YWl0IHdhaXRGdW4oKCkgPT4gewogICAgICByZXR1cm4gb25saW5lOwogICAgfSk7CgogICAgLy/lj5bmtojoqILplrHkuLvpoYwKICAgIGNsaWVudC51bnN1YnNjcmliZSh0b3BpYywgZXJyID0+IHsKICAgICAgaWYgKGVycikgewogICAgICAgIHBtLnJlamVjdChlcnIpOwogICAgICB9IGVsc2UgewogICAgICAgIHBtLnJlc29sdmUoKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gcG07CiAgfTsKCiAgLy9wdWJsaXNoCiAgbGV0IHB1Ymxpc2ggPSBhc3luYyAodG9waWMsIG1zZywgcW9zID0gMikgPT4gewogICAgLy9xb3M6CiAgICAvLzAsIOacgOWkmumAgeS4gOasoQogICAgLy8xLCDoh7PlsJHpgIHkuIDmrKEsIOS/neitiemAgeWIsOS9huWPr+iDvemHjeikh+mAgQogICAgLy8yLCDliZvlpb3pgIHkuIDmrKEsIOS/neitieWPqumAgeS4gOasoeS4lOS4jemHjeikhwoKICAgIC8vd2FpdCBvbmxpbmUKICAgIGF3YWl0IHdhaXRGdW4oKCkgPT4gewogICAgICByZXR1cm4gb25saW5lOwogICAgfSk7CgogICAgLy9wYXlsb2FkLCDlnovliKXlj6/mlK/mj7Q6IFN0cmluZywgQnVmZmVyLCBVaW50OEFycmF5LCBOdW1iZXIsIE9iamVjdCjopoFKU09OLnN0cmluZ2lmeSkKICAgIGxldCBwYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkoewogICAgICBba2V5TXNnXTogbXNnCiAgICB9KTsgLy/lsIHoo53oh7Ntc2flj6/nsKHljJbkvb/nlKjlnovliKUsIOWDheaUr+aPtE9iamVjdCwgU3RyaW5nLCBOdW1iZXIsIEJvb2xlYW4KICAgIC8vIGNvbnNvbGUubG9nKCdtc2cnLCBtc2cpCiAgICAvLyBjb25zb2xlLmxvZygncGF5bG9hZCcsIHBheWxvYWQpCgogICAgLy9wbQogICAgbGV0IHBtID0gZ2VuUG0oKTsKCiAgICAvL+eZvOW4g+S4u+mhjAogICAgY2xpZW50LnB1Ymxpc2godG9waWMsIHBheWxvYWQsIHsKICAgICAgcW9zCiAgICB9LCBlcnIgPT4gewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgcG0ucmVqZWN0KGVycik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG0ucmVzb2x2ZSgnZG9uZScpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBwbTsKICB9OwoKICAvL21lc3NhZ2UKICBjbGllbnQub24oJ21lc3NhZ2UnLCAodG9waWMsIG1lc3NhZ2UpID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKGBjbGllbnQgcmVjZWl2ZWAsIGNsaWVudElkLCB0b3BpYywgbWVzc2FnZSkKICAgIGxldCBfbWVzc2FnZSA9ICcnOwogICAgdHJ5IHsKICAgICAgbGV0IGogPSBtZXNzYWdlLnRvU3RyaW5nKCk7IC8vbXF0dOaOpeaUtm1lc3NhZ2XmmYLmnIPorormiJBCdWZmZXIsIOW+l+i9iW1lc3NhZ2UudG9TdHJpbmcoKQogICAgICAvLyBjb25zb2xlLmxvZygnbWVzc2FnZSBqJywgaikKICAgICAgbGV0IG8gPSBqMm8oaik7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdtZXNzYWdlIG8nLCBvKQogICAgICBfbWVzc2FnZSA9IGdldChvLCBrZXlNc2csICcnKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICBjb25zb2xlLmxvZyhlcnIpOwogICAgfQogICAgZXYuZW1pdCgnbWVzc2FnZScsIHsKICAgICAgdG9waWMsCiAgICAgIG1lc3NhZ2U6IF9tZXNzYWdlCiAgICB9KTsKICB9KTsKCiAgLy8gLy9zaW1wbGlmeUVycm9yCiAgLy8gbGV0IHNpbXBsaWZ5RXJyb3IgPSAoZXJyKSA9PiB7CiAgLy8gICAgIGlmIChlcnIgaW5zdGFuY2VvZiBBZ2dyZWdhdGVFcnJvciAmJiBBcnJheS5pc0FycmF5KGVyci5lcnJvcnMpKSB7CiAgLy8gICAgICAgICByZXR1cm4gZXJyLmVycm9ycy5tYXAoZSA9PiBgWyR7ZS5hZGRyZXNzfToke2UucG9ydH1dICR7ZS5jb2RlfWApLmpvaW4oJyB8ICcpCiAgLy8gICAgIH0KICAvLyAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yKSB7CiAgLy8gICAgICAgICByZXR1cm4gZXJyLm1lc3NhZ2UgfHwgU3RyaW5nKGVycikKICAvLyAgICAgfQogIC8vICAgICByZXR1cm4gU3RyaW5nKGVycikKICAvLyB9CgogIC8vZXJyb3IKICBjbGllbnQub24oJ2Vycm9yJywgZXJyID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKGBjbGllbnQgZXJyb3JgLCBjbGllbnRJZCwgZXJyLm1lc3NhZ2UpCiAgICBldi5lbWl0KCdlcnJvcicsIGVycik7CiAgICAvLyBldi5lbWl0KCdlcnJvcicsIHNpbXBsaWZ5RXJyb3IoZXJyKSwgZXJyKQogIH0pOwoKICAvL29mZmxpbmUsIGNsaWVudOWIpOWumuW3sumboue3mueEoeazleWGjeiIh2Jyb2tlcua6nemAmuaZguinuOeZvAogIGNsaWVudC5vbignb2ZmbGluZScsICgpID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKGBjbGllbnQgb2ZmbGluZWAsIGNsaWVudElkKQogICAgb25saW5lID0gZmFsc2U7CiAgICBldi5lbWl0KCdvZmZsaW5lJyk7CiAgfSk7CgogIC8vY2xvc2UKICBjbGllbnQub24oJ2Nsb3NlJywgKCkgPT4gewogICAgLy8gY29uc29sZS5sb2coYGNsaWVudCBjbG9zZWAsIGNsaWVudElkKQogICAgb25saW5lID0gZmFsc2U7CiAgICBldi5lbWl0KCdjbG9zZScpOwogIH0pOwoKICAvL2VuZCwg5ZG85Y+rY2xpZW50LmVuZCgp5b6M6Ke455m8CiAgY2xpZW50Lm9uKCdlbmQnLCAoKSA9PiB7CiAgICAvLyBjb25zb2xlLmxvZyhgY2xpZW50IGVuZGAsIGNsaWVudElkKQogICAgb25saW5lID0gZmFsc2U7CiAgICBldi5lbWl0KCdlbmQnKTsKICB9KTsKCiAgLy9jbGVhcgogIGxldCBjbGVhciA9ICgpID0+IHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNsaWVudC5lbmQoZmFsc2UsIHt9LCBlcnIgPT4gewogICAgICAgIGlmIChlcnIpIHsKICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKTsKICAgICAgICB9CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KTsKICAgIH0pOwogIH07CgogIC8vc2F2ZQogIGV2LnN1YnNjcmliZSA9IHN1YnNjcmliZTsKICBldi51bnN1YnNjcmliZSA9IHVuc3Vic2NyaWJlOwogIGV2LnB1Ymxpc2ggPSBwdWJsaXNoOwogIGV2LmNsZWFyID0gY2xlYXI7CiAgcmV0dXJuIGV2Owp9CgovKioNCiAqIOW7uueri+S4gOWAiyBNUVRUIOWuouaItuerr++8jOaUr+aPtOaMgeS5hemAo+e3muOAgVRva2VuIOmpl+itieOAgeiHquWLlemHjemAo+OAgeiogumWseiIh+eZvOS9iOWKn+iDvQ0KICoNCiAqIEBwYXJhbSB7U3RyaW5nfSBzZXJ2aWNlTmFtZSAtIOacjeWLmeWQjeeosQ0KICogQHBhcmFtIHtBcnJheX0gZnVuY3MgLSDlh73mlbjlkI3nqLHpmaPliJcNCiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0PXt9XSAtIOioreWumumBuOmghQ0KICogQHBhcmFtIHtTdHJpbmd9IFtvcHQudXJsPSdtcXR0Oi8vbG9jYWxob3N0J10gLSBNUVRUIGJyb2tlciDpgKPnt5ogVVJMDQogKiBAcGFyYW0ge051bWJlcn0gW29wdC5wb3J0PTgwODBdIC0gQnJva2VyIOmAo+e3miBwb3J0DQogKiBAcGFyYW0ge1N0cmluZ30gW29wdC50b2tlbj0nJ10gLSDpgKPnt5rmmYLnlKjkvobpqZforYnnmoQgVG9rZW4NCiAqIEBwYXJhbSB7U3RyaW5nfSBbb3B0LmNsaWVudElkXSAtIOaMh+WumiBDbGllbnQgSUTvvIzoi6XmnKrmjIflrprliYfoh6rli5XnlKLnlJ8NCiAqIEBwYXJhbSB7TnVtYmVyfSBbb3B0LnRpbWVSZWNvbm5lY3Q9MjAwMF0gLSDmlrfnt5rlvozph43mlrDpgKPnt5rnmoTplpPpmpTmmYLplpPvvIjmr6vnp5LvvIkNCiAqIEByZXR1cm5zIHtPYmplY3R9IC0g5YKz5Zue5LiA5YCL5YW35pyJIGBzdWJzY3JpYmVg44CBYHVuc3Vic2NyaWJlYOOAgWBwdWJsaXNoYOOAgWBjbGVhcmAg5pa55rOV55qE5LqL5Lu254mp5Lu2DQogKiBAZXhhbXBsZQ0KDQogKi8KZnVuY3Rpb24gV1B1YnN1YkNsaWVudENvbXUoc2VydmljZU5hbWUsIGZ1bmNzLCBvcHQgPSB7fSkgewogIC8vY2hlY2sgc2VydmljZU5hbWUKICBpZiAoIWlzZXN0cihzZXJ2aWNlTmFtZSkpIHsKICAgIHNlcnZpY2VOYW1lID0gJ1tlbXB0eV0nOyAvL+WFgeioseS4jeeVtnNlcnZpY2Xlj6rnlbZjbGllbnToqr/nlKgKICB9CgogIC8vY2hlY2sgZnVuY3MKICBpZiAoIWlzZWFycihmdW5jcykpIHsKICAgIGZ1bmNzID0gW107IC8v5YWB6Kix5LiN55W2c2VydmljZeWPqueVtmNsaWVudOiqv+eUqAogIH0KCiAgLy90b3BpY3MsIGtwVG9waWMKICBsZXQgdG9waWNzID0gW107CiAgbGV0IGtwVG9waWMgPSB7fTsKICBmb3JFYWNoKGZ1bmNzLCBmdW5jID0+IHsKICAgIGxldCB0b3BpYyA9IGAke3NlcnZpY2VOYW1lfToke2Z1bmN9YDsKICAgIHRvcGljcy5wdXNoKHRvcGljKTsKICAgIGtwVG9waWNbdG9waWNdID0gZnVuYzsKICB9KTsKICAvLyBjb25zb2xlLmxvZygndG9waWNzJywgdG9waWNzKQogIC8vIGNvbnNvbGUubG9nKCdrcFRvcGljJywga3BUb3BpYykKCiAgLy9jaGVja1RvcGljCiAgbGV0IGNoZWNrVG9waWMgPSB0b3BpYyA9PiB7CiAgICBsZXQgYiA9IHRvcGljcy5pbmRleE9mKHRvcGljKSA+PSAwOwogICAgcmV0dXJuIGI7CiAgfTsKCiAgLy9rcFBtCiAgbGV0IGtwUG0gPSB7fTsKCiAgLy93cGMKICBsZXQgd3BjID0gbmV3IFdQdWJzdWJDbGllbnQob3B0KTsKCiAgLy9wcm9jU3Vic2NyaWJlCiAgbGV0IHByb2NTdWJzY3JpYmUgPSBhc3luYyB0b3BpY3MgPT4gewogICAgLy9jaGVjawogICAgaWYgKCFpc2VhcnIodG9waWNzKSkgewogICAgICB0b3BpY3MgPSBbdG9waWNzXTsKICAgIH0KICAgIGF3YWl0IHBtU2VyaWVzKHRvcGljcywgYXN5bmMgdG9waWMgPT4gewogICAgICAvLyBjb25zb2xlLmxvZyhgc3Vic2NyaWJlIHRvcGljWyR7dG9waWN9XS4uLmApCgogICAgICAvL3N1YnNjcmliZQogICAgICBhd2FpdCB3cGMuc3Vic2NyaWJlKHRvcGljLCAyKQogICAgICAvLyAudGhlbigocmVzKSA9PiB7CiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhgc3Vic2NyaWJlIHRvcGljWyR7dG9waWN9XSB0aGVuYCwgcmVzKQogICAgICAvLyB9KQogICAgICAuY2F0Y2goZXJyID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhgc3Vic2NyaWJlIHRvcGljWyR7dG9waWN9XSBjYXRjaGAsIGVycik7CiAgICAgIH0pOwogICAgICAvLyBjb25zb2xlLmxvZyhgc3Vic2NyaWJlIHRvcGljWyR7dG9waWN9XSBkb25lYCkKICAgIH0pOwogIH07CgogIC8v6KiC6ZaxdG9waWNzCiAgcHJvY1N1YnNjcmliZSh0b3BpY3MpLmNhdGNoKGVyciA9PiB7CiAgICBjb25zb2xlLmxvZyhlcnIpOyAvL+W3suaWvOWFp+mDqOaUlOaIqiwg6aCQ5pyf5LiN5pyD6Ke455m8CiAgfSk7CgogIC8vcHJvY0lucHV0CiAgbGV0IHByb2NJbnB1dCA9IGFzeW5jICh0b3BpYywgbWVzc2FnZSkgPT4gewogICAgLy8gY29uc29sZS5sb2coJ3Byb2NJbnB1dC4uLicsIHRvcGljLCBtZXNzYWdlKQoKICAgIC8vY2hlY2sKICAgIGlmICh0b3BpY3MuaW5kZXhPZih0b3BpYykgPCAwKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdrcFRvcGljRnVuJywga3BUb3BpY0Z1bikKICAgICAgLy8gY29uc29sZS5sb2coJ3Byb2NJbnB1dCcsIGB0b3BpY1ske3RvcGljfV0gaXMgbm90IGluIGtwVG9waWNGdW5gKQogICAgICByZXR1cm47CiAgICB9CgogICAgLy9pZAogICAgbGV0IGlkID0gZ2V0KG1lc3NhZ2UsICdpZCcsICcnKTsKICAgIGlmICghaXNlc3RyKGlkKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgaWRgKTsKICAgIH0KCiAgICAvL2Z1bmMKICAgIGxldCBmdW5jID0gZ2V0KG1lc3NhZ2UsICdmdW5jJywgJycpOwogICAgaWYgKCFpc2VzdHIoZnVuYykpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIGZ1bmNgKTsKICAgIH0KCiAgICAvL21vZGUKICAgIGxldCBtb2RlID0gZ2V0KG1lc3NhZ2UsICdtb2RlJywgJycpOwogICAgaWYgKG1vZGUgIT09ICdpbnB1dCcgJiYgbW9kZSAhPT0gJ291dHB1dCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG1vZGVbJHttb2RlfV1gKTsKICAgIH0KICAgIGlmIChtb2RlICE9PSAnaW5wdXQnKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvL2NvcmUKICAgIGxldCBjb3JlID0gYXN5bmMgKHRvcGljLCBtZXNzYWdlKSA9PiB7CiAgICAgIC8vZnVuYwogICAgICBsZXQgZnVuYyA9IGdldChrcFRvcGljLCB0b3BpYywgJycpOwogICAgICAvLyBjb25zb2xlLmxvZygnZnVuYycsIGZ1bmMpCgogICAgICAvL2lucAogICAgICBsZXQgaW5wID0gZ2V0KG1lc3NhZ2UsICdpbnB1dCcsIG51bGwpOwogICAgICAvLyBjb25zb2xlLmxvZygnaW5wJywgaW5wKQoKICAgICAgLy9wbQogICAgICBsZXQgcG0gPSBnZW5QbSgpOwoKICAgICAgLy9lbWl0CiAgICAgIHdwYy5lbWl0KCdwcm9jRnVuJywgewogICAgICAgIGZ1bmMsCiAgICAgICAgaW5wdXQ6IGlucCwKICAgICAgICBwbQogICAgICB9KTsgLy/kuI3og73pgJrpgY5wbemAmuefpeiZleeQhue1kOadnywg5b6X6KaB5YaN6Kq/5pW0CgogICAgICAvL3IKICAgICAgbGV0IHIgPSBhd2FpdCBwbTsKICAgICAgLy8gY29uc29sZS5sb2coJ3InLCByKQoKICAgICAgcmV0dXJuIHI7CiAgICB9OwoKICAgIC8vc3RtZwogICAgbGV0IHN0bWcgPSBudWxsOwogICAgLy8gY29uc29sZS5sb2coJ3Byb2NJbnB1dCBjb3JlLi4uJywgdG9waWMsIG1lc3NhZ2UpCiAgICBhd2FpdCBjb3JlKHRvcGljLCBtZXNzYWdlKS50aGVuKHJlcyA9PiB7CiAgICAgIHN0bWcgPSB7CiAgICAgICAgZnVuYywKICAgICAgICBpZCwKICAgICAgICBtb2RlOiAnb3V0cHV0JywKICAgICAgICBvdXRwdXQ6IHsKICAgICAgICAgIHN0YXRlOiAnc3VjY2VzcycsCiAgICAgICAgICBtc2c6IHJlcwogICAgICAgIH0KICAgICAgfTsKICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgIHN0bWcgPSB7CiAgICAgICAgZnVuYywKICAgICAgICBpZCwKICAgICAgICBtb2RlOiAnb3V0cHV0JywKICAgICAgICBvdXRwdXQ6IHsKICAgICAgICAgIHN0YXRlOiAnZXJyb3InLAogICAgICAgICAgbXNnOiBlcnIKICAgICAgICB9CiAgICAgIH07CiAgICB9KTsKICAgIC8vIGNvbnNvbGUubG9nKCdwcm9jSW5wdXQgY29yZSBkb25lJywgdG9waWMsIG1lc3NhZ2UpCgogICAgLy9wdWJsaXNoLCDlm57mh4lvdXRwdXQKICAgIC8vIGNvbnNvbGUubG9nKCdwcm9jSW5wdXQgcHVibGlzaC4uLicsIHRvcGljLCBzdG1nKQogICAgYXdhaXQgd3BjLnB1Ymxpc2godG9waWMsIHN0bWcsIDIpCiAgICAvLyAudGhlbigocmVzKSA9PiB7CiAgICAvLyAgICAgY29uc29sZS5sb2coYHByb2NJbnB1dCBwdWJsaXNoIHRvcGljWyR7dG9waWN9XSBmb3Igb3V0cHV0IHRoZW5gLCByZXMpCiAgICAvLyB9KQogICAgLmNhdGNoKGVyciA9PiB7CiAgICAgIGNvbnNvbGUubG9nKGBwcm9jSW5wdXQgcHVibGlzaCB0b3BpY1ske3RvcGljfV0gZm9yIG91dHB1dCBjYXRjaGAsIGVycik7CiAgICB9KTsKICAgIC8vIGNvbnNvbGUubG9nKCdwcm9jSW5wdXQgcHVibGlzaCBkb25lJywgdG9waWMsIHN0bWcpCgogICAgLy8gY29uc29sZS5sb2coJ3Byb2NJbnB1dCBkb25lJywgdG9waWMsIG1lc3NhZ2UpCiAgfTsKCiAgLy9wcm9jT3V0cHV0CiAgbGV0IHByb2NPdXRwdXQgPSBhc3luYyAodG9waWMsIG1lc3NhZ2UpID0+IHsKICAgIC8vaWQKICAgIGxldCBpZCA9IGdldChtZXNzYWdlLCAnaWQnLCAnJyk7CiAgICBpZiAoIWlzZXN0cihpZCkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIGlkYCk7CiAgICB9CgogICAgLy9mdW5jCiAgICBsZXQgZnVuYyA9IGdldChtZXNzYWdlLCAnZnVuYycsICcnKTsKICAgIGlmICghaXNlc3RyKGZ1bmMpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCBmdW5jYCk7CiAgICB9CgogICAgLy9tb2RlCiAgICBsZXQgbW9kZSA9IGdldChtZXNzYWdlLCAnbW9kZScsICcnKTsKICAgIGlmIChtb2RlICE9PSAnaW5wdXQnICYmIG1vZGUgIT09ICdvdXRwdXQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCBtb2RlWyR7bW9kZX1dYCk7CiAgICB9CiAgICBpZiAobW9kZSAhPT0gJ291dHB1dCcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgLy8gY29uc29sZS5sb2coJ3Byb2NPdXRwdXQuLi4nLCB0b3BpYywgbWVzc2FnZSkKCiAgICAvL3BtCiAgICBsZXQgcG0gPSBnZXQoa3BQbSwgaWQsIG51bGwpOwogICAgaWYgKCFpc3BtKHBtKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy9vdXQKICAgIGxldCBvdXQgPSBnZXQobWVzc2FnZSwgJ291dHB1dCcsIG51bGwpOwogICAgLy8gY29uc29sZS5sb2coJ291dCcsIG91dCkKCiAgICAvL3N0YXRlCiAgICBsZXQgc3RhdGUgPSBnZXQob3V0LCAnc3RhdGUnLCAnJyk7CiAgICAvLyBjb25zb2xlLmxvZygnc3RhdGUnLCBzdGF0ZSkKCiAgICAvL21zZwogICAgbGV0IG1zZyA9IGdldChvdXQsICdtc2cnLCBudWxsKTsKICAgIC8vIGNvbnNvbGUubG9nKCdtc2cnLCBtc2cpCgogICAgLy9yZXNvbHZlIG9yIHJlamVjdAogICAgaWYgKHN0YXRlID09PSAnc3VjY2VzcycpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ3BtLnJlc29sdmUnLCBtc2cpCiAgICAgIHBtLnJlc29sdmUobXNnKTsKICAgIH0gZWxzZSBpZiAoc3RhdGUgPT09ICdlcnJvcicpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ3BtLnJlamVjdCcsIG1zZykKICAgICAgcG0ucmVqZWN0KG1zZyk7CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLmxvZygnb3V0Jywgb3V0KTsKICAgICAgY29uc29sZS5sb2coJ3N0YXRlJywgc3RhdGUpOwogICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgc3RhdGVgKTsKICAgIH0KCiAgICAvLyBjb25zb2xlLmxvZygncHJvY091dHB1dCBkb25lJywgdG9waWMsIG1lc3NhZ2UpCiAgfTsKCiAgLy/omZXnkIZtZXNzYWdlCiAgd3BjLm9uKCdtZXNzYWdlJywgKHsKICAgIHRvcGljLAogICAgbWVzc2FnZQogIH0pID0+IHsKICAgIC8vIGNvbnNvbGUubG9nKGBtZXNzYWdlYCwgdG9waWMsIG1lc3NhZ2UpCgogICAgLy9zZXRUaW1lb3V06ISr5Yu+6YG/5YWN5Y2h5L2PbXF0dOiZleeQhuWFtuS7luS6i+S7tgogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgIC8vcHJvY0lucHV0CiAgICAgIHByb2NJbnB1dCh0b3BpYywgbWVzc2FnZSkuY2F0Y2goZXJyID0+IHsKICAgICAgICBjb25zb2xlLmxvZyhlcnIpOyAvL+W3suaWvOWFp+mDqOaUlOaIqiwg6aCQ5pyf5LiN5pyD6Ke455m8CiAgICAgIH0pOwoKICAgICAgLy9wcm9jT3V0cHV0CiAgICAgIHByb2NPdXRwdXQodG9waWMsIG1lc3NhZ2UpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZXJyKTsgLy/lt7Lmlrzlhafpg6jmlJTmiKosIOmgkOacn+S4jeacg+inuOeZvAogICAgICB9KTsKICAgIH0sIDEpOwogIH0pOwoKICAvL3JlcVNlcnZpY2VGdW5jCiAgbGV0IHJlcVNlcnZpY2VGdW5jID0gYXN5bmMgKHNlcnZpY2VOYW1lLCBmdW5jLCBpbnB1dCkgPT4gewogICAgLy8gY29uc29sZS5sb2coJ3JlcVNlcnZpY2VGdW5jLi4uJywgc2VydmljZU5hbWUsIGZ1bmMsIGlucHV0KQoKICAgIC8vaWQKICAgIGxldCBpZCA9IGdlbklEKCk7CgogICAgLy9zdG1nCiAgICBsZXQgc3RtZyA9IHsKICAgICAgZnVuYywKICAgICAgaWQsCiAgICAgIG1vZGU6ICdpbnB1dCcsCiAgICAgIGlucHV0CiAgICB9OwoKICAgIC8vdG9waWMKICAgIGxldCB0b3BpYyA9IGAke3NlcnZpY2VOYW1lfToke2Z1bmN9YDsKCiAgICAvL3Byb2NTdWJzY3JpYmUsIOiLpeiri+axguWIhuaekHNlcnZpY2XkuI3mmK/oh6rlt7Hmj5DkvpssIOWwsemcgOimgeWFiOiogumWseaJjeaciei+puazleaOpeaUtm1lc3NhZ2Xkuovku7YKICAgIGlmICghY2hlY2tUb3BpYyh0b3BpYykpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ3JlcVNlcnZpY2VGdW5jIHByb2NTdWJzY3JpYmUuLi4nLCB0b3BpYykKICAgICAgYXdhaXQgcHJvY1N1YnNjcmliZShbdG9waWNdKS5jYXRjaChlcnIgPT4gewogICAgICAgIGNvbnNvbGUubG9nKGVycik7IC8v5bey5pa85YWn6YOo5pSU5oiqLCDpoJDmnJ/kuI3mnIPop7jnmbwKICAgICAgfSk7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdyZXFTZXJ2aWNlRnVuYyBwcm9jU3Vic2NyaWJlIGRvbmUnLCB0b3BpYykKICAgIH0KCiAgICAvL3B1Ymxpc2gKICAgIC8vIGNvbnNvbGUubG9nKCdyZXFTZXJ2aWNlRnVuYyBwdWJsaXNoLi4uJywgdG9waWMsIHN0bWcpCiAgICBsZXQgcG1tID0gZ2VuUG0oKTsKICAgIGF3YWl0IHdwYy5wdWJsaXNoKHRvcGljLCBzdG1nLCAyKS50aGVuKHJlcyA9PiB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGByZXFTZXJ2aWNlRnVuYyBwdWJsaXNoIHRvcGljWyR7dG9waWN9XSB0aGVuYCwgcmVzKQoKICAgICAgLy9zYXZlIHBtbSBhbmQgd2FpdCByZXR1cm4KICAgICAga3BQbVtpZF0gPSBwbW07CiAgICAgIC8vIGNvbnNvbGUubG9nKCdzYXZlIHBtbScsIGlkLCBrcFBtKQogICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgLy8gY29uc29sZS5sb2coYHJlcVNlcnZpY2VGdW5jIHB1Ymxpc2ggdG9waWNbJHt0b3BpY31dIGNhdGNoYCwgZXJyKQoKICAgICAgLy9yZWplY3QKICAgICAgcG1tLnJlamVjdChlcnIpOwogICAgfSk7CiAgICAvLyBjb25zb2xlLmxvZygncmVxU2VydmljZUZ1bmMgcHVibGlzaCBkb25lJywgdG9waWMsIHN0bWcpCgogICAgLy/nrYnlvoXoq4vmsYLov5Tlm57ntZDmnpwKICAgIC8vIGNvbnNvbGUubG9nKCdyZXFTZXJ2aWNlRnVuYyB3YWl0IHBtbS4uLicsIHRvcGljLCBzdG1nKQogICAgbGV0IHBtID0gZ2VuUG0oKTsKICAgIGF3YWl0IHBtbS50aGVuKHJlcyA9PiB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdyZXFTZXJ2aWNlRnVuYyB0cmFuc2ZlciBwbSB0aGVuJywgcmVzKQogICAgICBwbS5yZXNvbHZlKHJlcyk7CiAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAvLyBjb25zb2xlLmxvZygncmVxU2VydmljZUZ1bmMgdHJhbnNmZXIgcG0gY2F0Y2gnLCBlcnIpCiAgICAgIHBtLnJlamVjdChlcnIpOwogICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgIC8v6ISr5Yu+5Yiq6ZmkLCBwbW3ntZDmnZ8o5LiN6KuW5oiQ5Yqf5oiW5aSx5pWXKeeahumgiOW+nmtwUG3lhafliKrpmaQKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy9kZWxldGUgcG1tCiAgICAgICAgZGVsZXRlIGtwUG1baWRdOwogICAgICB9LCAxKTsKICAgIH0pOwogICAgLy8gY29uc29sZS5sb2coJ3JlcVNlcnZpY2VGdW5jIHdhaXQgcG1tIGRvbmUnLCB0b3BpYywgc3RtZykKCiAgICAvLyBjb25zb2xlLmxvZygncmVxU2VydmljZUZ1bmMgZG9uZScsIHNlcnZpY2VOYW1lLCBmdW5jKQogICAgcmV0dXJuIHBtOwogIH07CgogIC8vc2F2ZQogIHdwYy5yZXFTZXJ2aWNlRnVuYyA9IHJlcVNlcnZpY2VGdW5jOwogIHJldHVybiB3cGM7Cn0KCgoKbGV0IGluc3RhbmNlID0gbnVsbApmdW5jdGlvbiBpbml0KGlucHV0KXsKCiAgICAvL2luaXQKICAgIGxldCByCiAgICAKICAgICAgICByID0gV1B1YnN1YkNsaWVudENvbXUoLi4uaW5wdXQpCiAgICAgICAgCgogICAgLy9vbgogICAgCgogICAgci5vbignY29ubmVjdCcsKG1zZykgPT4gewoKICAgICAgICAvL3NlbmRNZXNzYWdlCiAgICAgICAgbGV0IHJlcyA9IHsKICAgICAgICAgICAgbW9kZTogJ2VtaXQnLAogICAgICAgICAgICBldk5hbWU6ICdjb25uZWN0JywKICAgICAgICAgICAgbXNnLAogICAgICAgIH0KICAgICAgICBzZW5kTWVzc2FnZShyZXMpCgogICAgfSkKCgoKICAgIHIub24oJ3JlY29ubmVjdCcsKG1zZykgPT4gewoKICAgICAgICAvL3NlbmRNZXNzYWdlCiAgICAgICAgbGV0IHJlcyA9IHsKICAgICAgICAgICAgbW9kZTogJ2VtaXQnLAogICAgICAgICAgICBldk5hbWU6ICdyZWNvbm5lY3QnLAogICAgICAgICAgICBtc2csCiAgICAgICAgfQogICAgICAgIHNlbmRNZXNzYWdlKHJlcykKCiAgICB9KQoKCgogICAgci5vbignbWVzc2FnZScsKG1zZykgPT4gewoKICAgICAgICAvL3NlbmRNZXNzYWdlCiAgICAgICAgbGV0IHJlcyA9IHsKICAgICAgICAgICAgbW9kZTogJ2VtaXQnLAogICAgICAgICAgICBldk5hbWU6ICdtZXNzYWdlJywKICAgICAgICAgICAgbXNnLAogICAgICAgIH0KICAgICAgICBzZW5kTWVzc2FnZShyZXMpCgogICAgfSkKCgoKICAgIHIub24oJ2Vycm9yJywobXNnKSA9PiB7CgogICAgICAgIC8vc2VuZE1lc3NhZ2UKICAgICAgICBsZXQgcmVzID0gewogICAgICAgICAgICBtb2RlOiAnZW1pdCcsCiAgICAgICAgICAgIGV2TmFtZTogJ2Vycm9yJywKICAgICAgICAgICAgbXNnLAogICAgICAgIH0KICAgICAgICBzZW5kTWVzc2FnZShyZXMpCgogICAgfSkKCgoKICAgIHIub24oJ29mZmxpbmUnLChtc2cpID0+IHsKCiAgICAgICAgLy9zZW5kTWVzc2FnZQogICAgICAgIGxldCByZXMgPSB7CiAgICAgICAgICAgIG1vZGU6ICdlbWl0JywKICAgICAgICAgICAgZXZOYW1lOiAnb2ZmbGluZScsCiAgICAgICAgICAgIG1zZywKICAgICAgICB9CiAgICAgICAgc2VuZE1lc3NhZ2UocmVzKQoKICAgIH0pCgoKCiAgICByLm9uKCdjbG9zZScsKG1zZykgPT4gewoKICAgICAgICAvL3NlbmRNZXNzYWdlCiAgICAgICAgbGV0IHJlcyA9IHsKICAgICAgICAgICAgbW9kZTogJ2VtaXQnLAogICAgICAgICAgICBldk5hbWU6ICdjbG9zZScsCiAgICAgICAgICAgIG1zZywKICAgICAgICB9CiAgICAgICAgc2VuZE1lc3NhZ2UocmVzKQoKICAgIH0pCgoKCiAgICByLm9uKCdlbmQnLChtc2cpID0+IHsKCiAgICAgICAgLy9zZW5kTWVzc2FnZQogICAgICAgIGxldCByZXMgPSB7CiAgICAgICAgICAgIG1vZGU6ICdlbWl0JywKICAgICAgICAgICAgZXZOYW1lOiAnZW5kJywKICAgICAgICAgICAgbXNnLAogICAgICAgIH0KICAgICAgICBzZW5kTWVzc2FnZShyZXMpCgogICAgfSkKCgoKICAgIHIub24oJ3Byb2NGdW4nLChtc2cpID0+IHsKCiAgICAgICAgLy9zZW5kTWVzc2FnZQogICAgICAgIGxldCByZXMgPSB7CiAgICAgICAgICAgIG1vZGU6ICdlbWl0JywKICAgICAgICAgICAgZXZOYW1lOiAncHJvY0Z1bicsCiAgICAgICAgICAgIG1zZywKICAgICAgICB9CiAgICAgICAgc2VuZE1lc3NhZ2UocmVzKQoKICAgIH0pCgoKCiAgICAvL3NhdmUKICAgIGluc3RhbmNlID0gcgoKfQoKZnVuY3Rpb24gc2VuZE1lc3NhZ2UoZGF0YSkgewogICAgCiAgICAgICAgcGFyZW50UG9ydC5wb3N0TWVzc2FnZShkYXRhKQogICAgICAgIAp9Cgphc3luYyBmdW5jdGlvbiBydW4oZGF0YSkgewogICAgLy8gY29uc29sZS5sb2coJ2lubmVyIHdvcmtlciBydW4nLGRhdGEpCgogICAgLy9tb2RlCiAgICBsZXQgbW9kZSA9IGRhdGEubW9kZQoKICAgIC8vY2hlY2sKICAgIGlmKG1vZGUgIT09ICdpbml0JyAmJiBtb2RlICE9PSAnY2FsbCcpewogICAgICAgIHJldHVybgogICAgfQoKICAgIC8vaW5pdAogICAgaWYobW9kZSA9PT0gJ2luaXQnKXsKICAgICAgICAKICAgICAgICB0cnl7CgogICAgICAgICAgICAvL3R5cGUKICAgICAgICAgICAgbGV0IHR5cGUgPSBkYXRhLnR5cGUKCiAgICAgICAgICAgIC8vaW5wdXQKICAgICAgICAgICAgbGV0IGlucHV0ID0gZGF0YS5pbnB1dAogICAgCiAgICAgICAgICAgIC8vaW5zdGFuY2UKICAgICAgICAgICAgaWYodHlwZSA9PT0gJ2Z1bmN0aW9uJyl7CiAgICAgICAgICAgICAgICBpbml0KC4uLmlucHV0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYodHlwZSA9PT0gJ29iamVjdCcpewogICAgICAgICAgICAgICAgaW5zdGFuY2UgPSBXUHVic3ViQ2xpZW50Q29tdQogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICBjYXRjaChlcnIpewogICAgICAgIAogICAgICAgICAgICAvL3NlbmRNZXNzYWdlCiAgICAgICAgICAgIGxldCByZXMgPSB7CiAgICAgICAgICAgICAgICBtb2RlOiAnZW1pdCcsCiAgICAgICAgICAgICAgICBldk5hbWU6ICdlcnJvcicsCiAgICAgICAgICAgICAgICBtc2c6IGVyciwKICAgICAgICAgICAgfQogICAgICAgICAgICBzZW5kTWVzc2FnZShyZXMpCgogICAgICAgIH0KICAgICAgICAgICAgCiAgICB9CgogICAgLy9jaGVjawogICAgaWYobW9kZSA9PT0gJ2NhbGwnKXsKICAgICAgICBsZXQgc3RhdGUgPSAnJwogICAgICAgIGxldCBtc2cgPSBudWxsCgogICAgICAgIHRyeXsKCiAgICAgICAgICAgIC8vZnVuCiAgICAgICAgICAgIGxldCBmdW4gPSBpbnN0YW5jZVtkYXRhLmZ1bl0KCiAgICAgICAgICAgIC8vaW5wdXQKICAgICAgICAgICAgbGV0IGlucHV0ID0gZGF0YS5pbnB1dAoKICAgICAgICAgICAgLy9leGVjCiAgICAgICAgICAgIGF3YWl0IGZ1biguLi5pbnB1dCkKICAgICAgICAgICAgICAgIC50aGVuKChzdWMpID0+IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZT0nc3VjY2VzcycKICAgICAgICAgICAgICAgICAgICBtc2c9c3VjCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZT0nZXJyb3InCiAgICAgICAgICAgICAgICAgICAgbXNnPWVycgogICAgICAgICAgICAgICAgfSkKCiAgICAgICAgfQogICAgICAgIGNhdGNoKGVycil7CiAgICAgICAgICAgIHN0YXRlID0gJ2Vycm9yJwogICAgICAgICAgICBtc2cgPSBlcnIKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy9zZW5kTWVzc2FnZQogICAgICAgIGxldCByZXMgPSB7CiAgICAgICAgICAgIG1vZGU6ICdyZXR1cm4nLAogICAgICAgICAgICBpZDogZGF0YS5pZCwKICAgICAgICAgICAgZnVuOiBkYXRhLmZ1biwKICAgICAgICAgICAgc3RhdGUsCiAgICAgICAgICAgIG1zZywKICAgICAgICB9CiAgICAgICAgc2VuZE1lc3NhZ2UocmVzKQoKICAgIH0KCn0KCmZ1bmN0aW9uIHJlY3ZNZXNzYWdlKGRhdGEpIHsKICAgIC8vIGNvbnNvbGUubG9nKCdpbm5lciB3b3JrZXIgcmVjdjonLCBkYXRhKQoKICAgIC8vZGF0YVJlY3YKICAgIGxldCBkYXRhUmVjdiA9IGRhdGEKCiAgICAvL3J1bgogICAgcnVuKGRhdGFSZWN2KQoKfQoKCiAgICAgICAgcGFyZW50UG9ydC5vbignbWVzc2FnZScsIHJlY3ZNZXNzYWdlKQogICAgICAgIAoKdHJ5ewogICAgcHJvY2Vzcy5vbigndW5oYW5kbGVkUmVqZWN0aW9uJywgKGVycikgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdpbm5lcjp1bmhhbmRsZWRSZWplY3Rpb24nLCBlcnIpCiAgICB9KQogICAgcHJvY2Vzcy5vbigndW5jYXVnaHRFeGNlcHRpb24nLCAoZXJyKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ2lubmVyOnVuY2F1Z2h0RXhjZXB0aW9uJywgZXJyKQogICAgfSkKICAgIHByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uTW9uaXRvcicsIChlcnIpID0+IHsKICAgICAgICBjb25zb2xlLmxvZygnaW5uZXI6dW5jYXVnaHRFeGNlcHRpb25Nb25pdG9yJywgZXJyKQogICAgfSkKfQpjYXRjaChlcnIpe30KCg==`;

	      //code
	      let code = b642str(codeB64);
	      function wrapWorker() {
	        //evem
	        let ev = evem();
	        function genWorker(code) {
	          //new Worker
	          try {
	            return new worker_threads.Worker(code, {
	              eval: true
	            });
	          } catch (err) {
	            emitError(err);
	          }
	        }

	        //genWorker
	        let wk = genWorker(code);

	        //check, 於瀏覽器端可能會遭遇IE11安全性問題, 或被CSP的worker-src或script-src設定阻擋
	        if (!wk) {
	          emitError('invalid worker');
	          return null;
	        }
	        function terminate() {
	          if (wk) {
	            wk.terminate();
	            wk = undefined;
	          } else {
	            emitError('worker has been terminated');
	          }
	        }
	        function init() {
	          //dataSend
	          let dataSend = {
	            mode: 'init',
	            type: 'function',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);
	        }
	        function subscribe() {
	          //pm
	          let pm = genPm();

	          //id
	          let id = genID();

	          //dataSend
	          let dataSend = {
	            mode: 'call',
	            id,
	            fun: 'subscribe',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);

	          //once
	          ev.once(id, res => {
	            if (res.state === 'success') {
	              pm.resolve(res.msg);
	            } else {
	              pm.reject(res.msg);
	            }
	          });
	          return pm;
	        }
	        function unsubscribe() {
	          //pm
	          let pm = genPm();

	          //id
	          let id = genID();

	          //dataSend
	          let dataSend = {
	            mode: 'call',
	            id,
	            fun: 'unsubscribe',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);

	          //once
	          ev.once(id, res => {
	            if (res.state === 'success') {
	              pm.resolve(res.msg);
	            } else {
	              pm.reject(res.msg);
	            }
	          });
	          return pm;
	        }
	        function publish() {
	          //pm
	          let pm = genPm();

	          //id
	          let id = genID();

	          //dataSend
	          let dataSend = {
	            mode: 'call',
	            id,
	            fun: 'publish',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);

	          //once
	          ev.once(id, res => {
	            if (res.state === 'success') {
	              pm.resolve(res.msg);
	            } else {
	              pm.reject(res.msg);
	            }
	          });
	          return pm;
	        }
	        function clear() {
	          //pm
	          let pm = genPm();

	          //id
	          let id = genID();

	          //dataSend
	          let dataSend = {
	            mode: 'call',
	            id,
	            fun: 'clear',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);

	          //once
	          ev.once(id, res => {
	            if (res.state === 'success') {
	              pm.resolve(res.msg);
	            } else {
	              pm.reject(res.msg);
	            }
	          });
	          return pm;
	        }
	        function reqServiceFunc() {
	          //pm
	          let pm = genPm();

	          //id
	          let id = genID();

	          //dataSend
	          let dataSend = {
	            mode: 'call',
	            id,
	            fun: 'reqServiceFunc',
	            input: [...arguments] //若直接用arguments會無法轉譯
	          };

	          //postMessage
	          wk.postMessage(dataSend);

	          //once
	          ev.once(id, res => {
	            if (res.state === 'success') {
	              pm.resolve(res.msg);
	            } else {
	              pm.reject(res.msg);
	            }
	          });
	          return pm;
	        }
	        function recvMessage(data) {
	          // console.log('outer worker recv:', data)

	          //dataRecv
	          let dataRecv = data;

	          //mode
	          let mode = dataRecv.mode;

	          //check
	          if (mode !== 'emit' && mode !== 'return') {
	            return;
	          }

	          //emit
	          if (mode === 'emit') {
	            //emit
	            ev.emit(dataRecv.evName, dataRecv.msg);
	          }

	          //return
	          if (mode === 'return') {
	            //emit
	            ev.emit(dataRecv.id, dataRecv);
	          }
	        }

	        //bind recvMessage

	        wk.on('message', recvMessage);
	        function emitError(err) {
	          ev.emit('error', err);
	        }

	        //bind emitError

	        wk.on('error', emitError);

	        //bind emitError for special condition

	        wk.on('exit', code => {
	          //The 'exit' event is emitted once the worker has stopped. If the worker exited by calling process.exit(), the exitCode parameter is the passed exit code. If the worker was terminated, the exitCode parameter is 1.
	          if (code !== 1) {
	            emitError('exit code[' + code + '] !== 1');
	          }
	        });

	        //init
	        init([...arguments]); //若直接用arguments會無法轉譯

	        ev.subscribe = subscribe;
	        ev.unsubscribe = unsubscribe;
	        ev.publish = publish;
	        ev.clear = clear;
	        ev.reqServiceFunc = reqServiceFunc;
	        ev.terminate = terminate;
	        return ev;
	      }

	      //set ww

	      ww = wrapWorker;
	    }
	    protectShell();
	    try {
	      process.on('unhandledRejection', err => {
	        console.log('outer:unhandledRejection', err);
	      });
	      process.on('uncaughtException', err => {
	        console.log('outer:uncaughtException', err);
	      });
	      process.on('uncaughtExceptionMonitor', err => {
	        console.log('outer:uncaughtExceptionMonitor', err);
	      });
	    } catch (err) {}
	    var ww$1 = ww;
	    return ww$1;
	  });
	})(tempSYnLQ9wgtSStDkDC6vZ6yGbWl9poHhbFNw);
	var tempSYnLQ9wgtSStDkDC6vZ6yGbWl9poHhbFNwExports = tempSYnLQ9wgtSStDkDC6vZ6yGbWl9poHhbFNw.exports;
	var nw = /*@__PURE__*/getDefaultExportFromCjs(tempSYnLQ9wgtSStDkDC6vZ6yGbWl9poHhbFNwExports);

	return nw;

}));
