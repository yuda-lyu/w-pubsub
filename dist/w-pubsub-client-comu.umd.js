/*!
 * w-pubsub-client-comu v1.0.9
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("mqtt")):"function"==typeof define&&define.amd?define(["mqtt"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-pubsub-client-comu"]=e(t.mqtt)}(this,(function(t){"use strict";var e=Array.isArray,n="object"==typeof global&&global&&global.Object===Object&&global,r="object"==typeof self&&self&&self.Object===Object&&self,o=n||r||Function("return this")(),i=o.Symbol,c=Object.prototype,u=c.hasOwnProperty,a=c.toString,l=i?i.toStringTag:void 0;var s=Object.prototype.toString;var f=i?i.toStringTag:void 0;function p(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":f&&f in Object(t)?function(t){var e=u.call(t,l),n=t[l];try{t[l]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[l]=n:delete t[l]),o}(t):function(t){return s.call(t)}(t)}function h(t){return null!=t&&"object"==typeof t}function v(t){return"symbol"==typeof t||h(t)&&"[object Symbol]"==p(t)}var y=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,b=/^\w*$/;function d(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function g(t){if(!d(t))return!1;var e=p(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var _,j=o["__core-js_shared__"],m=(_=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"";var w=Function.prototype.toString;var O=/^\[object .+?Constructor\]$/,x=Function.prototype,A=Object.prototype,S=x.toString,$=A.hasOwnProperty,P=RegExp("^"+S.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function E(t){return!(!d(t)||(e=t,m&&m in e))&&(g(t)?P:O).test(function(t){if(null!=t){try{return w.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function N(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return E(n)?n:void 0}var F=N(Object,"create");var T=Object.prototype.hasOwnProperty;var I=Object.prototype.hasOwnProperty;function k(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function z(t,e){for(var n,r,o=t.length;o--;)if((n=t[o][0])===(r=e)||n!=n&&r!=r)return o;return-1}k.prototype.clear=function(){this.__data__=F?F(null):{},this.size=0},k.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},k.prototype.get=function(t){var e=this.__data__;if(F){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return T.call(e,t)?e[t]:void 0},k.prototype.has=function(t){var e=this.__data__;return F?void 0!==e[t]:I.call(e,t)},k.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=F&&void 0===e?"__lodash_hash_undefined__":e,this};var C=Array.prototype.splice;function q(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}q.prototype.clear=function(){this.__data__=[],this.size=0},q.prototype.delete=function(t){var e=this.__data__,n=z(e,t);return!(n<0)&&(n==e.length-1?e.pop():C.call(e,n,1),--this.size,!0)},q.prototype.get=function(t){var e=this.__data__,n=z(e,t);return n<0?void 0:e[n][1]},q.prototype.has=function(t){return z(this.__data__,t)>-1},q.prototype.set=function(t,e){var n=this.__data__,r=z(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var L=N(o,"Map");function M(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function U(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}U.prototype.clear=function(){this.size=0,this.__data__={hash:new k,map:new(L||q),string:new k}},U.prototype.delete=function(t){var e=M(this,t).delete(t);return this.size-=e?1:0,e},U.prototype.get=function(t){return M(this,t).get(t)},U.prototype.has=function(t){return M(this,t).has(t)},U.prototype.set=function(t,e){var n=M(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function B(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var c=t.apply(this,r);return n.cache=i.set(o,c)||i,c};return n.cache=new(B.Cache||U),n}B.Cache=U;var R,D,J,G=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,V=/\\(\\)?/g,W=(R=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(G,(function(t,n,r,o){e.push(r?o.replace(V,"$1"):n||t)})),e},D=B(R,(function(t){return 500===J.size&&J.clear(),t})),J=D.cache,D),H=W;var K=i?i.prototype:void 0,Q=K?K.toString:void 0;function X(t){if("string"==typeof t)return t;if(e(t))return function(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}(t,X)+"";if(v(t))return Q?Q.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}function Y(t){return null==t?"":X(t)}function Z(t,n){return e(t)?t:function(t,n){if(e(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!v(t))||b.test(t)||!y.test(t)||null!=n&&t in Object(n)}(t,n)?[t]:H(Y(t))}function tt(t){if("string"==typeof t||v(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function et(t,e,n){var r=null==t?void 0:function(t,e){for(var n=0,r=(e=Z(e,t)).length;null!=t&&n<r;)t=t[tt(e[n++])];return n&&n==r?t:void 0}(t,e);return void 0===r?n:r}function nt(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}var rt,ot=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),c=i.length;c--;){var u=i[rt?c:++r];if(!1===e(o[u],u,o))break}return t};function it(t){return h(t)&&"[object Arguments]"==p(t)}var ct=Object.prototype,ut=ct.hasOwnProperty,at=ct.propertyIsEnumerable,lt=it(function(){return arguments}())?it:function(t){return h(t)&&ut.call(t,"callee")&&!at.call(t,"callee")},st=lt;var ft="object"==typeof exports&&exports&&!exports.nodeType&&exports,pt=ft&&"object"==typeof module&&module&&!module.nodeType&&module,ht=pt&&pt.exports===ft?o.Buffer:void 0,vt=(ht?ht.isBuffer:void 0)||function(){return!1},yt=/^(?:0|[1-9]\d*)$/;function bt(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&yt.test(t))&&t>-1&&t%1==0&&t<e}function dt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var gt={};gt["[object Float32Array]"]=gt["[object Float64Array]"]=gt["[object Int8Array]"]=gt["[object Int16Array]"]=gt["[object Int32Array]"]=gt["[object Uint8Array]"]=gt["[object Uint8ClampedArray]"]=gt["[object Uint16Array]"]=gt["[object Uint32Array]"]=!0,gt["[object Arguments]"]=gt["[object Array]"]=gt["[object ArrayBuffer]"]=gt["[object Boolean]"]=gt["[object DataView]"]=gt["[object Date]"]=gt["[object Error]"]=gt["[object Function]"]=gt["[object Map]"]=gt["[object Number]"]=gt["[object Object]"]=gt["[object RegExp]"]=gt["[object Set]"]=gt["[object String]"]=gt["[object WeakMap]"]=!1;var _t="object"==typeof exports&&exports&&!exports.nodeType&&exports,jt=_t&&"object"==typeof module&&module&&!module.nodeType&&module,mt=jt&&jt.exports===_t&&n.process,wt=function(){try{var t=jt&&jt.require&&jt.require("util").types;return t||mt&&mt.binding&&mt.binding("util")}catch(t){}}(),Ot=wt&&wt.isTypedArray,xt=Ot?function(t){return function(e){return t(e)}}(Ot):function(t){return h(t)&&dt(t.length)&&!!gt[p(t)]},At=xt,St=Object.prototype.hasOwnProperty;function $t(t,n){var r=e(t),o=!r&&st(t),i=!r&&!o&&vt(t),c=!r&&!o&&!i&&At(t),u=r||o||i||c,a=u?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],l=a.length;for(var s in t)!n&&!St.call(t,s)||u&&("length"==s||i&&("offset"==s||"parent"==s)||c&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||bt(s,l))||a.push(s);return a}var Pt=Object.prototype;var Et=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),Nt=Et,Ft=Object.prototype.hasOwnProperty;function Tt(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||Pt))return Nt(t);var e,n,r=[];for(var o in Object(t))Ft.call(t,o)&&"constructor"!=o&&r.push(o);return r}function It(t){return null!=t&&dt(t.length)&&!g(t)}function kt(t){return It(t)?$t(t):Tt(t)}var zt=function(t,e){return function(n,r){if(null==n)return n;if(!It(n))return t(n,r);for(var o=n.length,i=e?o:-1,c=Object(n);(e?i--:++i<o)&&!1!==r(c[i],i,c););return n}}((function(t,e){return t&&ot(t,e,kt)})),Ct=zt;function qt(t){return t}function Lt(t,n){var r;return(e(t)?nt:Ct)(t,"function"==typeof(r=n)?r:qt)}function Mt(t){return"[object String]"===Object.prototype.toString.call(t)}function Ut(t){return!(!Mt(t)||""===t)}function Bt(t){return"[object Array]"===Object.prototype.toString.call(t)}function Rt(t){return"[object Object]"===Object.prototype.toString.call(t)}function Dt(t){return t!=t}function Jt(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(Rt(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!Mt(t)||""!==t)}(t)||(!!function(t){return!!Bt(t)&&0===t.length}(t)||!!Dt(t)))))}function Gt(t){return!!Bt(t)&&(0!==t.length&&(1!==t.length||!Jt(t[0])))}function Vt(t){let e,n=Object.prototype.toString.call(t);if(e="[object Promise]"===n,e)return!0;if("[object Function]"!==n)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}var Wt=/\s/;var Ht=/^\s+/;function Kt(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&Wt.test(t.charAt(e)););return e}(t)+1).replace(Ht,""):t}var Qt=/^[-+]0x[0-9a-f]+$/i,Xt=/^0b[01]+$/i,Yt=/^0o[0-7]+$/i,Zt=parseInt;function te(t){if("number"==typeof t)return t;if(v(t))return NaN;if(d(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=d(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Kt(t);var n=Xt.test(t);return n||Yt.test(t)?Zt(t.slice(2),n?2:8):Qt.test(t)?NaN:+t}var ee=1/0;function ne(t){return t?(t=te(t))===ee||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function re(t){var e=ne(t),n=e%1;return e==e?n?e-n:e:0}function oe(t){let e=!1;if(Ut(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(Dt(t))return!1;e=!0}return e}function ie(t){if(!oe(t))return 0;return ne(t)}function ce(t){return!!oe(t)&&(t=ie(t),"number"==typeof(e=t)&&e==re(e));var e}var ue=o.isFinite,ae=Math.min;var le=function(t){var e=Math[t];return function(t,n){if(t=te(t),(n=null==n?0:ae(re(n),292))&&ue(t)){var r=(Y(t)+"e").split("e");return+((r=(Y(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),se=le;function fe(t){if(!oe(t))return 0;t=ie(t);let e=se(t);return"0"===String(e)?0:e}function pe(t){if(!ce(t))return!1;return fe(t)>0}let he="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),ve=he.length;function ye(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];t=pe(t)?fe(t):32;for(let n=0;n<t;n++)e[n]=he[0|Math.random()*ve];return e.join("")}function be(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}function de(t,e,n){var r=null==t?0:t.length;return r?function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}(t,(e=n||void 0===e?1:re(e))<0?0:e,r):[]}function ge(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function _e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var je={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,c){if("function"!=typeof r)throw new TypeError("The listener must be a function");var u=new o(r,i||t,c),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],u]:t._events[a].push(u):(t._events[a]=u,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function u(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},u.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,c=new Array(i);o<i;o++)c[o]=r[o].fn;return c},u.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},u.prototype.emit=function(t,e,r,o,i,c){var u=n?n+t:t;if(!this._events[u])return!1;var a,l,s=this._events[u],f=arguments.length;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),f){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,e),!0;case 3:return s.fn.call(s.context,e,r),!0;case 4:return s.fn.call(s.context,e,r,o),!0;case 5:return s.fn.call(s.context,e,r,o,i),!0;case 6:return s.fn.call(s.context,e,r,o,i,c),!0}for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];s.fn.apply(s.context,a)}else{var p,h=s.length;for(l=0;l<h;l++)switch(s[l].once&&this.removeListener(t,s[l].fn,void 0,!0),f){case 1:s[l].fn.call(s[l].context);break;case 2:s[l].fn.call(s[l].context,e);break;case 3:s[l].fn.call(s[l].context,e,r);break;case 4:s[l].fn.call(s[l].context,e,r,o);break;default:if(!a)for(p=1,a=new Array(f-1);p<f;p++)a[p-1]=arguments[p];s[l].fn.apply(s[l].context,a)}}return!0},u.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},u.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},u.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var u=this._events[i];if(u.fn)u.fn!==e||o&&!u.once||r&&u.context!==r||c(this,i);else{for(var a=0,l=[],s=u.length;a<s;a++)(u[a].fn!==e||o&&!u[a].once||r&&u[a].context!==r)&&l.push(u[a]);l.length?this._events[i]=1===l.length?l[0]:l:c(this,i)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&c(this,e)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u}(je);var me=_e(je.exports);async function we(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=be();if(!ge(t))return r.reject("waitfunction需輸入函數f"),r;let o=async()=>{let e=t();return Vt(e)&&(e=await e),e};if(n=await o(),!0===n)return r.resolve(),r;let i=et(e,"attemptNum",null);pe(i)||(i=200);let c=et(e,"timeInterval",null);pe(c)||(c=1e3);let u=0,a=setInterval((async()=>{u+=1,n=await o(),!0===n&&(clearInterval(a),r.resolve()),u>i&&(clearInterval(a),r.reject(`exceeded attemptNum[${i}]`))}),c);return r}function Oe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="__msg__",r=et(e,"url");Ut(r)||(r="mqtt://localhost");let o=et(e,"port");pe(o)||(o=8080),o=fe(o);let i=et(e,"token");Ut(i)||(i="");let c=et(e,"clientId");Ut(c)||(c=`cl-${ye()}`);let u=et(e,"timeReconnect");pe(u)||(u=2e3),u=fe(u);let a=`${r}:${o}`,l=t.connect(a,{clientId:c,username:i,password:"",clean:!1,reconnectPeriod:u}),s=new me,f=!1;l.on("connect",(()=>{f=!0,s.emit("connect")})),l.on("reconnect",(()=>{s.emit("reconnect")}));l.on("message",((t,e)=>{let r="";try{r=et(function(t){if(!Ut(t))return{};let e={};try{e=JSON.parse(t)}catch(t){e={}}return e}(e.toString()),n,"")}catch(t){console.log(t)}s.emit("message",{topic:t,message:r})})),l.on("error",(t=>{s.emit("error",t)})),l.on("offline",(()=>{f=!1,s.emit("offline")})),l.on("close",(()=>{f=!1,s.emit("close")})),l.on("end",(()=>{f=!1,s.emit("end")}));return s.subscribe=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=be();return await we((()=>f)),l.subscribe(t,{qos:e},((t,e)=>{t?n.reject(t):n.resolve(e)})),n},s.unsubscribe=async t=>{let e=be();return await we((()=>f)),l.unsubscribe(t,(t=>{t?e.reject(t):e.resolve()})),e},s.publish=async function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;await we((()=>f));let o=JSON.stringify({[n]:e}),i=be();return l.publish(t,o,{qos:r},(t=>{t?i.reject(t):i.resolve("done")})),i},s.clear=()=>new Promise(((t,e)=>{l.end(!1,{},(n=>{if(n)return e(n);t()}))})),s}return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Ut(t)||(t="[empty]"),Gt(e)||(e=[]);let r=[],o={};Lt(e,(e=>{let n=`${t}:${e}`;r.push(n),o[n]=e}));let i={},c=new Oe(n),u=async t=>{Gt(t)||(t=[t]),await function(t,e){let n=be();if(!Bt(t)&&!Rt(t))return n.reject("rs is not an array or object"),n;let r=!1;if(Rt(t)){r=!0;let e=[];Lt(t,((t,n)=>{e.push({k:n,v:t})})),t=e}ge(e)||(e=function(t){return t});let o=-1,i=[];return t.reduce((function(t,n){return t.then((function(t){i.push(t),o+=1;let c=o,u=n;return r&&(c=n.k,u=n.v),ge(e)?e(u,c):u}))}),Promise.resolve()).then((function(t){i.push(t),i=de(i),n.resolve(i)})).catch((function(t){n.reject(t)})),n}(t,(async t=>{await c.subscribe(t,2).catch((e=>{console.log(`subscribe topic[${t}] catch`,e)}))}))};return u(r).catch((t=>{console.log(t)})),c.on("message",(t=>{let{topic:e,message:n}=t;setTimeout((()=>{(async(t,e)=>{if(r.indexOf(t)<0)return;let n=et(e,"id","");if(!Ut(n))throw new Error("invalid id");let i=et(e,"func","");if(!Ut(i))throw new Error("invalid func");let u=et(e,"mode","");if("input"!==u&&"output"!==u)throw new Error(`invalid mode[${u}]`);if("input"!==u)return;let a=null;await(async(t,e)=>{let n=et(o,t,""),r=et(e,"input",null),i=be();return c.emit("procFun",{func:n,input:r,pm:i}),await i})(t,e).then((t=>{a={func:i,id:n,mode:"output",output:{state:"success",msg:t}}})).catch((t=>{a={func:i,id:n,mode:"output",output:{state:"error",msg:t}}})),await c.publish(t,a,2).catch((e=>{console.log(`procInput publish topic[${t}] for output catch`,e)}))})(e,n).catch((t=>{console.log(t)})),(async(t,e)=>{let n=et(e,"id","");if(!Ut(n))throw new Error("invalid id");if(!Ut(et(e,"func","")))throw new Error("invalid func");let r=et(e,"mode","");if("input"!==r&&"output"!==r)throw new Error(`invalid mode[${r}]`);if("output"!==r)return;let o=et(i,n,null);if(!Vt(o))return;let c=et(e,"output",null),u=et(c,"state",""),a=et(c,"msg",null);if("success"===u)o.resolve(a);else{if("error"!==u)throw console.log("out",c),console.log("state",u),new Error("invalid state");o.reject(a)}})(0,n).catch((t=>{console.log(t)}))}),1)})),c.reqServiceFunc=async(t,e,n)=>{let o=ye(),a={func:e,id:o,mode:"input",input:n},l=`${t}:${e}`;(t=>r.indexOf(t)>=0)(l)||await u([l]).catch((t=>{console.log(t)}));let s=be();await c.publish(l,a,2).then((t=>{i[o]=s})).catch((t=>{s.reject(t)}));let f=be();return await s.then((t=>{f.resolve(t)})).catch((t=>{f.reject(t)})).finally((()=>{setTimeout((()=>{delete i[o]}),1)})),f},c}}));
//# sourceMappingURL=w-pubsub-client-comu.umd.js.map
